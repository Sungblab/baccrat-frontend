<!DOCTYPE html>
<html lang="ko" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ê³¨ë“  ì¹´ì§€ë…¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* Tailwind CSSì˜ ë‹¤í¬ ëª¨ë“œ ì‚¬ìš© */
      :root {
        --tw-bg-opacity: 1;
        --tw-text-opacity: 1;
      }
      .toast {
        visibility: hidden;
        min-width: 250px;
        margin-left: -125px;
        background-color: #333;
        color: #fff;
        text-align: center;
        border-radius: 2px;
        padding: 16px;
        position: fixed;
        z-index: 9999;
        left: 50%;
        bottom: 30px;
      }
      .toast.show {
        visibility: visible;
        -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
        animation: fadein 0.5s, fadeout 0.5s 2.5s;
      }
      .toast.toast-info {
        background-color: #3b82f6;
        border-left: 4px solid #1d4ed8;
      }
      .toast.toast-success {
        background-color: #10b981;
        border-left: 4px solid #047857;
      }
      .toast.toast-error {
        background-color: #ef4444;
        border-left: 4px solid #dc2626;
      }
      @-webkit-keyframes fadein {
        from {
          bottom: 0;
          opacity: 0;
        }
        to {
          bottom: 30px;
          opacity: 1;
        }
      }
      @keyframes fadein {
        from {
          bottom: 0;
          opacity: 0;
        }
        to {
          bottom: 30px;
          opacity: 1;
        }
      }
      @-webkit-keyframes fadeout {
        from {
          bottom: 30px;
          opacity: 1;
        }
        to {
          bottom: 0;
          opacity: 0;
        }
      }
      @keyframes fadeout {
        from {
          bottom: 30px;
          opacity: 1;
        }
        to {
          bottom: 0;
          opacity: 0;
        }
      }
      .scrollable-table {
        max-height: 400px;
        overflow-y: auto;
      }

      @media (max-width: 640px) {
        .responsive-table {
          display: block;
          width: 100%;
          overflow-x: auto;
        }
      }

      /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
      .custom-scrollbar {
        scrollbar-width: thin;
        scrollbar-color: #4b5563 transparent;
      }

      .custom-scrollbar::-webkit-scrollbar {
        width: 6px;
      }

      .custom-scrollbar::-webkit-scrollbar-track {
        background: transparent;
      }

      .custom-scrollbar::-webkit-scrollbar-thumb {
        background-color: #4b5563;
        border-radius: 3px;
      }

      /* í…Œì´ë¸” í–‰ í˜¸ë²„ íš¨ */
      tbody tr {
        transition: background-color 0.2s;
      }

      tbody tr:hover {
        background-color: rgba(55, 65, 81, 0.5);
      }

      /* Sticky í—¤ë” ìŠ¤íƒ€ì¼ */
      thead {
        position: sticky;
        top: 0;
        z-index: 10;
      }

      /* ìµœê·¼ ê²Œì„ ê²°ê³¼ (Big Road) ìŠ¤íƒ€ì¼ ì¶”ê°€ */
      #recentResults {
        display: flex;
        flex-direction: row; /* ê°€ë¡œë¡œ ì—´ ë°°ì¹˜ */
        overflow-x: auto; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ */
        padding: 8px;
        min-height: 130px; /* ìµœì†Œ ë†’ì´ (6ê°œ ì•„ì´í…œ + íŒ¨ë”© ê³ ë ¤) */
        align-items: flex-start; /* ì—´ ìƒë‹¨ ì •ë ¬ */
        gap: 4px; /* ì—´ ê°„ ê°„ê²© */
        -webkit-overflow-scrolling: touch; /* iOS ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤ */
        background-color: rgba(0, 0, 0, 0.2); /* ë°°ê²½ìƒ‰ ì•½ê°„ ì¶”ê°€ */
        border-radius: 6px;
      }

      .result-column {
        display: flex;
        flex-direction: column; /* ì„¸ë¡œë¡œ ì•„ì´í…œ ë°°ì¹˜ */
        gap: 4px; /* ì•„ì´í…œ ê°„ ê°„ê²© */
      }

      .result-cell {
        width: 20px; /* ì…€ ë„ˆë¹„ */
        height: 20px; /* ì…€ ë†’ì´ */
        border-radius: 50%; /* ì›í˜• */
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        flex-shrink: 0; /* ì¤„ì–´ë“¤ì§€ ì•Šë„ë¡ */
        border: 2px solid;
        background: transparent;
      }

      /* ì¤‘êµ­ì  ìŠ¤íƒ€ì¼ */
      .result-cell.player {
        border-color: #3b82f6; /* íŒŒë€ìƒ‰ í…Œë‘ë¦¬ */
        background: transparent; /* ë¹„ì–´ìˆìŒ */
      }

      .result-cell.banker {
        border-color: #ef4444; /* ë¹¨ê°„ìƒ‰ í…Œë‘ë¦¬ */
        background: transparent; /* ë¹„ì–´ìˆìŒ */
      }

      .result-cell.tie {
        border-color: #10b981; /* ë…¹ìƒ‰ í…Œë‘ë¦¬ */
        background: transparent; /* ë¹„ì–´ìˆìŒ */
      }

      /* í˜ì–´ í‘œì‹œ - ì¤‘êµ­ì  ìŠ¤íƒ€ì¼ ì‘ì€ ì  */
      .result-cell.player-pair::before {
        content: "";
        position: absolute;
        top: 2px;
        left: 2px;
        width: 4px;
        height: 4px;
        border-radius: 50%;
        background: #3b82f6; /* í”Œë ˆì´ì–´ í˜ì–´ëŠ” íŒŒë€ìƒ‰ ì  */
      }

      .result-cell.banker-pair::after {
        content: "";
        position: absolute;
        bottom: 2px;
        right: 2px;
        width: 4px;
        height: 4px;
        border-radius: 50%;
        background: #ef4444; /* ë±…ì»¤ í˜ì–´ëŠ” ë¹¨ê°„ìƒ‰ ì  */
      }

      body {
        font-family: "Noto Serif KR", serif;
      }
    </style>
  </head>
  <body class="bg-gray-900 text-white">
    <div class="w-[100%] md:w-[80%] mx-auto p-2 md:p-6">
      <!-- í—¤ë” ë° ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ -->
      <header
        class="flex flex-col md:flex-row justify-between items-center mb-4 md:mb-6"
      >
        <h1
          class="text-3xl font-bold text-yellow-500"
          style="text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5)"
        >
          GOLDEN CASINO
        </h1>
        <button
          id="logout"
          class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded w-full md:w-auto"
        >
          ë¡œê·¸ì•„ì›ƒ
        </button>
      </header>

      <!-- ê²Œì„ ê´€ë¦¬, ë¦¬ë”ë³´ë“œ, ìµœê·¼ ê¸°ë¡ 3ê°œ ì„¹ì…˜ -->
      <div class="mb-4 md:mb-6 grid grid-cols-1 lg:grid-cols-3 gap-3 md:gap-6">
        <!-- ê²Œì„ ê´€ë¦¬ (ì™¼ìª½) -->
        <div class="bg-gray-800 p-3 md:p-4 rounded-lg shadow">
          <h3 class="text-lg font-semibold mb-4 text-purple-400">ê²Œì„ ê´€ë¦¬</h3>

          <!-- ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
          <div class="space-y-3 mb-4">
            <!-- 1. ìƒíƒœ ë° ê¸°ë³¸ ì»¨íŠ¸ë¡¤ -->
            <div class="bg-gray-700/50 p-3 rounded-lg">
              <div class="flex flex-col gap-3">
                <div class="flex items-center space-x-3">
                  <div
                    id="bettingStatus"
                    class="text-base font-semibold text-yellow-400"
                  >
                    í˜„ì¬ ìƒíƒœ: ëŒ€ê¸°ì¤‘
                  </div>
                  <div
                    id="timer"
                    class="text-xl font-bold text-blue-400 min-w-[50px]"
                  ></div>
                </div>
                <div class="flex flex-col space-y-2">
                  <button
                    id="startBetting"
                    class="bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg font-bold transition"
                  >
                    ë² íŒ… ì‹œì‘
                  </button>
                  <button
                    id="adminStartGame"
                    class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded-lg font-bold transition"
                  >
                    ê²Œì„ ì‹œì‘
                  </button>
                </div>
              </div>
            </div>

            <!-- 2. ìë™ ê²Œì„ ê´€ë¦¬ (ìë™ì‹œì‘ + ë°±ê·¸ë¼ìš´ë“œ í†µí•©) -->
            <div class="bg-gray-700/50 p-3 rounded-lg">
              <div class="flex flex-col gap-3">
                <div>
                  <h4 class="font-semibold text-gray-300">ìë™ ê²Œì„</h4>
                  <div
                    id="autoStatus"
                    class="text-sm font-medium text-gray-400 hidden"
                  >
                    ìë™ ê²Œì„ ì§„í–‰ ì¤‘... <span id="autoProgress"></span>
                  </div>
                </div>

                <!-- ê²Œì„ íšŸìˆ˜ ì„ íƒ -->
                <div>
                  <label class="block text-sm font-medium text-gray-400 mb-2"
                    >ê²Œì„ íšŸìˆ˜ ì„ íƒ</label
                  >
                  <select
                    id="autoGameCount"
                    class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-yellow-500 focus:ring-2 focus:ring-yellow-500"
                  >
                    <option value="0">ê³„ì† (ë¬´ì œí•œ)</option>
                    <option value="50">50íšŒ</option>
                    <option value="100">100íšŒ</option>
                    <option value="200">200íšŒ</option>
                    <option value="500">500íšŒ</option>
                  </select>
                </div>

                <div class="flex flex-col space-y-2">
                  <button
                    id="startAutoGame"
                    class="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-2 rounded-lg font-bold transition"
                  >
                    ìë™ ê²Œì„ ì‹œì‘
                  </button>
                  <button
                    id="stopAutoGame"
                    class="bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-lg font-bold transition hidden"
                  >
                    ìë™ ê²Œì„ ì¤‘ì§€
                  </button>
                </div>
              </div>

              <hr class="border-gray-600 my-3" />
              <div class="flex flex-col gap-2">
                <div id="deckInfo" class="text-sm text-gray-400">
                  ë± ì •ë³´: ë¡œë”© ì¤‘...
                </div>
                <button
                  id="adminShuffleDeck"
                  class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-2 rounded-lg font-bold transition"
                >
                  ë± ì…”í”Œ
                </button>
              </div>
            </div>
          </div>

          <!-- ì‹¤ì‹œê°„ ë² íŒ… í˜„í™© -->
          <div>
            <h4 class="text-base font-semibold mb-2 text-gray-300">
              ì‹¤ì‹œê°„ ë² íŒ… í˜„í™©
            </h4>
            <div
              class="bg-gray-900 rounded-lg overflow-x-auto border border-gray-700"
            >
              <table class="min-w-full text-sm">
                <thead class="bg-gray-700">
                  <tr>
                    <th scope="col" class="py-2 px-3 text-left font-semibold">
                      ë² íŒ… ì˜µì…˜
                    </th>
                    <th scope="col" class="py-2 px-3 text-right font-semibold">
                      ë² íŒ… ê¸ˆì•¡
                    </th>
                    <th scope="col" class="py-2 px-3 text-right font-semibold">
                      ë² íŒ… ì¸ì›
                    </th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-gray-700">
                  <!-- Player -->
                  <tr class="hover:bg-gray-800/50">
                    <td class="py-2 px-3 font-bold text-blue-400">í”Œë ˆì´ì–´</td>
                    <td
                      id="adminPlayerBetAmount"
                      class="py-2 px-3 text-right font-mono"
                    >
                      0 ì›
                    </td>
                    <td
                      id="adminPlayerBetCount"
                      class="py-2 px-3 text-right font-mono"
                    >
                      0ëª…
                    </td>
                  </tr>
                  <!-- Banker -->
                  <tr class="hover:bg-gray-800/50">
                    <td class="py-2 px-3 font-bold text-red-400">ë±…ì»¤</td>
                    <td
                      id="adminBankerBetAmount"
                      class="py-2 px-3 text-right font-mono"
                    >
                      0 ì›
                    </td>
                    <td
                      id="adminBankerBetCount"
                      class="py-2 px-3 text-right font-mono"
                    >
                      0ëª…
                    </td>
                  </tr>
                  <!-- Tie -->
                  <tr class="hover:bg-gray-800/50">
                    <td class="py-2 px-3 font-bold text-green-400">íƒ€ì´</td>
                    <td
                      id="adminTieBetAmount"
                      class="py-2 px-3 text-right font-mono"
                    >
                      0 ì›
                    </td>
                    <td
                      id="adminTieBetCount"
                      class="py-2 px-3 text-right font-mono"
                    >
                      0ëª…
                    </td>
                  </tr>
                  <!-- Player Pair -->
                  <tr class="hover:bg-gray-800/50">
                    <td class="py-2 px-3 font-bold text-sky-400">P í˜ì–´</td>
                    <td
                      id="adminPlayerPairBetAmount"
                      class="py-2 px-3 text-right font-mono"
                    >
                      0 ì›
                    </td>
                    <td
                      id="adminPlayerPairBetCount"
                      class="py-2 px-3 text-right font-mono"
                    >
                      0ëª…
                    </td>
                  </tr>
                  <!-- Banker Pair -->
                  <tr class="hover:bg-gray-800/50">
                    <td class="py-2 px-3 font-bold text-pink-400">B í˜ì–´</td>
                    <td
                      id="adminBankerPairBetAmount"
                      class="py-2 px-3 text-right font-mono"
                    >
                      0 ì›
                    </td>
                    <td
                      id="adminBankerPairBetCount"
                      class="py-2 px-3 text-right font-mono"
                    >
                      0ëª…
                    </td>
                  </tr>
                </tbody>
                <tfoot class="bg-gray-700">
                  <tr>
                    <td class="py-2 px-3 font-bold">ì´ê³„</td>
                    <td
                      id="adminTotalBetAmount"
                      class="py-2 px-3 text-right font-bold font-mono"
                    >
                      0 ì›
                    </td>
                    <td
                      id="adminTotalBetCount"
                      class="py-2 px-3 text-right font-bold font-mono"
                    >
                      0ëª…
                    </td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>
        </div>

        <!-- ë¦¬ë”ë³´ë“œ (ê°€ìš´ë°) -->
        <div class="bg-gray-800 p-3 md:p-4 rounded-lg shadow">
          <h3 class="text-lg font-semibold mb-4 text-purple-400">ë¦¬ë”ë³´ë“œ</h3>
          <div
            class="bg-gray-900 rounded-lg overflow-hidden border border-gray-700"
          >
            <div class="max-h-[800px] overflow-y-auto custom-scrollbar">
              <table class="min-w-full text-sm">
                <thead class="bg-gray-700 sticky top-0">
                  <tr>
                    <th class="py-2 px-3 text-left">ìˆœìœ„</th>
                    <th class="py-2 px-3 text-left">ì‚¬ìš©ì</th>
                    <th class="py-2 px-3 text-right">ë³´ìœ ì•¡</th>
                    <th class="py-2 px-3 text-right">ìŠ¹ë¥ </th>
                    <th class="py-2 px-3 text-right">ì´ ë² íŒ…</th>
                  </tr>
                </thead>
                <tbody id="leaderboardTable" class="divide-y divide-gray-700">
                  <!-- ë¦¬ë”ë³´ë“œ ëª©ë¡ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- ìµœê·¼ ê²Œì„ ê¸°ë¡ (ì˜¤ë¥¸ìª½) -->
        <div class="bg-gray-800 p-3 md:p-4 rounded-lg shadow">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold text-purple-400">ê²Œì„ ê¸°ë¡</h3>
            <button
              onclick="resetGameHistory()"
              class="bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-sm font-medium transition-colors"
            >
              ì´ˆê¸°í™”
            </button>
          </div>

          <!-- ê²°ê³¼ íŒ¨í„´ -->
          <!-- ê²Œì„ ê²°ê³¼ í‘œì‹œ ì„¹ì…˜ -->
          <div
            id="gameResultDisplay"
            class="mb-4 bg-gray-900 p-3 rounded-lg border border-gray-700"
          >
            <h4 class="text-base font-semibold mb-2 text-gray-300">
              ê²Œì„ ê²°ê³¼
            </h4>
            <div class="grid grid-cols-1 gap-2">
              <div>
                <h5 class="text-sm font-semibold mb-1 text-blue-400">
                  í”Œë ˆì´ì–´
                </h5>
                <div id="playerCards" class="mb-1 text-gray-500 text-sm">
                  ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤
                </div>
                <div id="playerScore" class="text-sm font-bold"></div>
              </div>
              <div>
                <h5 class="text-sm font-semibold mb-1 text-red-400">ë±…ì»¤</h5>
                <div id="bankerCards" class="mb-1 text-gray-500 text-sm">
                  ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤
                </div>
                <div id="bankerScore" class="text-sm font-bold"></div>
              </div>
            </div>
            <div class="mt-2">
              <div
                id="gameWinner"
                class="text-base font-bold text-center mb-1 text-gray-500"
              >
                ê²Œì„ ê²°ê³¼ ëŒ€ê¸° ì¤‘...
              </div>
              <div
                id="pairResults"
                class="text-center text-sm text-gray-400"
              ></div>
            </div>
          </div>
          <div class="bg-gray-900 p-3 rounded-lg mb-4 border border-gray-700">
            <div class="flex justify-between items-center mb-2">
              <h4 class="text-base font-semibold text-gray-300">íŒ¨í„´</h4>
              <!-- ê°„ë‹¨í•œ í†µê³„ (ì˜¤ë¥¸ìª½) -->
              <div class="flex items-center gap-3 text-sm">
                <span class="text-blue-400 font-semibold"
                  >P: <span id="playerWins">0</span></span
                >
                <span class="text-red-400 font-semibold"
                  >B: <span id="bankerWins">0</span></span
                >
                <span class="text-green-400 font-semibold"
                  >T: <span id="tieWins">0</span></span
                >
              </div>
            </div>
            <div class="grid grid-cols-6 gap-1" id="recentResults">
              <!-- ìµœê·¼ ê²°ê³¼ê°€ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
          </div>

          <!-- ê°„ë‹¨í•œ ê¸°ë¡ í…Œì´ë¸” -->
          <div
            class="bg-gray-900 rounded-lg overflow-hidden border border-gray-700 mb-4"
          >
            <div class="overflow-x-auto max-h-[300px] custom-scrollbar">
              <table class="min-w-full text-sm">
                <thead class="bg-gray-700 sticky top-0 z-10">
                  <tr>
                    <th class="py-2 px-3 text-left">#</th>
                    <th class="py-2 px-3 text-left">ê²°ê³¼</th>
                    <th class="py-2 px-3 text-right">ì¸ì›</th>
                  </tr>
                </thead>
                <tbody id="recentGamesTable" class="divide-y divide-gray-700">
                  <!-- ê²Œì„ ê¸°ë¡ì´ ì—¬ê¸° ì¶”ê°€ ë©ë‹ˆë‹¤ -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- ì‚¬ìš©ì ê´€ë¦¬ ì„¹ì…˜ ìˆ˜ì • -->
      <div class="mb-4 md:mb-6 bg-gray-800 p-3 md:p-6 rounded-lg shadow">
        <h1 class="text-2xl font-semibold mb-4 text-purple-400">ì‚¬ìš©ì ê´€ë¦¬</h1>

        <div class="max-h-[400px] overflow-y-auto custom-scrollbar">
          <table class="min-w-full bg-gray-900 rounded-lg text-sm">
            <thead class="bg-gray-800 sticky top-0">
              <tr>
                <th class="py-3 px-4 text-left">ì‚¬ìš©ì</th>
                <th class="py-3 px-4 text-left">ìƒíƒœ</th>
                <th class="py-3 px-4 text-right">ì”ì•¡</th>
                <th class="py-3 px-4 text-right">ì†ìµ</th>
                <th class="py-3 px-4 text-left">ê²Œì„ ê¸°ë¡</th>
                <th class="py-3 px-4 text-center">ê´€ë¦¬</th>
              </tr>
            </thead>
            <tbody id="userTable">
              <!-- ì‚¬ìš©ì ëª©ë¡ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- ì¶©ì „ ë° í™˜ì „ ê´€ë¦¬ ì„¹ì…˜ -->
      <div class="mb-4 md:mb-6 bg-gray-800 p-3 md:p-6 rounded-lg shadow">
        <h1 class="text-2xl font-semibold mb-4 text-purple-400">ì¶©ì „ & í™˜ì „</h1>

        <!-- ì¬ì • ìš”ì•½ -->
        <div class="mb-6">
          <h3 class="text-lg font-semibold mb-3 text-gray-300">ì¬ì • ìš”ì•½</h3>
          <div
            class="bg-gray-900 rounded-lg overflow-hidden border border-gray-700"
          >
            <div class="max-h-[400px] overflow-y-auto custom-scrollbar">
              <table class="min-w-full text-sm">
                <thead class="bg-gray-700 sticky top-0">
                  <tr>
                    <th class="py-3 px-4 text-left">ì‚¬ìš©ì</th>
                    <th class="py-3 px-4 text-right">í˜„ì¬ ì”ì•¡</th>
                    <th class="py-3 px-4 text-right">ì´ ì¶©ì „ì•¡</th>
                    <th class="py-3 px-4 text-right">ì´ í™˜ì „ì•¡</th>
                    <th class="py-3 px-4 text-right">ì†ìµ</th>
                    <th class="py-3 px-4 text-center">ê´€ë¦¬</th>
                  </tr>
                </thead>
                <tbody
                  id="financialSummaryTable"
                  class="divide-y divide-gray-700"
                >
                  <!-- ì¬ì • ìš”ì•½ ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- ì¶©ì „ ìš”ì²­ -->
        <div class="mb-6">
          <h3 class="text-lg font-semibold mb-3 text-gray-300">ì¶©ì „ ìš”ì²­</h3>
          <div
            class="bg-gray-900 rounded-lg overflow-hidden border border-gray-700"
          >
            <div class="max-h-[400px] overflow-y-auto custom-scrollbar">
              <table class="min-w-full text-sm">
                <thead class="bg-gray-700 sticky top-0">
                  <tr>
                    <th class="py-3 px-4 text-left">ì‹ ì²­ì‹œê°„</th>
                    <th class="py-3 px-4 text-left">ì‚¬ìš©ì</th>
                    <th class="py-3 px-4 text-right">ì‹ ì²­ê¸ˆì•¡</th>
                    <th class="py-3 px-4 text-center">ìƒíƒœ</th>
                    <th class="py-3 px-4 text-center">ê´€ë¦¬</th>
                  </tr>
                </thead>
                <tbody
                  id="depositRequestsTable"
                  class="divide-y divide-gray-700"
                >
                  <!-- ì¶©ì „ ìš”ì²­ ëª©ë¡ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- í™˜ì „ ìš”ì²­ -->
        <div>
          <h3 class="text-lg font-semibold mb-3 text-gray-300">í™˜ì „ ìš”ì²­</h3>
          <div
            class="bg-gray-900 rounded-lg overflow-hidden border border-gray-700"
          >
            <div class="max-h-[400px] overflow-y-auto custom-scrollbar">
              <table class="min-w-full text-sm">
                <thead class="bg-gray-700 sticky top-0">
                  <tr>
                    <th class="py-3 px-4 text-left">ì‹ ì²­ì‹œê°„</th>
                    <th class="py-3 px-4 text-left">ì‚¬ìš©ì</th>
                    <th class="py-3 px-4 text-right">ì‹ ì²­ê¸ˆì•¡</th>
                    <th class="py-3 px-4 text-right">ì‹¤ìˆ˜ë ¹ì•¡</th>
                    <th class="py-3 px-4 text-center">ìƒíƒœ</th>
                    <th class="py-3 px-4 text-center">ê´€ë¦¬</th>
                  </tr>
                </thead>
                <tbody
                  id="exchangeRequestsTable"
                  class="divide-y divide-gray-700"
                >
                  <!-- í™˜ì „ ìš”ì²­ ëª©ë¡ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- í•˜ìš°ìŠ¤ í†µê³„ ì„¹ì…˜ -->
      <div class="mb-4 md:mb-6 bg-gray-800 p-3 md:p-6 rounded-lg shadow">
        <h1 class="text-2xl font-semibold mb-4 text-purple-400">í•˜ìš°ìŠ¤ í†µê³„</h1>

        <!-- ì „ì²´ í†µê³„ ìš”ì•½ -->
        <div class="mb-6">
          <h3 class="text-lg font-semibold mb-3 text-gray-300">ì „ì²´ í†µê³„</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
            <div class="bg-gray-900 p-4 rounded-lg border border-gray-700">
              <div class="text-center">
                <div
                  class="text-2xl font-bold text-yellow-400"
                  id="totalBetAmount"
                >
                  0ì›
                </div>
                <div class="text-sm text-gray-400">ì´ ë² íŒ…ì•¡</div>
              </div>
            </div>
            <div class="bg-gray-900 p-4 rounded-lg border border-gray-700">
              <div class="text-center">
                <div
                  class="text-2xl font-bold text-blue-400"
                  id="totalWinAmount"
                >
                  0ì›
                </div>
                <div class="text-sm text-gray-400">ì´ ì§€ê¸‰ì•¡</div>
              </div>
            </div>
            <div class="bg-gray-900 p-4 rounded-lg border border-gray-700">
              <div class="text-center">
                <div class="text-xl font-bold" id="bettingHouseProfit">0ì›</div>
                <div class="text-sm text-gray-400">ë² íŒ… ìˆ˜ìµ</div>
              </div>
            </div>
            <div class="bg-gray-900 p-4 rounded-lg border border-gray-700">
              <div class="text-center">
                <div class="text-xl font-bold" id="realHouseProfit">0ì›</div>
                <div class="text-sm text-gray-400">ì‹¤ì œ ìˆœì´ìµ</div>
              </div>
            </div>
            <div class="bg-gray-900 p-4 rounded-lg border border-gray-700">
              <div class="text-center">
                <div
                  class="text-xl font-bold text-purple-400"
                  id="realProfitMargin"
                >
                  0%
                </div>
                <div class="text-sm text-gray-400">ì‹¤ì œ ìˆ˜ìµë¥ </div>
              </div>
            </div>
          </div>

          <!-- ì¶©ì „/í™˜ì „ í†µê³„ -->
          <div
            class="mt-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"
          >
            <div class="bg-gray-900 p-3 rounded-lg border border-gray-700">
              <div class="text-center">
                <div
                  class="text-lg font-bold text-green-400"
                  id="totalDepositAmount"
                >
                  0ì›
                </div>
                <div class="text-xs text-gray-400">ì´ ì¶©ì „ì•¡</div>
              </div>
            </div>
            <div class="bg-gray-900 p-3 rounded-lg border border-gray-700">
              <div class="text-center">
                <div
                  class="text-lg font-bold text-red-400"
                  id="totalExchangeAmount"
                >
                  0ì›
                </div>
                <div class="text-xs text-gray-400">ì´ í™˜ì „ì•¡</div>
              </div>
            </div>
            <div class="bg-gray-900 p-3 rounded-lg border border-gray-700">
              <div class="text-center">
                <div
                  class="text-lg font-bold text-orange-400"
                  id="totalExchangeFees"
                >
                  0ì›
                </div>
                <div class="text-xs text-gray-400">í™˜ì „ ìˆ˜ìˆ˜ë£Œ</div>
              </div>
            </div>
            <div class="bg-gray-900 p-3 rounded-lg border border-gray-700">
              <div class="text-center">
                <div
                  class="text-lg font-bold text-cyan-400"
                  id="totalUserBalance"
                >
                  0ì›
                </div>
                <div class="text-xs text-gray-400">ì‚¬ìš©ì ì”ì•¡</div>
              </div>
            </div>
          </div>
        </div>

        <!-- ê¸°ê°„ë³„ í†µê³„ -->
        <div class="mb-6">
          <h3 class="text-lg font-semibold mb-3 text-gray-300">ê¸°ê°„ë³„ í†µê³„</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- ì˜¤ëŠ˜ í†µê³„ -->
            <div class="bg-gray-900 p-4 rounded-lg border border-gray-700">
              <h4 class="text-md font-semibold mb-3 text-green-400">ì˜¤ëŠ˜</h4>
              <div class="space-y-2">
                <div class="flex justify-between">
                  <span class="text-gray-400">ë² íŒ…ì•¡:</span>
                  <span class="text-yellow-400 font-bold" id="todayBetAmount"
                    >0ì›</span
                  >
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-400">ì§€ê¸‰ì•¡:</span>
                  <span class="text-blue-400 font-bold" id="todayWinAmount"
                    >0ì›</span
                  >
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-400">ìˆœì´ìµ:</span>
                  <span class="font-bold" id="todayHouseProfit">0ì›</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-400">ë² íŒ… ìˆ˜:</span>
                  <span class="text-gray-300" id="todayBetCount">0íšŒ</span>
                </div>
              </div>
            </div>

            <!-- ì´ë²ˆ ì£¼ í†µê³„ -->
            <div class="bg-gray-900 p-4 rounded-lg border border-gray-700">
              <h4 class="text-md font-semibold mb-3 text-blue-400">ì´ë²ˆ ì£¼</h4>
              <div class="space-y-2">
                <div class="flex justify-between">
                  <span class="text-gray-400">ë² íŒ…ì•¡:</span>
                  <span class="text-yellow-400 font-bold" id="weekBetAmount"
                    >0ì›</span
                  >
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-400">ì§€ê¸‰ì•¡:</span>
                  <span class="text-blue-400 font-bold" id="weekWinAmount"
                    >0ì›</span
                  >
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-400">ìˆœì´ìµ:</span>
                  <span class="font-bold" id="weekHouseProfit">0ì›</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-400">ë² íŒ… ìˆ˜:</span>
                  <span class="text-gray-300" id="weekBetCount">0íšŒ</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ê²Œì„ ê²°ê³¼ í†µê³„ ë° ë² íŒ… ì„ íƒë³„ í†µê³„ -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
          <!-- ê²Œì„ ê²°ê³¼ í†µê³„ -->
          <div class="bg-gray-900 p-4 rounded-lg border border-gray-700">
            <h4 class="text-md font-semibold mb-3 text-purple-400">
              ê²Œì„ ê²°ê³¼ í†µê³„
            </h4>
            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-gray-400">ì´ ê²Œì„:</span>
                <span class="text-gray-300" id="totalGames">0íšŒ</span>
              </div>
              <div class="flex justify-between">
                <span class="text-blue-400">í”Œë ˆì´ì–´ ìŠ¹:</span>
                <span class="text-blue-400 font-bold" id="playerWinGames"
                  >0íšŒ</span
                >
              </div>
              <div class="flex justify-between">
                <span class="text-red-400">ë±…ì»¤ ìŠ¹:</span>
                <span class="text-red-400 font-bold" id="bankerWinGames"
                  >0íšŒ</span
                >
              </div>
              <div class="flex justify-between">
                <span class="text-green-400">íƒ€ì´:</span>
                <span class="text-green-400 font-bold" id="tieGames">0íšŒ</span>
              </div>
            </div>
          </div>

          <!-- ë² íŒ… ì„ íƒë³„ ìˆ˜ìµì„± -->
          <div class="bg-gray-900 p-4 rounded-lg border border-gray-700">
            <h4 class="text-md font-semibold mb-3 text-purple-400">
              ë² íŒ…ë³„ í•˜ìš°ìŠ¤ ìˆ˜ìµ
            </h4>
            <div class="space-y-2" id="betTypeStats">
              <!-- ë² íŒ… íƒ€ì…ë³„ í†µê³„ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
          </div>
        </div>

        <!-- ìƒìœ„ ê¸°ì—¬ ì‚¬ìš©ì -->
        <div class="mb-6">
          <h3 class="text-lg font-semibold mb-3 text-gray-300">
            í•˜ìš°ìŠ¤ ìˆ˜ìµ ê¸°ì—¬ TOP 10
          </h3>
          <div
            class="bg-gray-900 rounded-lg overflow-hidden border border-gray-700"
          >
            <div class="max-h-[300px] overflow-y-auto custom-scrollbar">
              <table class="min-w-full text-sm">
                <thead class="bg-gray-700 sticky top-0">
                  <tr>
                    <th class="py-3 px-4 text-left">ìˆœìœ„</th>
                    <th class="py-3 px-4 text-left">ì‚¬ìš©ì</th>
                    <th class="py-3 px-4 text-right">ì´ ë² íŒ…ì•¡</th>
                    <th class="py-3 px-4 text-right">ì´ ìˆ˜ìµ</th>
                    <th class="py-3 px-4 text-right">í•˜ìš°ìŠ¤ ê¸°ì—¬ë„</th>
                  </tr>
                </thead>
                <tbody
                  id="topContributorsTable"
                  class="divide-y divide-gray-700"
                >
                  <!-- ê¸°ì—¬ë„ ìƒìœ„ ì‚¬ìš©ì ëª©ë¡ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- ì „ì²´ ë² íŒ… ê¸°ë¡ ì„¹ì…˜ -->
      <div class="mb-4 md:mb-6 bg-gray-800 p-3 md:p-6 rounded-lg shadow">
        <h1 class="text-2xl font-semibold mb-4 text-purple-400">
          ì „ì²´ ë² íŒ… ê¸°ë¡
        </h1>
        <div
          class="bg-gray-900 rounded-lg overflow-hidden border border-gray-700"
        >
          <div class="max-h-[400px] overflow-y-auto custom-scrollbar">
            <table class="min-w-full text-sm">
              <thead class="bg-gray-700 sticky top-0">
                <tr>
                  <th class="py-3 px-4 text-left">ì‹œê°„</th>
                  <th class="py-3 px-4 text-left">ì‚¬ìš©ì</th>
                  <th class="py-3 px-4 text-center">ì„ íƒ</th>
                  <th class="py-3 px-4 text-right">ë² íŒ…ì•¡</th>
                  <th class="py-3 px-4 text-center">ê²°ê³¼</th>
                  <th class="py-3 px-4 text-center">
                    <button
                      id="showFixPanelBtn"
                      class="hover:text-gray-300 text-sm px-2 py-1"
                      onclick="toggleFixPanel()"
                      title="ê³ ê¸‰ ì˜µì…˜"
                    >
                      ê´€ë¦¬
                    </button>
                  </th>
                </tr>
              </thead>
              <tbody
                id="allBettingHistoryTable"
                class="divide-y divide-gray-700"
              >
                <!-- ë² íŒ… ê¸°ë¡ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ìŠ¹ë¶€ ì¡°ì‘ íŒ¨ë„ ëª¨ë‹¬ -->
      <div
        id="fixPanelModal"
        class="fixed inset-0 bg-black bg-opacity-80 z-50 hidden backdrop-blur-sm"
        onclick="closeFixPanelOnOutsideClick(event)"
      >
        <div
          class="fixed bottom-0 left-0 right-0 bg-gradient-to-t from-gray-900 to-gray-800 rounded-t-2xl border-t border-gray-600 p-6"
          onclick="event.stopPropagation()"
        >
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-bold text-white">ê³ ê¸‰ ê²Œì„ ì„¤ì •</h3>
            <button
              id="closeFixPanel"
              class="text-gray-400 hover:text-white"
              onclick="toggleFixPanel()"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-6 w-6"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M6 18L18 6M6 6l12 12"
                />
              </svg>
            </button>
          </div>

          <div class="space-y-4">
            <!-- íŒ¨í„´ ì„ íƒ -->
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">
                ê²Œì„ íŒ¨í„´ ì„ íƒ
              </label>
              <select
                id="patternSelect"
                class="w-full bg-gray-700 text-white px-3 py-2 rounded border border-gray-600 focus:border-blue-500 focus:outline-none"
              >
                <option value="1">íŒ¨í„´ 1 - ë‚´ì¶”ëŸ´ ìŠ¹ë¶€ (9 vs 8)</option>
                <option value="2">íŒ¨í„´ 2 - ì—­ì „ìŠ¹/ë±…ì»¤ë£° ìŠ¹ë¶€</option>
                <option value="3">íŒ¨í„´ 3 - ê°„ë°œì˜ ì°¨ì´/ì••ë„ì  ìŠ¹ë¶€</option>
              </select>
            </div>

            <!-- ê²°ê³¼ ì„ íƒ ë²„íŠ¼ë“¤ -->
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">
                ê²Œì„ ê²°ê³¼ ì„¤ì •
              </label>
              <div class="grid grid-cols-3 gap-3">
                <button
                  id="fixPlayerBtn"
                  class="bg-gray-700 hover:bg-blue-600 text-white py-3 px-4 rounded-lg transition-colors font-medium"
                  onclick="fixGameResult('player')"
                >
                  <div class="text-lg">ğŸ”µ</div>
                  <div class="text-sm">í”Œë ˆì´ì–´</div>
                </button>
                <button
                  id="fixBankerBtn"
                  class="bg-gray-700 hover:bg-red-600 text-white py-3 px-4 rounded-lg transition-colors font-medium"
                  onclick="fixGameResult('banker')"
                >
                  <div class="text-lg">ğŸ”´</div>
                  <div class="text-sm">ë±…ì»¤</div>
                </button>
                <button
                  id="fixTieBtn"
                  class="bg-gray-700 hover:bg-green-600 text-white py-3 px-4 rounded-lg transition-colors font-medium"
                  onclick="fixGameResult('tie')"
                >
                  <div class="text-lg">ğŸŸ¢</div>
                  <div class="text-sm">íƒ€ì´</div>
                </button>
              </div>
            </div>

            <!-- í˜„ì¬ ìƒíƒœ í‘œì‹œ -->
            <div
              id="fixStatusDisplay"
              class="text-center text-sm text-gray-400 hidden"
            >
              <div class="bg-gray-800 rounded-lg p-3">
                <span id="fixStatusText">ì„¤ì •ëœ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</span>
              </div>
            </div>

            <!-- ì£¼ì˜ì‚¬í•­ -->
            <div
              class="text-xs text-gray-500 text-center bg-gray-800 rounded-lg p-3"
            >
              âš ï¸ ì´ ê¸°ëŠ¥ì€ ë² íŒ…ì´ í™œì„±í™”ëœ ìƒíƒœì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
            </div>
          </div>
        </div>
      </div>

      <!-- ì‚¬ìš©ì ìƒì„¸ì •ë³´ ëª¨ë‹¬ -->
      <div
        id="userDetailModal"
        class="fixed inset-0 bg-black bg-opacity-80 z-50 hidden backdrop-blur-sm"
      >
        <div
          class="fixed inset-x-0 bottom-0 bg-gradient-to-b from-[#2a2a2a] to-[#1a1a1a] rounded-t-2xl max-h-[85vh] border-t border-[#b8860b] flex flex-col"
        >
          <!-- ê³ ì • í—¤ë” -->
          <div
            class="flex-shrink-0 bg-gradient-to-b from-[#2a2a2a] to-[#1a1a1a] p-4 border-b border-[#b8860b] rounded-t-2xl"
          >
            <div class="flex justify-between items-center mb-4">
              <h2
                class="text-xl font-bold text-yellow-500"
                style="text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5)"
              >
                <span id="detailUsername">ì‚¬ìš©ì</span> ìƒì„¸ì •ë³´
              </h2>
              <button
                id="closeUserDetail"
                class="text-yellow-500 hover:text-yellow-400"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-6 w-6"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"
                  />
                </svg>
              </button>
            </div>

            <!-- íƒ­ ë©”ë‰´ -->
            <div class="flex space-x-1 bg-black bg-opacity-50 rounded-lg p-1">
              <button
                id="detailOverviewTab"
                class="flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors bg-purple-600 text-white"
              >
                ê°œìš”
              </button>
              <button
                id="detailBettingTab"
                class="flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors text-gray-400 hover:text-yellow-500"
              >
                ë² íŒ… ë¶„ì„
              </button>
              <button
                id="detailFinancialTab"
                class="flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors text-gray-400 hover:text-yellow-500"
              >
                ì¬ì • í˜„í™©
              </button>
            </div>
          </div>

          <!-- ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ ì»¨í…ì¸  ì˜ì—­ -->
          <div class="flex-1 overflow-y-auto custom-scrollbar">
            <!-- ê°œìš” íƒ­ -->
            <div id="detailOverviewContent" class="p-4 space-y-4">
              <!-- ê²Œì„ í†µê³„ ìš”ì•½ -->
              <div
                class="bg-black bg-opacity-50 p-4 rounded-lg border border-[#b8860b]"
              >
                <h3 class="text-lg font-bold text-yellow-500 mb-3">
                  ê²Œì„ í†µê³„
                </h3>
                <div class="grid grid-cols-2 gap-3 mb-4">
                  <div
                    class="bg-black bg-opacity-30 p-3 rounded-lg text-center"
                  >
                    <div
                      class="text-2xl font-bold text-green-400"
                      id="detailUserWins"
                    >
                      0
                    </div>
                    <div class="text-xs text-gray-400">ìŠ¹ë¦¬</div>
                  </div>
                  <div
                    class="bg-black bg-opacity-30 p-3 rounded-lg text-center"
                  >
                    <div
                      class="text-2xl font-bold text-red-400"
                      id="detailUserLoses"
                    >
                      0
                    </div>
                    <div class="text-xs text-gray-400">íŒ¨ë°°</div>
                  </div>
                  <div
                    class="bg-black bg-opacity-30 p-3 rounded-lg text-center"
                  >
                    <div
                      class="text-lg font-bold text-yellow-500"
                      id="detailUserWinRate"
                    >
                      0%
                    </div>
                    <div class="text-xs text-gray-400">ìŠ¹ë¥ </div>
                  </div>
                  <div
                    class="bg-black bg-opacity-30 p-3 rounded-lg text-center"
                  >
                    <div
                      class="text-lg font-bold text-blue-400"
                      id="detailTotalGames"
                    >
                      0
                    </div>
                    <div class="text-xs text-gray-400">ì´ ê²Œì„</div>
                  </div>
                </div>

                <!-- ë² íŒ… ì†ìµ ìš”ì•½ -->
                <div class="bg-black bg-opacity-30 p-3 rounded-lg">
                  <div class="flex justify-between items-center">
                    <span class="text-gray-400 font-medium">ë² íŒ… ìˆœì†ìµ:</span>
                    <span
                      class="font-bold text-lg"
                      id="detailGameStatsBettingProfit"
                      >0ì›</span
                    >
                  </div>
                  <div class="text-xs text-gray-500 text-center mt-1">
                    * ë² íŒ…ìœ¼ë¡œ ì¸í•œ ìˆœìˆ˜ìµ/ì†ì‹¤
                  </div>
                </div>
              </div>

              <!-- ì „ì²´ ì†ìµ ìš”ì•½ -->
              <div
                class="bg-black bg-opacity-50 p-4 rounded-lg border border-[#b8860b]"
              >
                <h3 class="text-lg font-bold text-yellow-500 mb-3">
                  ì „ì²´ ì†ìµ
                </h3>
                <div class="space-y-3">
                  <div class="flex justify-between items-center">
                    <span class="text-gray-400">í˜„ì¬ ì”ì•¡:</span>
                    <span
                      class="text-yellow-500 font-bold text-lg"
                      id="detailCurrentBalance"
                      >0ì›</span
                    >
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-gray-400">ì´ ì†ìµ:</span>
                    <span class="font-bold text-lg" id="detailOverallProfit"
                      >0ì›</span
                    >
                  </div>
                  <div class="text-xs text-gray-500 text-center">
                    * ì´ ì†ìµ = í˜„ì¬ ì”ì•¡ + ì´ í™˜ì „ì•¡ - ì´ ì¶©ì „ì•¡
                  </div>
                </div>
              </div>
            </div>

            <!-- ë² íŒ… ë¶„ì„ íƒ­ -->
            <div id="detailBettingContent" class="p-4 space-y-4 hidden">
              <!-- ë² íŒ… í†µê³„ -->
              <div
                class="bg-black bg-opacity-50 p-4 rounded-lg border border-[#b8860b]"
              >
                <h3 class="text-lg font-bold text-yellow-500 mb-3">
                  ë² íŒ… í†µê³„
                </h3>
                <div class="space-y-2">
                  <div class="flex justify-between">
                    <span class="text-gray-400">ì´ ë² íŒ… ê¸ˆì•¡:</span>
                    <span
                      class="text-yellow-500 font-bold"
                      id="detailModalTotalBetAmount"
                      >0ì›</span
                    >
                  </div>
                  <div class="flex justify-between">
                    <span class="text-gray-400">ì´ ìˆ˜ìµ ê¸ˆì•¡:</span>
                    <span
                      class="text-green-400 font-bold"
                      id="detailModalTotalWinAmount"
                      >0ì›</span
                    >
                  </div>
                  <div class="flex justify-between">
                    <span class="text-gray-400">ë² íŒ… ì†ìµ:</span>
                    <span class="font-bold" id="detailModalBettingProfit"
                      >0ì›</span
                    >
                  </div>
                  <div class="flex justify-between">
                    <span class="text-gray-400">í‰ê·  ë² íŒ…ì•¡:</span>
                    <span
                      class="text-blue-400 font-bold"
                      id="detailModalAverageBetAmount"
                      >0ì›</span
                    >
                  </div>
                </div>
              </div>

              <!-- ë² íŒ… ì„ í˜¸ë„ -->
              <div
                class="bg-black bg-opacity-50 p-4 rounded-lg border border-[#b8860b]"
              >
                <h3 class="text-lg font-bold text-yellow-500 mb-3">
                  ë² íŒ… ì„ í˜¸ë„
                </h3>
                <div class="space-y-2" id="detailChoicePreferences">
                  <!-- ì„ í˜¸ë„ ì°¨íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
                <div
                  class="mt-3 p-2 bg-black bg-opacity-30 rounded text-center"
                >
                  <span class="text-gray-400 text-sm"
                    >ê°€ì¥ ì„ í˜¸í•˜ëŠ” ë² íŒ…:
                  </span>
                  <span
                    class="text-yellow-500 font-bold"
                    id="detailFavoriteChoice"
                    >-</span
                  >
                </div>
              </div>

              <!-- ë¡¤ë§ ì •ë³´ -->
              <div
                class="bg-black bg-opacity-50 p-4 rounded-lg border border-[#b8860b]"
              >
                <h3 class="text-lg font-bold text-yellow-500 mb-3">
                  ë¡¤ë§ í˜„í™©
                </h3>
                <div class="space-y-3">
                  <div class="flex justify-between">
                    <span class="text-gray-400">ë¡¤ë§ ë‹¬ì„±ë¥ :</span>
                    <span
                      class="text-yellow-500 font-bold"
                      id="detailRollingProgressTextInfo"
                      >0%</span
                    >
                  </div>
                  <div class="w-full bg-gray-700 rounded-full h-2.5">
                    <div
                      id="detailRollingProgressBarInfo"
                      class="bg-yellow-500 h-2.5 rounded-full"
                      style="width: 0%"
                    ></div>
                  </div>
                  <div class="flex justify-between text-sm">
                    <span class="text-gray-400"
                      >ë² íŒ…ì•¡:
                      <span id="detailRollingWageredAmount">0ì›</span></span
                    >
                    <span class="text-gray-400"
                      >ëª©í‘œ:
                      <span id="detailRollingRequiredAmount">0ì›</span></span
                    >
                  </div>
                </div>
              </div>
            </div>

            <!-- ì¬ì • í˜„í™© íƒ­ -->
            <div id="detailFinancialContent" class="p-4 space-y-4 hidden">
              <!-- ì¶©ì „/í™˜ì „ í†µê³„ -->
              <div
                class="bg-black bg-opacity-50 p-4 rounded-lg border border-[#b8860b]"
              >
                <h3 class="text-lg font-bold text-yellow-500 mb-3">
                  ì¶©ì „/í™˜ì „ í†µê³„
                </h3>
                <div class="grid grid-cols-2 gap-4">
                  <div
                    class="bg-black bg-opacity-30 p-3 rounded-lg text-center"
                  >
                    <div
                      class="text-lg font-bold text-blue-400"
                      id="detailTotalDeposited"
                    >
                      0ì›
                    </div>
                    <div class="text-xs text-gray-400">ì´ ì¶©ì „ì•¡</div>
                    <div class="text-xs text-gray-500 mt-1">
                      (<span id="detailDepositCount">0</span>íšŒ)
                    </div>
                  </div>
                  <div
                    class="bg-black bg-opacity-30 p-3 rounded-lg text-center"
                  >
                    <div
                      class="text-lg font-bold text-orange-400"
                      id="detailTotalExchanged"
                    >
                      0ì›
                    </div>
                    <div class="text-xs text-gray-400">ì´ í™˜ì „ì•¡</div>
                    <div class="text-xs text-gray-500 mt-1">
                      (<span id="detailExchangeCount">0</span>íšŒ)
                    </div>
                  </div>
                </div>
              </div>

              <!-- ìµœê·¼ ê±°ë˜ ë‚´ì—­ -->
              <div
                class="bg-black bg-opacity-50 p-4 rounded-lg border border-[#b8860b]"
              >
                <h3 class="text-lg font-bold text-yellow-500 mb-3">
                  ìµœê·¼ ê±°ë˜ ë‚´ì—­
                </h3>
                <div
                  class="space-y-2 max-h-60 overflow-y-auto custom-scrollbar"
                  id="detailRecentTransactions"
                >
                  <!-- ìµœê·¼ ê±°ë˜ ë‚´ì—­ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- í† ìŠ¤íŠ¸ ë©”ì‹œì§€ -->
      <div id="toast" class="toast">ë©”ì‹œì§€ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
    </div>

    <script>
      const token = localStorage.getItem("token");

      // í† í° ìœ íš¨ì„± ê²€ì‚¬ í•¨ìˆ˜
      async function validateToken() {
        if (!token) {
          console.log("í† í°ì´ ì—†ìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.");
          window.location.href = "index.html";
          return false;
        }

        try {
          // ê°„ë‹¨í•œ API í˜¸ì¶œë¡œ í† í° ìœ íš¨ì„± ê²€ì‚¬
          const res = await fetch(
            "https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/auth/user-info",
            {
              headers: { Authorization: `Bearer ${token}` },
            }
          );

          if (res.status === 401 || res.status === 403) {
            console.log(
              "í† í°ì´ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤."
            );
            localStorage.removeItem("token");
            window.location.href = "index.html";
            return false;
          }

          return true;
        } catch (err) {
          console.error("í† í° ê²€ì¦ ì¤‘ ì˜¤ë¥˜:", err);
          // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ëŠ” í† í° ë¬¸ì œê°€ ì•„ë‹ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ê³„ì† ì§„í–‰
          return true;
        }
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ í† í° ê²€ì¦
      validateToken();

      // ì¸ì¦ ì˜¤ë¥˜ ì²˜ë¦¬ í•¨ìˆ˜
      function handleAuthError() {
        console.log("ì¸ì¦ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
        localStorage.removeItem("token");
        showToast("ë¡œê·¸ì¸ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.", "error");
        setTimeout(() => {
          window.location.href = "index.html";
        }, 2000);
      }

      let socket = io(
        "https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app"
      );
      let bettingActive = false; // ë² íŒ… ìƒíƒœ ì¶”ì 

      // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
      function showToast(message, type = "default") {
        const toast = document.getElementById("toast");
        toast.textContent = message;

        // ê¸°ì¡´ íƒ€ì… í´ë˜ìŠ¤ ì œê±°
        toast.classList.remove("toast-info", "toast-success", "toast-error");

        // íƒ€ì…ë³„ ìŠ¤íƒ€ì¼ ì ìš©
        if (type === "info") {
          toast.classList.add("toast-info");
        } else if (type === "success") {
          toast.classList.add("toast-success");
        } else if (type === "error") {
          toast.classList.add("toast-error");
        }

        toast.classList.add("show");
        setTimeout(() => {
          toast.classList.remove("show");
        }, 3000);
      }

      // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ì„ ìœ„í•œ ìš”ì²­
      async function fetchUsers() {
        try {
          const res = await fetch(
            "https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/users-stats",
            {
              headers: { Authorization: `Bearer ${token}` },
            }
          );

          if (res.status === 403 || res.status === 401) {
            handleAuthError();
            return;
          }

          const stats = await res.json();
          const userTable = document.getElementById("userTable");
          userTable.innerHTML = "";

          stats.forEach((user, index) => {
            const tr = document.createElement("tr");
            tr.classList.add("text-center");
            tr.innerHTML = `
                <td class="py-2">${user.username}</td>
                <td class="py-2">${user.balance} ì›</td>
                <td class="py-2">${user.role}</td>
                <td class="py-2">${user.isApproved ? "ìŠ¹ì¸ë¨" : "ëŒ€ê¸° ì¤‘"}</td>
                <td class="py-2">${user.wins}</td>
                <td class="py-2">${user.losses}</td>
                <td class="py-2">${user.totalBets}</td>
                <td class="py-2">${user.winRate}</td>
                <td class="py-2">${user.profit} ì›</td>
                <td class="py-2">
                    ${
                      !user.isApproved
                        ? `<button data-id="${user.id}" class="approve-user bg-purple-500 text-white px-2 py-1 rounded mr-2">ìŠ¹ì¸</button>`
                        : ""
                    }
                    <button data-id="${
                      user.id
                    }" class="reset-password bg-yellow-500 text-white px-2 py-1 rounded mr-2">ë¹„ë²ˆ ì´ˆê¸°í™”</button>
                    <button data-id="${
                      user.id
                    }" class="delete-user bg-red-500 text-white px-2 py-1 rounded mr-2">ì‚­ì œ</button>
                    ${
                      user.role !== "superadmin"
                        ? `
                    <button 
                      onclick="toggleAdmin('${user._id}', '${user.role}')"
                      class="${
                        user.role === "admin"
                          ? "bg-gray-600 hover:bg-gray-700"
                          : "bg-purple-600 hover:bg-purple-700"
                      } text-white px-2.5 py-1.5 rounded text-sm font-medium transition-colors"
                    >
                      ${user.role === "admin" ? "ê´€ë¦¬ì í•´ì œ" : "ê´€ë¦¬ì ì§€ì •"}
                    </button>
                  `
                        : ""
                    }
                    <button data-id="${
                      user.id
                    }" class="adjust-coins bg-yellow-600 hover:bg-yellow-700 text-white px-2.5 py-1.5 rounded text-sm font-medium transition-colors"
                    >
                      ì”ì•¡ ì¡°ì ˆ
                    </button>
                    
            `;
            userTable.appendChild(tr);
          });

          // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
          document.querySelectorAll(".approve-user").forEach((button) => {
            button.addEventListener("click", function () {
              const userId = this.getAttribute("data-id");
              approveUser(userId);
            });
          });
          document.querySelectorAll(".delete-user").forEach((button) => {
            button.addEventListener("click", function () {
              const userId = this.getAttribute("data-id");
              deleteUser(userId);
            });
          });
          document.querySelectorAll(".reset-password").forEach((button) => {
            button.addEventListener("click", function () {
              const userId = this.getAttribute("data-id");
              resetPassword(userId);
            });
          });
          document.querySelectorAll(".toggle-admin").forEach((button) => {
            button.addEventListener("click", function () {
              const userId = this.getAttribute("data-id");
              const currentRole = this.getAttribute("data-role");
              toggleAdmin(userId, currentRole);
            });
          });
          document.querySelectorAll(".adjust-coins").forEach((button) => {
            button.addEventListener("click", function () {
              const userId = this.getAttribute("data-id");
              adjustCoins(userId);
            });
          });
          document.querySelectorAll(".view-betting").forEach((button) => {
            button.addEventListener("click", viewBettingDetails);
          });
        } catch (err) {}
      }

      async function approveUser(userId) {
        if (!confirm("ì´ ì‚¬ìš©ìë¥¼ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

        try {
          const res = await fetch(
            `https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/users/${userId}/approve`,
            {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`,
              },
            }
          );

          const data = await res.json();

          if (res.ok) {
            showToast(data.message);
            fetchUsers(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          } else {
            showToast(data.message || "ì‚¬ìš©ì ìŠ¹ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          }
        } catch (err) {
          showToast("ì„œë²„ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      async function deleteUser(userId) {
        if (!confirm("ì •ë§ë¡œ ì´ ì‚¬ìš©ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

        try {
          const res = await fetch(
            `https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/users/${userId}`,
            {
              method: "DELETE",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`,
              },
            }
          );

          const data = await res.json();

          if (res.ok) {
            showToast(data.message);
            fetchUsers(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          } else {
            showToast(data.message || "ì‚¬ìš©ì ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          }
        } catch (err) {
          showToast("ì„œë²„ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      async function resetPassword(e) {
        const userId = e.target.getAttribute("data-id");
        const newPassword = prompt("ìƒˆ ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
        if (newPassword) {
          try {
            const res = await fetch(
              `https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/users/${userId}/reset-password`,
              {
                method: "PUT",
                headers: {
                  "Content-Type": "application/json",
                  Authorization: `Bearer ${token}`,
                },
                body: JSON.stringify({ newPassword }),
              }
            );
            const data = await res.json();
            showToast(data.message);
          } catch (err) {}
        }
      }

      async function toggleAdmin(userId, currentRole) {
        const isAdmin = currentRole === "admin";
        const action = isAdmin ? "í•´ì œ" : "ì§€ì •";

        if (!confirm(`ì´ ì‚¬ìš©ìë¥¼ ê´€ë¦¬ìì„œ ${action}í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

        try {
          const res = await fetch(
            `https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/users/${userId}/toggle-admin`,
            {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`,
              },
              body: JSON.stringify({ setAdmin: !isAdmin }),
            }
          );

          if (res.ok) {
            showToast(`ê´€ë¦¬ìê°€ ${action}ë˜ì—ˆë‹ˆë‹¤.`);
            fetchUsers();
          } else {
            showToast(`ê´€ë¦¬ì ${action}ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.`);
          }
        } catch (err) {
          showToast("ì„œë²„ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ì‹¤ì‹œê°„ ë² íŒ… í˜„í™© ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ëŒ€ëŒ€ì  ê°œì„ )
      function updateBettingStats(stats) {
        const betTypes = {
          player: "Player",
          banker: "Banker",
          tie: "Tie",
          player_pair: "PlayerPair",
          banker_pair: "BankerPair",
        };

        let totalBetAmount = 0;
        let totalBetCount = 0;

        // ë¨¼ì € ì´ ë² íŒ…ì•¡ì„ ê³„ì‚°
        for (const type in betTypes) {
          totalBetAmount += stats[type]?.total_bet_amount || 0;
          totalBetCount += stats[type]?.bettor_count || 0;
        }

        // ê° ë² íŒ… íƒ€ì…ì— ëŒ€í•´ UI ì—…ë°ì´íŠ¸
        for (const type in betTypes) {
          const key = betTypes[type];
          const amount = stats[type]?.total_bet_amount || 0;
          const count = stats[type]?.bettor_count || 0;

          const amountEl = document.getElementById(`admin${key}BetAmount`);
          const countEl = document.getElementById(`admin${key}BetCount`);

          if (amountEl) amountEl.textContent = formatAdminAmount(amount);
          if (countEl) countEl.textContent = `${count}ëª…`;
        }

        // ì´ê³„ ì—…ë°ì´íŠ¸
        const totalAmountEl = document.getElementById("adminTotalBetAmount");
        const totalCountEl = document.getElementById("adminTotalBetCount");
        if (totalAmountEl)
          totalAmountEl.textContent = formatAdminAmount(totalBetAmount);
        if (totalCountEl) totalCountEl.textContent = `${totalBetCount}ëª…`;
      }

      // ì‚¬ìš©ì í…Œì´ë¸”ì—ì„œ íŠ¹ì • ì‚¬ìš©ìì˜ ì”ì•¡ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
      function updateUserBalanceInTable(userId, newBalance) {
        const userTable = document.getElementById("userTable");
        if (!userTable) return;

        const rows = userTable.querySelectorAll("tr");
        rows.forEach((row) => {
          const adjustButton = row.querySelector(
            `.adjust-coins[data-id="${userId}"]`
          );
          if (adjustButton) {
            // í•´ë‹¹ ì‚¬ìš©ìì˜ í–‰ì„ ì°¾ì•˜ìœ¼ë©´ ì”ì•¡ ì—…ë°ì´íŠ¸
            const balanceCell = row.querySelector("td:nth-child(2)"); // ì”ì•¡ ì—´
            if (balanceCell) {
              balanceCell.innerHTML = `<span class="text-yellow-400 font-bold">${newBalance.toLocaleString()} ì›</span>`;

              // ì—…ë°ì´íŠ¸ íš¨ê³¼ ì¶”ê°€
              balanceCell.style.background = "rgba(34, 197, 94, 0.2)";
              setTimeout(() => {
                balanceCell.style.background = "";
              }, 1500);
            }
          }
        });
      }

      // admin.htmlìš© ê¸ˆì•¡ í¬ë§·íŒ… í•¨ìˆ˜
      function formatAdminAmount(amount) {
        if (typeof amount !== "number") amount = 0;
        return amount.toLocaleString() + " ì›";
      }

      // ê²Œì„ ê²°ê³¼ ìŠ¹ì¸ í›„ ìë™ ë°ì´í„° ì—…ë°ì´íŠ¸
      function handleResultApproved() {
        // ë² íŒ… í†µê³„ ì´ˆê¸°í™”
        const emptyStats = {
          player: { total_bet_amount: 0, bettor_count: 0 },
          banker: { total_bet_amount: 0, bettor_count: 0 },
          tie: { total_bet_amount: 0, bettor_count: 0 },
          player_pair: { total_bet_amount: 0, bettor_count: 0 },
          banker_pair: { total_bet_amount: 0, bettor_count: 0 },
        };
        updateBettingStats(emptyStats);

        // ìµœê·¼ ê²Œì„ ê¸°ë¡ ì—…ë°ì´íŠ¸
        fetchRecentGames();

        // ì‚¬ìš©ì ëª©ë¡ ì—…ë°ì´íŠ¸ (ì”ì•¡ ë³€ê²½ ë°˜ì˜)
        fetchUsers();

        // ë² íŒ… ê¸°ë¡ ì—…ë°ì´íŠ¸
        fetchAllBettingHistory();

        // ê²Œì„ ìƒíƒœ UI ì—…ë°ì´íŠ¸
        updateGameControls();

        showToast("ê²Œì„ ê²°ê³¼ê°€ ìŠ¹ì¸ë˜ì–´ ëª¨ë“  ë°ì´í„°ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.");

        // ìë™ ë² íŒ… ëª¨ë“œì¸ ê²½ìš° ë‹¤ìŒ ê²Œì„ ìŠ¤ì¼€ì¤„
        if (autoGameState.isActive) {
          scheduleNextAutoBetting();
        }
      }

      // ê²Œì„ ìƒíƒœ ê´€ë¦¬ ìˆ˜ì •
      let gameState = {
        isBetting: false,
      };

      // í†µí•© ìë™ ê²Œì„ ìƒíƒœ ê´€ë¦¬ (ìë™ì‹œì‘ + ë°±ê·¸ë¼ìš´ë“œ í†µí•©)
      let autoGameState = {
        isActive: false,
        gameCount: 0,
        maxGames: 0, // 0ì´ë©´ ë¬´ì œí•œ (ê³„ì†)
      };

      // ê²Œì„ ìƒíƒœì— ë”°ë¥¸ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™” í•¨ìˆ˜ (í†µí•©)
      function updateGameControls() {
        const startButton = document.getElementById("startBetting");
        const autoStartButton = document.getElementById("startAutoGame");
        const autoStopButton = document.getElementById("stopAutoGame");
        const adminStartGameButton = document.getElementById("adminStartGame");

        // ìë™ ê²Œì„ í™œì„±í™” ì‹œ ìˆ˜ë™ ì‹œì‘ ë²„íŠ¼ ë¹„í™œì„±í™”
        const isDisabled = gameState.isBetting || autoGameState.isActive;

        startButton.disabled = isDisabled;
        autoStartButton.disabled = isDisabled;

        // ìë™ ê²Œì„ ì¤‘ì¼ ë•ŒëŠ” ìˆ˜ë™ ê²Œì„ ì‹œì‘ ë²„íŠ¼ë„ ë¹„í™œì„±í™”
        if (adminStartGameButton) {
          adminStartGameButton.disabled = isDisabled;
        }

        // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
        if (isDisabled) {
          startButton.classList.add("opacity-50", "cursor-not-allowed");
          autoStartButton.classList.add("opacity-50", "cursor-not-allowed");
          if (adminStartGameButton) {
            adminStartGameButton.classList.add(
              "opacity-50",
              "cursor-not-allowed"
            );
          }
        } else {
          startButton.classList.remove("opacity-50", "cursor-not-allowed");
          autoStartButton.classList.remove("opacity-50", "cursor-not-allowed");
          if (adminStartGameButton) {
            adminStartGameButton.classList.remove(
              "opacity-50",
              "cursor-not-allowed"
            );
          }
        }

        // ìë™ ê²Œì„ ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€
        if (autoGameState.isActive) {
          autoStartButton.classList.add("hidden");
          autoStopButton.classList.remove("hidden");
        } else {
          autoStartButton.classList.remove("hidden");
          autoStopButton.classList.add("hidden");
        }
      }

      // ìë™ ê²Œì„ ì‹œì‘ í•¨ìˆ˜ (í†µí•©)
      function startAutoGame() {
        const gameCountSelect = document.getElementById("autoGameCount");
        const maxGames = parseInt(gameCountSelect.value);

        // ì„œë²„ì— ìë™ ê²Œì„ ì‹œì‘ ìš”ì²­
        socket.emit("start_auto_game", { maxGames });
      }

      // ìë™ ê²Œì„ ì¤‘ì§€ í•¨ìˆ˜ (í†µí•©)
      function stopAutoGame() {
        // ì„œë²„ì— ìë™ ê²Œì„ ì¤‘ì§€ ìš”ì²­
        socket.emit("stop_auto_game");
      }

      // ìë™ ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
      function updateAutoStatus(message) {
        const autoStatusEl = document.getElementById("autoStatus");
        if (autoStatusEl) {
          autoStatusEl.classList.remove("hidden");
          autoStatusEl.innerHTML = `${message} <span id="autoProgress"></span>`;
        }
      }

      // ìë™ ìƒíƒœ í‘œì‹œ ìˆ¨ê¹€
      function hideAutoStatus() {
        const autoStatusEl = document.getElementById("autoStatus");
        if (autoStatusEl) {
          autoStatusEl.classList.add("hidden");
        }
      }

      // ë² íŒ… ì‹œì‘ ë²„íŠ¼ ì´ë²¤íŠ¸
      document
        .getElementById("startBetting")
        .addEventListener("click", async () => {
          // ìë™ ê²Œì„ ëª¨ë“œì¼ ë•ŒëŠ” ìˆ˜ë™ ë² íŒ… ì‹œì‘ ë°©ì§€
          if (autoGameState.isActive) {
            showToast(
              "ìë™ ê²Œì„ ì§„í–‰ ì¤‘ì—ëŠ” ìˆ˜ë™ ë² íŒ…ì„ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
              "error"
            );
            return;
          }

          socket.emit("start_betting");
          gameState.isBetting = true;
          updateGameControls();
        });

      // ìë™ ê²Œì„ ì‹œì‘ ë²„íŠ¼ ì´ë²¤íŠ¸ (í†µí•©)
      document.getElementById("startAutoGame").addEventListener("click", () => {
        startAutoGame();
      });

      // ìë™ ê²Œì„ ì¤‘ì§€ ë²„íŠ¼ ì´ë²¤íŠ¸ (í†µí•©)
      document.getElementById("stopAutoGame").addEventListener("click", () => {
        stopAutoGame();
      });

      // ê²Œì„ ì»¨íŠ¸ë¡¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      document
        .getElementById("adminStartGame")
        .addEventListener("click", () => {
          // ìë™ ê²Œì„ ëª¨ë“œì¼ ë•ŒëŠ” ìˆ˜ë™ ê²Œì„ ì‹œì‘ ë°©ì§€
          if (autoGameState.isActive) {
            showToast(
              "ìë™ ê²Œì„ ì§„í–‰ ì¤‘ì—ëŠ” ìˆ˜ë™ ê²Œì„ì„ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
              "error"
            );
            return;
          }

          socket.emit("admin_start_game");
          showToast("ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤!");
          document.getElementById("adminStartGame").disabled = true;
        });

      document
        .getElementById("adminShuffleDeck")
        .addEventListener("click", () => {
          socket.emit("admin_shuffle_deck");
          showToast("ë±ì„ ì…”í”Œí•©ë‹ˆë‹¤!");
        });

      // Socket.io ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤ (ê°œì„ ëœ ë²„ì „)
      socket.on("betting_status", (status) => {
        gameState.isBetting = status.active;
        updateGameControls();

        // ë² íŒ… ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
        const bettingStatusEl = document.getElementById("bettingStatus");
        if (bettingStatusEl) {
          if (status.active) {
            bettingStatusEl.textContent = "í˜„ì¬ ìƒíƒœ: ë² íŒ… ì¤‘";
            bettingStatusEl.className = "text-lg font-semibold text-green-400";
          } else {
            bettingStatusEl.textContent = "í˜„ì¬ ìƒíƒœ: ëŒ€ê¸°ì¤‘";
            bettingStatusEl.className = "text-lg font-semibold text-yellow-400";
          }
        }

        if (status.stats) {
          updateBettingStats(status.stats);
        }

        // ë² íŒ…ì´ í™œì„±í™”ë˜ì–´ ìˆê³  ì¢…ë£Œ ì‹œê°„ì´ ìˆìœ¼ë©´ íƒ€ì´ë¨¸ ì‹œì‘
        if (status.active && status.endTime) {
          startTimer(new Date(status.endTime));
        }
      });

      socket.on("betting_started", () => {
        const bettingStatusEl = document.getElementById("bettingStatus");
        if (bettingStatusEl) {
          bettingStatusEl.textContent = "í˜„ì¬ ìƒíƒœ: ë² íŒ… ì¤‘";
          bettingStatusEl.className = "text-lg font-semibold text-green-400";
        }

        // ë² íŒ… í†µê³„ ì´ˆê¸°í™” (ìƒˆë¡œìš´ ì„ì‹œ ë² íŒ… ì‹œìŠ¤í…œ)
        updateBettingStats({
          player: { total_bet_amount: 0, bettor_count: 0 },
          banker: { total_bet_amount: 0, bettor_count: 0 },
          tie: { total_bet_amount: 0, bettor_count: 0 },
          player_pair: { total_bet_amount: 0, bettor_count: 0 },
          banker_pair: { total_bet_amount: 0, bettor_count: 0 },
        });

        gameState.isBetting = true;
        updateGameControls();
      });

      socket.on("betting_end_time", (endTime) => {
        startTimer(new Date(endTime));
      });

      socket.on("betting_closed", () => {
        const bettingStatusEl = document.getElementById("bettingStatus");
        const timerEl = document.getElementById("timer");

        if (bettingStatusEl) {
          bettingStatusEl.textContent = "í˜„ì¬ ìƒíƒœ: ë² íŒ… ë§ˆê°";
          bettingStatusEl.className = "text-lg font-semibold text-red-400";
        }

        gameState.isBetting = false;
        updateGameControls();

        if (timerEl) {
          timerEl.textContent = "";
        }

        // íƒ€ì´ë¨¸ ì •ë¦¬
        if (window.adminCountdownTimer) {
          clearInterval(window.adminCountdownTimer);
        }

        gameState.isBetting = false;
        updateGameControls();

        // ë² íŒ… ë§ˆê° ì†Œë¦¬ ì¬ìƒ
        const bettingEndSound = document.getElementById("bettingEndSound");
        if (bettingEndSound) {
          bettingEndSound.play().catch((err) => {});
        }

        // ìë™ ê²Œì„ ëª¨ë“œê°€ ì•„ë‹ ë•Œë§Œ ìˆ˜ë™ìœ¼ë¡œ ê²Œì„ ì‹œì‘ (1ì´ˆ í›„)
        if (!autoGameState.isActive) {
          setTimeout(() => {
            socket.emit("admin_start_game");
          }, 1000);
        }
      });

      // ìƒˆë¡œìš´ ë² íŒ…ì´ ë“¤ì–´ì˜¬ ë•Œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
      socket.on("new_bet", (data) => {
        if (data.stats) {
          updateBettingStats(data.stats);
        }
      });

      // ë² íŒ… í™•ì • ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì¶”ê°€
      socket.on("bets_confirmed", (data) => {
        showToast(
          `ë² íŒ…ì´ í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤. (ì´ ${data.totalBets}ê°œ ë² íŒ…)`,
          "success"
        );

        // ë² íŒ… ìƒíƒœ ì—…ë°ì´íŠ¸
        const bettingStatusEl = document.getElementById("bettingStatus");
        if (bettingStatusEl) {
          bettingStatusEl.textContent = "í˜„ì¬ ìƒíƒœ: ë² íŒ… í™•ì •ë¨";
          bettingStatusEl.className = "text-lg font-semibold text-green-400";
        }
      });

      // ì‚¬ìš©ì ì”ì•¡ ë³€ê²½ ì‹œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
      socket.on("user_balance_updated", (data) => {
        if (data.userId && data.newBalance !== undefined) {
          updateUserBalanceInTable(data.userId, data.newBalance);
        }
      });

      // ë¦¬ë”ë³´ë“œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
      socket.on("leaderboard_updated", (leaderboard) => {
        updateLeaderboardTable(leaderboard);
      });

      // ê²Œì„ ê²°ê³¼ ìŠ¹ì¸/ê±°ì ˆ í›„ ìƒíƒœ ì´ˆê¸°í™”
      socket.on("result_approved", () => {
        const bettingStatusEl = document.getElementById("bettingStatus");
        if (bettingStatusEl) {
          bettingStatusEl.textContent = "í˜„ì¬ ìƒíƒœ: ëŒ€ê¸°ì¤‘";
          bettingStatusEl.className = "text-lg font-semibold text-yellow-400";
        }

        // ë² íŒ… í†µê³„ ì´ˆê¸°í™”
        updateBettingStats({
          player: { total_bet_amount: 0, bettor_count: 0 },
          banker: { total_bet_amount: 0, bettor_count: 0 },
          tie: { total_bet_amount: 0, bettor_count: 0 },
          player_pair: { total_bet_amount: 0, bettor_count: 0 },
          banker_pair: { total_bet_amount: 0, bettor_count: 0 },
        });

        // ê²Œì„ ì‹œì‘ ë²„íŠ¼ í™œì„±í™”
        document.getElementById("adminStartGame").disabled = false;

        // ì‚¬ìš©ì ëª©ë¡ê³¼ ê²Œì„ ê¸°ë¡ ìƒˆë¡œê³ ì¹¨
        fetchUsers();
        fetchRecentGames();
        fetchHouseStatistics(); // í•˜ìš°ìŠ¤ í†µê³„ë„ ìƒˆë¡œê³ ì¹¨

        // ìë™ ê²Œì„ ëª¨ë“œì—ì„œëŠ” ì„œë²„ì—ì„œ ìë™ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.
      });

      // ìƒˆë¡œìš´ ì¶©ì „ ìš”ì²­ ì•Œë¦¼
      socket.on("new_deposit_request", (data) => {
        showToast(
          `ğŸ’° ìƒˆë¡œìš´ ì¶©ì „ ìš”ì²­: ${
            data.username
          } - ${data.amount.toLocaleString()}ì›`,
          "info"
        );
        fetchDepositRequests(); // ì¶©ì „ ìš”ì²­ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        fetchFinancialSummary(); // ì¬ì • ìš”ì•½ ìƒˆë¡œê³ ì¹¨
      });

      // ìƒˆë¡œìš´ í™˜ì „ ìš”ì²­ ì•Œë¦¼
      socket.on("new_exchange_request", (data) => {
        showToast(
          `ğŸ’¸ ìƒˆë¡œìš´ í™˜ì „ ìš”ì²­: ${
            data.username
          } - ${data.requestAmount.toLocaleString()}ì› (ì‹¤ìˆ˜ë ¹: ${data.actualAmount.toLocaleString()}ì›)`,
          "info"
        );
        fetchExchangeRequests(); // í™˜ì „ ìš”ì²­ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        fetchFinancialSummary(); // ì¬ì • ìš”ì•½ ìƒˆë¡œê³ ì¹¨
      });

      // íƒ€ì´ë¨¸ ì‹œì‘ í•¨ìˆ˜
      function startTimer(endTime) {
        const timerElement = document.getElementById("timer");
        if (!timerElement) return;

        // ê¸°ì¡´ íƒ€ì´ë¨¸ê°€ ìˆìœ¼ë©´ ì •ë¦¬
        if (window.adminCountdownTimer) {
          clearInterval(window.adminCountdownTimer);
        }

        window.adminCountdownTimer = setInterval(() => {
          const now = new Date();
          const distance = endTime - now;
          if (distance < 0) {
            clearInterval(window.adminCountdownTimer);
            timerElement.textContent = "";
            return;
          }
          const seconds = Math.floor((distance / 1000) % 60);
          timerElement.innerHTML = `
            <span class="text-2xl font-bold ${
              seconds <= 10 ? "text-red-400 animate-pulse" : "text-blue-400"
            }">
              ${seconds}ì´ˆ
            </span>
          `;
        }, 1000);
      }

      // í•˜ìš°ìŠ¤ í†µê³„ ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜
      async function fetchHouseStatistics() {
        try {
          const res = await fetch(
            "https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/house-statistics",
            {
              headers: { Authorization: `Bearer ${token}` },
            }
          );

          if (!res.ok) {
            throw new Error("í•˜ìš°ìŠ¤ í†µê³„ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          }

          const stats = await res.json();
          updateHouseStatisticsUI(stats);
        } catch (err) {
          console.error("í•˜ìš°ìŠ¤ í†µê³„ ë¡œë“œ ì˜¤ë¥˜:", err);
          showToast("í•˜ìš°ìŠ¤ í†µê³„ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", "error");
        }
      }

      // í•˜ìš°ìŠ¤ í†µê³„ UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜
      function updateHouseStatisticsUI(stats) {
        // ì „ì²´ í†µê³„ ì—…ë°ì´íŠ¸
        const {
          overall,
          financial,
          gameStats,
          betStats,
          period,
          topContributors,
        } = stats;

        // ì „ì²´ í†µê³„
        document.getElementById(
          "totalBetAmount"
        ).textContent = `${overall.totalBetAmount.toLocaleString()}ì›`;
        document.getElementById(
          "totalWinAmount"
        ).textContent = `${overall.totalWinAmount.toLocaleString()}ì›`;

        // ë² íŒ… ìˆ˜ìµ
        const bettingHouseProfitEl =
          document.getElementById("bettingHouseProfit");
        if (bettingHouseProfitEl) {
          bettingHouseProfitEl.textContent = `${overall.bettingHouseProfit.toLocaleString()}ì›`;
          bettingHouseProfitEl.className = `text-xl font-bold ${
            overall.bettingHouseProfit >= 0 ? "text-green-400" : "text-red-400"
          }`;
        }

        // ì‹¤ì œ ìˆœì´ìµ
        const realHouseProfitEl = document.getElementById("realHouseProfit");
        if (realHouseProfitEl) {
          realHouseProfitEl.textContent = `${overall.realHouseProfit.toLocaleString()}ì›`;
          realHouseProfitEl.className = `text-xl font-bold ${
            overall.realHouseProfit >= 0 ? "text-green-400" : "text-red-400"
          }`;
        }

        // ì‹¤ì œ ìˆ˜ìµë¥ 
        const realProfitMarginEl = document.getElementById("realProfitMargin");
        if (realProfitMarginEl) {
          realProfitMarginEl.textContent = `${overall.realProfitMargin}%`;
        }

        // ì¶©ì „/í™˜ì „ í†µê³„
        if (financial) {
          const totalDepositEl = document.getElementById("totalDepositAmount");
          if (totalDepositEl)
            totalDepositEl.textContent = `${financial.totalDepositAmount.toLocaleString()}ì›`;

          const totalExchangeEl = document.getElementById(
            "totalExchangeAmount"
          );
          if (totalExchangeEl)
            totalExchangeEl.textContent = `${financial.totalExchangeAmount.toLocaleString()}ì›`;

          const totalFeesEl = document.getElementById("totalExchangeFees");
          if (totalFeesEl)
            totalFeesEl.textContent = `${financial.totalExchangeFees.toLocaleString()}ì›`;

          const totalBalanceEl = document.getElementById("totalUserBalance");
          if (totalBalanceEl)
            totalBalanceEl.textContent = `${financial.totalUserBalance.toLocaleString()}ì›`;
        }

        // ê¸°ê°„ë³„ í†µê³„ - ì˜¤ëŠ˜
        document.getElementById(
          "todayBetAmount"
        ).textContent = `${period.today.betAmount.toLocaleString()}ì›`;
        document.getElementById(
          "todayWinAmount"
        ).textContent = `${period.today.winAmount.toLocaleString()}ì›`;

        const todayProfitEl = document.getElementById("todayHouseProfit");
        todayProfitEl.textContent = `${period.today.houseProfit.toLocaleString()}ì›`;
        todayProfitEl.className = `font-bold ${
          period.today.houseProfit >= 0 ? "text-green-400" : "text-red-400"
        }`;

        document.getElementById(
          "todayBetCount"
        ).textContent = `${period.today.betCount}íšŒ`;

        // ê¸°ê°„ë³„ í†µê³„ - ì´ë²ˆ ì£¼
        document.getElementById(
          "weekBetAmount"
        ).textContent = `${period.week.betAmount.toLocaleString()}ì›`;
        document.getElementById(
          "weekWinAmount"
        ).textContent = `${period.week.winAmount.toLocaleString()}ì›`;

        const weekProfitEl = document.getElementById("weekHouseProfit");
        weekProfitEl.textContent = `${period.week.houseProfit.toLocaleString()}ì›`;
        weekProfitEl.className = `font-bold ${
          period.week.houseProfit >= 0 ? "text-green-400" : "text-red-400"
        }`;

        document.getElementById(
          "weekBetCount"
        ).textContent = `${period.week.betCount}íšŒ`;

        // ê²Œì„ ê²°ê³¼ í†µê³„
        document.getElementById(
          "totalGames"
        ).textContent = `${gameStats.totalGames}íšŒ`;
        document.getElementById(
          "playerWinGames"
        ).textContent = `${gameStats.playerWins}íšŒ`;
        document.getElementById(
          "bankerWinGames"
        ).textContent = `${gameStats.bankerWins}íšŒ`;
        document.getElementById("tieGames").textContent = `${gameStats.ties}íšŒ`;

        // ë² íŒ… íƒ€ì…ë³„ í†µê³„ ì—…ë°ì´íŠ¸
        updateBetTypeStatistics(betStats);

        // ìƒìœ„ ê¸°ì—¬ ì‚¬ìš©ì ì—…ë°ì´íŠ¸
        updateTopContributors(topContributors);
      }

      // ë² íŒ… íƒ€ì…ë³„ í†µê³„ ì—…ë°ì´íŠ¸
      function updateBetTypeStatistics(betStats) {
        const container = document.getElementById("betTypeStats");
        container.innerHTML = "";

        const betTypeNames = {
          player: "í”Œë ˆì´ì–´",
          banker: "ë±…ì»¤",
          tie: "íƒ€ì´",
          player_pair: "í”Œë ˆì´ì–´ í˜ì–´",
          banker_pair: "ë±…ì»¤ í˜ì–´",
        };

        const betTypeColors = {
          player: "text-blue-400",
          banker: "text-red-400",
          tie: "text-green-400",
          player_pair: "text-sky-400",
          banker_pair: "text-pink-400",
        };

        Object.entries(betStats).forEach(([betType, stats]) => {
          const div = document.createElement("div");
          div.className = "flex justify-between";

          const profitClass =
            stats.houseProfit >= 0 ? "text-green-400" : "text-red-400";
          const prefix = stats.houseProfit >= 0 ? "+" : "";

          div.innerHTML = `
            <span class="${betTypeColors[betType] || "text-gray-400"}">${
            betTypeNames[betType] || betType
          }:</span>
            <span class="${profitClass} font-bold">${prefix}${stats.houseProfit.toLocaleString()}ì›</span>
          `;
          container.appendChild(div);
        });
      }

      // ìƒìœ„ ê¸°ì—¬ ì‚¬ìš©ì ì—…ë°ì´íŠ¸
      function updateTopContributors(contributors) {
        const tableBody = document.getElementById("topContributorsTable");
        tableBody.innerHTML = "";

        if (contributors.length === 0) {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td colspan="5" class="py-4 text-center text-gray-400">
              ê¸°ì—¬ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
            </td>
          `;
          tableBody.appendChild(tr);
          return;
        }

        contributors.forEach((contributor, index) => {
          const tr = document.createElement("tr");
          tr.className =
            "border-t border-gray-800 hover:bg-gray-700/50 transition-colors";

          const rankClass =
            index < 3
              ? [
                  "text-yellow-400 font-bold",
                  "text-gray-300 font-bold",
                  "text-orange-400 font-bold",
                ][index]
              : "text-gray-400";

          const contributionClass =
            contributor.contribution >= 0 ? "text-green-400" : "text-red-400";
          const contributionPrefix = contributor.contribution >= 0 ? "+" : "";

          tr.innerHTML = `
            <td class="py-3 px-4">
              <span class="${rankClass}">${index + 1}</span>
            </td>
            <td class="py-3 px-4 font-medium">${contributor.username}</td>
            <td class="py-3 px-4 text-right text-yellow-400">${contributor.totalBet.toLocaleString()}ì›</td>
            <td class="py-3 px-4 text-right text-blue-400">${contributor.totalWin.toLocaleString()}ì›</td>
            <td class="py-3 px-4 text-right ${contributionClass} font-bold">${contributionPrefix}${contributor.contribution.toLocaleString()}ì›</td>
          `;
          tableBody.appendChild(tr);
        });
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™” (ê°œì„ ëœ ë²„ì „)
      document.addEventListener("DOMContentLoaded", () => {
        updateGameControls();
        fetchAllBettingHistory();
        fetchRecentGames();
        fetchUsers(); // ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ
        fetchExchangeRequests(); // í™˜ì „ ìš”ì²­ ëª©ë¡ ë¡œë“œ
        fetchFinancialSummary(); // ì¬ì • ìš”ì•½ ë¡œë“œ
        fetchDepositRequests(); // ì¶©ì „ ìš”ì²­ ëª©ë¡ ë¡œë“œ
        fetchHouseStatistics(); // í•˜ìš°ìŠ¤ í†µê³„ ë¡œë“œ

        // ì •ê¸°ì ì¸ ì—…ë°ì´íŠ¸ ì„¤ì •
        setInterval(() => {
          if (!gameState.isBetting) {
            fetchUsers(); // ë² íŒ… ì¤‘ì´ ì•„ë‹ ë•Œë§Œ ì‚¬ìš©ì ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            fetchFinancialSummary(); // ì¬ì • ìš”ì•½ë„ ì—…ë°ì´íŠ¸
            fetchHouseStatistics(); // í•˜ìš°ìŠ¤ í†µê³„ë„ ì—…ë°ì´íŠ¸
          }
          fetchExchangeRequests(); // í™˜ì „ ìš”ì²­ì€ í•­ìƒ ì—…ë°ì´íŠ¸
          fetchDepositRequests(); // ì¶©ì „ ìš”ì²­ë„ í•­ìƒ ì—…ë°ì´íŠ¸
        }, 30000); // 30ì´ˆë§ˆë‹¤
      });

      // ë¦¬ë”ë³´ë“œ í…Œì´ë¸” ì—…ë°ì´íŠ¸ í•¨ìˆ˜
      function updateLeaderboardTable(leaderboard) {
        const leaderboardTable = document.getElementById("leaderboardTable");
        if (!leaderboardTable) return;

        leaderboardTable.innerHTML = "";

        leaderboard.forEach((user, index) => {
          const tr = document.createElement("tr");
          tr.className =
            "border-t border-gray-800 hover:bg-gray-800/50 transition-colors";

          const rankClass =
            index < 3
              ? [
                  "text-yellow-400 font-bold",
                  "text-gray-300 font-bold",
                  "text-orange-400 font-bold",
                ][index]
              : "text-gray-400";

          tr.innerHTML = `
            <td class="py-3 px-4">
              <span class="${rankClass}">${index + 1}</span>
            </td>
            <td class="py-3 px-4">${user.username}</td>
            <td class="py-3 px-4 text-right text-yellow-400 font-bold">${user.balance.toLocaleString()} ì›</td>
            <td class="py-3 px-4 text-right">${user.winRate}%</td>
            <td class="py-3 px-4 text-right">${user.totalBets}</td>
          `;
          leaderboardTable.appendChild(tr);
        });
      }

      // ë¦¬ë”ë³´ë“œ ê°€ì ¸ì˜¤ê¸°
      async function fetchLeaderboard() {
        try {
          const res = await fetch(
            "https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/leaderboard",
            {
              headers: { Authorization: `Bearer ${token}` },
            }
          );
          const leaderboard = await res.json();
          updateLeaderboardTable(leaderboard);
        } catch (err) {
          showToast("ë¦¬ë”ë³´ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ì „ì²´ ë² íŒ… ê¸°ë¡ ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜
      async function fetchAllBettingHistory() {
        try {
          const res = await fetch(
            "https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/all-betting-history",
            {
              headers: { Authorization: `Bearer ${token}` },
            }
          );

          if (!res.ok) {
            throw new Error("ë² íŒ… ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹¤.");
          }

          const allBets = await res.json();
          const container = document.getElementById("allBettingHistoryTable");
          container.innerHTML = "";

          if (allBets.length === 0) {
            container.innerHTML = `
              <tr>
                <td colspan="5" class="py-4 text-center text-gray-400">
                  ë² íŒ… ë¡ì´ ì—†ìŠµë‹ˆë‹¤.
                </td>
              </tr>
            `;
            return;
          }

          allBets.forEach((bet) => {
            const tr = document.createElement("tr");
            tr.className = "border-t border-gray-800";

            const resultClass =
              bet.result === "win"
                ? "text-green-400"
                : bet.result === "lose"
                ? "text-red-400"
                : "text-yellow-400";

            const resultText =
              bet.result === "win"
                ? "ìŠ¹ë¦¬"
                : bet.result === "lose"
                ? "íŒ¨ë°°"
                : "í™˜ê¸‰";

            const choiceKorean = {
              player: "í”Œë ˆì´ì–´",
              banker: "ë±…ì»¤",
              tie: "íƒ€ì´",
              player_pair: "í”Œë ˆì´ì–´í˜ì–´",
              banker_pair: "ë±…ì»¤í˜ì–´",
            };

            const profitClass =
              bet.profit >= 0 ? "text-green-400" : "text-red-400";
            const profitPrefix = bet.profit >= 0 ? "+" : "";

            tr.innerHTML = `
              <td class="py-3 px-4 text-sm text-gray-400">
                ${new Date(bet.date).toLocaleString()}
              </td>
              <td class="py-3 px-4">${bet.username}</td>
              <td class="py-3 px-4 text-center">
                ${choiceKorean[bet.choice] || bet.choice} â†’ ${
              choiceKorean[bet.gameResult] || bet.gameResult
            }
              </td>
              <td class="py-3 px-4 text-right">
                <span class="text-yellow-400">${bet.amount} ì›</span>
                <span class="${profitClass} ml-2">(${profitPrefix}${
              bet.profit
            } ì›)</span>
              </td>
              <td class="py-3 px-4 text-center">
                <span class="${resultClass} font-semibold">${resultText}</span>
              </td>
            `;
            container.appendChild(tr);
          });
        } catch (err) {
          showToast("ë² íŒ… ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ë¡œê·¸ì•„ì›ƒ
      document.getElementById("logout").addEventListener("click", () => {
        if (confirm("ì •ë§ ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
          localStorage.removeItem("token");
          showToast("ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.", "info");
          setTimeout(() => {
            window.location.href = "index.html";
          }, 1000);
        }
      });

      // ìµœê·¼ ê²Œì„ ê¸°ë¡ í‘œì‹œ í•¨ìˆ˜ ìˆ˜ì •
      async function fetchRecentGames() {
        try {
          const res = await fetch(
            "https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/recent-games",
            {
              headers: { Authorization: `Bearer ${token}` },
            }
          );

          if (res.status === 403 || res.status === 401) {
            handleAuthError();
            return;
          }

          const recentGames = await res.json();

          // í†µê³„ ê³„ì‚°
          const stats = {
            player: 0,
            banker: 0,
            tie: 0,
            total: recentGames.length,
          };

          recentGames.forEach((game) => {
            stats[game.result]++;
          });

          // í†µê³„ ì—…ë°ì´íŠ¸
          document.getElementById("playerWins").textContent = stats.player;
          document.getElementById("bankerWins").textContent = stats.banker;
          document.getElementById("tieWins").textContent = stats.tie;

          // ê²°ê³¼ íŒ¨í„´ í‘œì‹œ
          const recentResultsContainer =
            document.getElementById("recentResults");
          recentResultsContainer.innerHTML = "";

          if (recentGames.length === 0) {
            recentResultsContainer.innerHTML = `<div class="text-center text-gray-500 py-4">ìµœê·¼ ê²Œì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
          } else {
            let currentColumn = null;
            let lastResultType = null;
            // APIì—ì„œ ìµœê·¼ 36ê°œ ì œí•œì„ ê±¸ ìˆ˜ ìˆì§€ë§Œ, í´ë¼ì´ì–¸íŠ¸ì—ì„œë„ í•œ ë²ˆ ë” ìŠ¬ë¼ì´ìŠ¤í•˜ì—¬ ìµœëŒ€ í‘œì‹œ ê°œìˆ˜ ê´€ë¦¬ (ì˜ˆ: ìµœê·¼ 72ê°œë¡œ ë¹…ë¡œë“œ êµ¬ì„±)
            const gamesToDisplay = recentGames.slice(-72).reverse(); // ìµœê·¼ 72ê°œë¡œ ë¹…ë¡œë“œ êµ¬ì„±, ì—­ìˆœìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼ ì˜¬ë°”ë¥¸ ìˆœì„œë¡œ í‘œì‹œ

            gamesToDisplay.forEach((game) => {
              const resultType = game.result;
              let cellText = resultType.charAt(0).toUpperCase();

              if (
                resultType !== lastResultType ||
                !currentColumn ||
                currentColumn.children.length >= 6
              ) {
                currentColumn = document.createElement("div");
                currentColumn.className = "result-column";
                recentResultsContainer.appendChild(currentColumn);
                lastResultType = resultType;
              }

              const resultElement = document.createElement("div");
              resultElement.className = `result-cell ${resultType}`;
              if (game.playerPairOccurred) {
                resultElement.classList.add("player-pair");
              }
              if (game.bankerPairOccurred) {
                resultElement.classList.add("banker-pair");
              }
              // ì¤‘êµ­ì  ìŠ¤íƒ€ì¼ì´ë¯€ë¡œ í…ìŠ¤íŠ¸ ì—†ì´ ìƒ‰ìƒìœ¼ë¡œë§Œ í‘œì‹œ
              // resultElement.textContent = cellText;
              currentColumn.appendChild(resultElement);
            });
            recentResultsContainer.scrollLeft =
              recentResultsContainer.scrollWidth; // í•­ìƒ ê°€ì¥ ìµœê·¼ ê²°ê³¼ê°€ ë³´ì´ë„ë¡ ìŠ¤í¬ë¡¤
          }

          // ìƒì„¸ ê¸°ë¡ í…Œì´ë¸” ì—…ë°ì´íŠ¸
          const recentGamesTable = document.getElementById("recentGamesTable");
          recentGamesTable.innerHTML = "";

          recentGames.forEach((game, index) => {
            const tr = document.createElement("tr");
            tr.className = "hover:bg-gray-800/50 transition-colors";

            const resultText =
              game.result === "player"
                ? "P"
                : game.result === "banker"
                ? "B"
                : "T";

            const resultClass =
              game.result === "player"
                ? "text-blue-400"
                : game.result === "banker"
                ? "text-red-400"
                : "text-green-400";

            tr.innerHTML = `
              <td class="py-1.5 px-2 text-xs">${recentGames.length - index}</td>
              <td class="py-1.5 px-2">
                <span class="font-bold ${resultClass}">${resultText}</span>
              </td>
              <td class="py-1.5 px-2 text-right text-xs">${
                game.playerCount
              }</td>
            `;
            recentGamesTable.appendChild(tr);
          });
        } catch (err) {
          showToast("ìµœê·¼ ê²Œì„ ê¸°ë¡ ë°í„°ë¥¼ ëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ì´ˆê¸° ë¦¬ë”ë³´ë“œ ë¡œë“œ (ë‹¤ë¥¸ í•­ëª©ë“¤ì€ DOMContentLoadedì—ì„œ ì²˜ë¦¬)
      fetchLeaderboard();

      // ì†Œì¼“ ì—°ê²° ë° ì´ˆê¸° ìƒíƒœ ìš”ì²­
      socket.on("connect", () => {
        socket.emit("authenticate", token);
        // ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ í˜„ì¬ ë² íŒ… ìƒíƒœ ìš”ì²­
        socket.emit("request_betting_status");
      });

      // ì‚¬ìš©ì ê´€ë¦¬ ì„¹ì…˜ ìˆ˜ì •
      async function fetchUsers() {
        try {
          const res = await fetch(
            "https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/users-stats",
            {
              headers: { Authorization: `Bearer ${token}` },
            }
          );

          if (!res.ok) {
            throw new Error("ì‚¬ìš©ì ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          }

          const users = await res.json();
          const userTable = document.getElementById("userTable");
          userTable.innerHTML = "";

          users.forEach((user) => {
            const tr = document.createElement("tr");
            tr.className =
              "border-t border-gray-800 hover:bg-gray-700/50 transition-colors";

            // Role and Status styling
            const roleText = user.role === "admin" ? "ê´€ë¦¬ì" : "ì¼ë°˜";
            const roleClass =
              user.role === "admin" ? "text-purple-400" : "text-gray-400";
            const approvedText = user.isApproved ? "ìŠ¹ì¸ë¨" : "ë¯¸ìŠ¹ì¸";
            const approvedClass = user.isApproved
              ? "text-green-400"
              : "text-yellow-500";

            // Profit/Loss styling
            const netProfit = user.netProfit || 0;
            const netProfitClass =
              netProfit > 0
                ? "text-green-400"
                : netProfit < 0
                ? "text-red-400"
                : "text-gray-400";
            const profitPrefix = netProfit > 0 ? "+" : "";

            // Win rate styling
            const winRate = parseFloat(user.winRate) || 0;
            const winRateClass =
              winRate >= 50
                ? "text-green-400"
                : winRate < 40
                ? "text-red-400"
                : "text-gray-400";

            tr.innerHTML = `
                <td class="py-3 px-4">
                    <div class="font-medium">${user.username}</div>
                    <div class="text-xs ${roleClass}">${roleText}</div>
                </td>
                <td class="py-3 px-4 text-left">
                    <span class="font-medium ${approvedClass}">${approvedText}</span>
                </td>
                <td class="py-3 px-4 text-right">
                    <div class="font-bold text-yellow-400">${user.balance.toLocaleString()} ì›</div>
                </td>
                <td class="py-3 px-4 text-right">
                    <div class="font-medium ${netProfitClass}">${profitPrefix}${netProfit.toLocaleString()} ì›</div>
                </td>
                <td class="py-3 px-4 text-left">
                    <div>
                        <span class="font-medium">${user.wins}ìŠ¹ ${
              user.losses
            }íŒ¨</span>
                        <span class="text-sm ${winRateClass}">(${winRate.toFixed(
              1
            )}%)</span>
                    </div>
                    <div class="text-xs text-gray-400">ì´ ${
                      user.totalBets
                    } ë² íŒ…</div>
                </td>
                <td class="py-3 px-4">
                    <div class="flex justify-center items-center gap-1 flex-wrap">
                      ${
                        !user.isApproved
                          ? `
                        <button 
                          class="approve-user bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded text-xs font-medium"
                          data-id="${user._id}"
                        >
                          ìŠ¹ì¸
                        </button>
                      `
                          : ""
                      }
                      ${
                        user.role !== "superadmin"
                          ? `
                        <button 
                          onclick="toggleAdmin('${user._id}', '${user.role}')"
                          class="${
                            user.role === "admin"
                              ? "bg-gray-600 hover:bg-gray-700"
                              : "bg-purple-600 hover:bg-purple-700"
                          } text-white px-2 py-1 rounded text-xs font-medium"
                        >
                          ${user.role === "admin" ? "í•´ì œ" : "ì§€ì •"}
                        </button>
                      `
                          : ""
                      }
                      <button 
                        class="user-detail bg-yellow-600 hover:bg-yellow-700 text-white px-2 py-1 rounded text-xs font-medium"
                        data-id="${user._id}"
                        data-username="${user.username}"
                      >
                        ìƒì„¸
                      </button>
                      <button 
                        class="reset-password bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded text-xs font-medium"
                        data-id="${user._id}"
                      >
                        ë¹„ë²ˆ
                      </button>
                      <button 
                        class="delete-user bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-xs font-medium"
                        data-id="${user._id}"
                      >
                        ì‚­ì œ
                      </button>
                    </div>
                </td>
            `;
            userTable.appendChild(tr);
          });

          // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
          setupUserManagementListeners();
        } catch (err) {
          showToast("ì‚¬ìš©ì ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ì‚¬ìš©ì ê´€ë¦¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
      function setupUserManagementListeners() {
        document.querySelectorAll(".adjust-coins").forEach((button) => {
          button.addEventListener("click", function () {
            const userId = this.getAttribute("data-id");
            adjustCoins(userId);
          });
        });

        document.querySelectorAll(".approve-user").forEach((button) => {
          button.addEventListener("click", function () {
            const userId = this.getAttribute("data-id");
            approveUser(userId);
          });
        });

        document.querySelectorAll(".delete-user").forEach((button) => {
          button.addEventListener("click", function () {
            const userId = this.getAttribute("data-id");
            deleteUser(userId);
          });
        });

        document.querySelectorAll(".reset-password").forEach((button) => {
          button.addEventListener("click", function () {
            const userId = this.getAttribute("data-id");
            resetPassword(userId);
          });
        });

        document.querySelectorAll(".user-detail").forEach((button) => {
          button.addEventListener("click", function () {
            const userId = this.getAttribute("data-id");
            const username = this.getAttribute("data-username");
            showUserDetail(userId, username);
          });
        });
      }

      // ì‚¬ìš©ì ìƒì„¸ì •ë³´ ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
      let currentDetailUserId = null;

      // ì‚¬ìš©ì ìƒì„¸ì •ë³´ ëª¨ë‹¬ í‘œì‹œ
      async function showUserDetail(userId, username) {
        currentDetailUserId = userId;
        document.getElementById("detailUsername").textContent = username;
        document.getElementById("userDetailModal").classList.remove("hidden");

        // ê°œìš” íƒ­ì„ ê¸°ë³¸ìœ¼ë¡œ ì„ íƒ
        switchDetailTab("overview");

        // ì‚¬ìš©ì ìƒì„¸ì •ë³´ ë¡œë“œ
        await loadUserDetailInfo(userId);
      }

      // ì‚¬ìš©ì ìƒì„¸ì •ë³´ ë¡œë“œ
      async function loadUserDetailInfo(userId) {
        try {
          // ê¸°ì¡´ users-stats APIë¥¼ ì‚¬ìš©í•˜ì—¬ í•´ë‹¹ ì‚¬ìš©ì ì •ë³´ ì°¾ê¸°
          const res = await fetch(
            "https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/users-stats",
            {
              headers: { Authorization: `Bearer ${token}` },
            }
          );

          if (!res.ok) {
            throw new Error("ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          }

          const users = await res.json();
          const userDetail = users.find((user) => user._id === userId);

          if (!userDetail) {
            throw new Error("í•´ë‹¹ ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
          }

          // ì¶”ê°€ ì •ë³´ë¥¼ ìœ„í•´ ë² íŒ… ê¸°ë¡ë„ ê°€ì ¸ì˜¤ê¸°
          await loadAdditionalUserInfo(userDetail);
          updateUserDetailModal(userDetail);
        } catch (err) {
          showToast("ì‚¬ìš©ì ìƒì„¸ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", "error");
          console.error("Error loading user detail:", err);
        }
      }

      // ì¶”ê°€ ì‚¬ìš©ì ì •ë³´ ë¡œë“œ (ë² íŒ… ê¸°ë¡ ë“±)
      async function loadAdditionalUserInfo(userDetail) {
        try {
          // ìƒˆë¡œìš´ ì‚¬ìš©ì ìƒì„¸ ì •ë³´ API í˜¸ì¶œ
          const detailRes = await fetch(
            `https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/user-detail/${userDetail._id}`,
            {
              headers: { Authorization: `Bearer ${token}` },
            }
          );

          if (detailRes.ok) {
            const detailData = await detailRes.json();

            // ì„œë²„ì—ì„œ ë°›ì€ ì‹¤ì œ ë°ì´í„°ë¡œ ì—…ë°ì´íŠ¸
            userDetail.choicePreferences = detailData.choiceStats;
            userDetail.totalBetAmount = detailData.totalBetAmount; // ì‹¤ì œ ë² íŒ…ì•¡ 100%
            userDetail.totalWinAmount = detailData.totalWinAmount;
            userDetail.averageBetAmount = detailData.averageBetAmount;
            userDetail.bettingProfit = detailData.bettingProfit;

            // ë¡¤ë§ ì •ë³´ (ì‹¤ì œ ì„œë²„ ë°ì´í„°)
            userDetail.rollingWageredAmount = detailData.rollingWagered; // ì‹¤ì œ ë² íŒ…ì•¡
            userDetail.rollingRequiredAmount = detailData.rollingRequirement; // ë¡¤ë§ ìš”êµ¬ëŸ‰
            userDetail.rollingProgress = detailData.rollingProgress; // ë¡¤ë§ ì§„í–‰ë¥ 

            // ì¬ì • ì •ë³´
            userDetail.totalDeposited = detailData.totalDeposited;
            userDetail.totalExchanged = detailData.totalExchanged;
            userDetail.depositCount = detailData.depositCount;
            userDetail.exchangeCount = detailData.exchangeCount;
            userDetail.overallProfit = detailData.overallProfit;
            userDetail.recentTransactions = detailData.recentTransactions;
          }
        } catch (err) {
          console.error("Error loading additional user info:", err);
          // ê¸°ë³¸ê°’ ì„¤ì •
          userDetail.choicePreferences = {};
          userDetail.totalBetAmount = 0;
          userDetail.totalWinAmount = 0;
          userDetail.averageBetAmount = 0;
          userDetail.bettingProfit = 0;
          userDetail.rollingWageredAmount = 0;
          userDetail.rollingRequiredAmount = 0;
          userDetail.rollingProgress = 0;
          userDetail.overallProfit = userDetail.netProfit || 0;
          userDetail.totalDeposited = 0;
          userDetail.totalExchanged = 0;
          userDetail.depositCount = 0;
          userDetail.exchangeCount = 0;
          userDetail.recentTransactions = [];
        }
      }

      // ì‚¬ìš©ì ìƒì„¸ì •ë³´ ëª¨ë‹¬ ì—…ë°ì´íŠ¸
      function updateUserDetailModal(userDetail) {
        // ê°œìš” íƒ­ ì •ë³´ ì—…ë°ì´íŠ¸
        document.getElementById("detailUserWins").textContent =
          parseInt(userDetail.wins) || 0;
        document.getElementById("detailUserLoses").textContent =
          parseInt(userDetail.losses) || 0;
        document.getElementById("detailUserWinRate").textContent = `${(
          parseFloat(userDetail.winRate) || 0
        ).toFixed(1)}%`;
        document.getElementById("detailTotalGames").textContent =
          parseInt(userDetail.totalBets) || 0;

        const bettingProfit = parseFloat(userDetail.bettingProfit) || 0;
        const bettingProfitElement = document.getElementById(
          "detailGameStatsBettingProfit"
        );
        bettingProfitElement.textContent = `${
          bettingProfit >= 0 ? "+" : ""
        }${Math.round(bettingProfit).toLocaleString()}ì›`;
        bettingProfitElement.className = `font-bold text-lg ${
          bettingProfit >= 0 ? "text-green-400" : "text-red-400"
        }`;

        document.getElementById("detailCurrentBalance").textContent = `${(
          parseInt(userDetail.balance) || 0
        ).toLocaleString()}ì›`;

        const overallProfit = parseFloat(userDetail.overallProfit) || 0;
        const overallProfitElement = document.getElementById(
          "detailOverallProfit"
        );
        overallProfitElement.textContent = `${
          overallProfit >= 0 ? "+" : ""
        }${Math.round(overallProfit).toLocaleString()}ì›`;
        overallProfitElement.className = `font-bold text-lg ${
          overallProfit >= 0 ? "text-green-400" : "text-red-400"
        }`;

        // ë² íŒ… ë¶„ì„ íƒ­ ì •ë³´ ì—…ë°ì´íŠ¸
        document.getElementById("detailModalTotalBetAmount").textContent = `${(
          parseInt(userDetail.totalBetAmount) || 0
        ).toLocaleString()}ì›`;
        document.getElementById("detailModalTotalWinAmount").textContent = `${(
          parseInt(userDetail.totalWinAmount) || 0
        ).toLocaleString()}ì›`;

        const modalBettingProfit = parseFloat(userDetail.bettingProfit) || 0;
        const modalBettingProfitElement = document.getElementById(
          "detailModalBettingProfit"
        );
        modalBettingProfitElement.textContent = `${
          modalBettingProfit >= 0 ? "+" : ""
        }${Math.round(modalBettingProfit).toLocaleString()}ì›`;
        modalBettingProfitElement.className = `font-bold ${
          modalBettingProfit >= 0 ? "text-green-400" : "text-red-400"
        }`;

        document.getElementById(
          "detailModalAverageBetAmount"
        ).textContent = `${Math.round(
          parseFloat(userDetail.averageBetAmount) || 0
        ).toLocaleString()}ì›`;

        // ë² íŒ… ì„ í˜¸ë„ ì—…ë°ì´íŠ¸
        updateDetailChoicePreferences(userDetail.choicePreferences || {});

        // ë¡¤ë§ ì •ë³´ ì—…ë°ì´íŠ¸
        const rollingProgress = parseFloat(userDetail.rollingProgress) || 0;
        document.getElementById(
          "detailRollingProgressTextInfo"
        ).textContent = `${rollingProgress.toFixed(1)}%`;
        document.getElementById(
          "detailRollingProgressBarInfo"
        ).style.width = `${Math.min(rollingProgress, 100)}%`;
        document.getElementById("detailRollingWageredAmount").textContent = `${(
          parseInt(userDetail.rollingWageredAmount) || 0
        ).toLocaleString()}ì›`;
        document.getElementById(
          "detailRollingRequiredAmount"
        ).textContent = `${(
          parseInt(userDetail.rollingRequiredAmount) || 0
        ).toLocaleString()}ì›`;

        // ì¬ì • í˜„í™© íƒ­ ì •ë³´ ì—…ë°ì´íŠ¸
        document.getElementById("detailTotalDeposited").textContent = `${(
          parseInt(userDetail.totalDeposited) || 0
        ).toLocaleString()}ì›`;
        document.getElementById("detailDepositCount").textContent =
          parseInt(userDetail.depositCount) || 0;
        document.getElementById("detailTotalExchanged").textContent = `${(
          parseInt(userDetail.totalExchanged) || 0
        ).toLocaleString()}ì›`;
        document.getElementById("detailExchangeCount").textContent =
          parseInt(userDetail.exchangeCount) || 0;

        // ìµœê·¼ ê±°ë˜ ë‚´ì—­ ì—…ë°ì´íŠ¸
        updateDetailRecentTransactions(userDetail.recentTransactions || []);
      }

      // ë² íŒ… ì„ í˜¸ë„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
      function updateDetailChoicePreferences(preferences) {
        const container = document.getElementById("detailChoicePreferences");
        container.innerHTML = "";

        const choiceNames = {
          player: "í”Œë ˆì´ì–´",
          banker: "ë±…ì»¤",
          tie: "íƒ€ì´",
          player_pair: "í”Œë ˆì´ì–´ í˜ì–´",
          banker_pair: "ë±…ì»¤ í˜ì–´",
        };

        const choiceColors = {
          player: "bg-blue-500",
          banker: "bg-red-500",
          tie: "bg-green-500",
          player_pair: "bg-blue-400",
          banker_pair: "bg-red-400",
        };

        let maxCount = 0;
        let favoriteChoice = "-";
        let maxChoiceKey = "";

        // ìµœëŒ€ê°’ê³¼ ì„ í˜¸ ë² íŒ… ì°¾ê¸°
        Object.entries(preferences).forEach(([choice, count]) => {
          if (count > maxCount) {
            maxCount = count;
            favoriteChoice = choiceNames[choice] || choice;
            maxChoiceKey = choice;
          }
        });

        // ì°¨íŠ¸ ìƒì„±
        Object.entries(preferences).forEach(([choice, count]) => {
          const percentage = maxCount > 0 ? (count / maxCount) * 100 : 0;
          const choiceName = choiceNames[choice] || choice;
          const colorClass = choiceColors[choice] || "bg-gray-500";

          const div = document.createElement("div");
          div.className = "flex items-center space-x-2";
          div.innerHTML = `
            <span class="text-sm text-gray-400 w-20">${choiceName}:</span>
            <div class="flex-1 bg-gray-700 rounded-full h-2">
              <div class="${colorClass} h-2 rounded-full" style="width: ${percentage}%"></div>
            </div>
            <span class="text-sm text-gray-300 w-8">${count}</span>
          `;
          container.appendChild(div);
        });

        document.getElementById("detailFavoriteChoice").textContent =
          favoriteChoice;
      }

      // ìµœê·¼ ê±°ë˜ ë‚´ì—­ ì—…ë°ì´íŠ¸
      function updateDetailRecentTransactions(transactions) {
        const container = document.getElementById("detailRecentTransactions");
        container.innerHTML = "";

        if (transactions.length === 0) {
          container.innerHTML =
            '<div class="text-gray-400 text-center py-4">ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
          return;
        }

        transactions.forEach((transaction) => {
          const div = document.createElement("div");
          div.className = "bg-black bg-opacity-30 p-3 rounded-lg";

          const typeText = transaction.type === "deposit" ? "ì¶©ì „" : "í™˜ì „";
          const typeColor =
            transaction.type === "deposit"
              ? "text-blue-400"
              : "text-orange-400";
          const statusText =
            transaction.status === "approved"
              ? "ìŠ¹ì¸"
              : transaction.status === "pending"
              ? "ëŒ€ê¸°"
              : "ê±°ì ˆ";
          const statusColor =
            transaction.status === "approved"
              ? "text-green-400"
              : transaction.status === "pending"
              ? "text-yellow-400"
              : "text-red-400";

          div.innerHTML = `
            <div class="flex justify-between items-center">
              <div>
                <span class="${typeColor} font-medium">${typeText}</span>
                <span class="text-gray-400 text-sm ml-2">${new Date(
                  transaction.createdAt
                ).toLocaleDateString()}</span>
              </div>
              <div class="text-right">
                <div class="font-bold">${transaction.amount.toLocaleString()}ì›</div>
                <div class="${statusColor} text-sm">${statusText}</div>
              </div>
            </div>
          `;
          container.appendChild(div);
        });
      }

      // ìƒì„¸ì •ë³´ ëª¨ë‹¬ íƒ­ ì „í™˜
      function switchDetailTab(tabName) {
        // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
        document
          .querySelectorAll('[id^="detail"][id$="Tab"]')
          .forEach((tab) => {
            tab.className =
              "flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors text-gray-400 hover:text-yellow-500";
          });

        // ëª¨ë“  íƒ­ ì»¨í…ì¸  ìˆ¨ê¸°ê¸°
        document
          .querySelectorAll('[id^="detail"][id$="Content"]')
          .forEach((content) => {
            content.classList.add("hidden");
          });

        // ì„ íƒëœ íƒ­ í™œì„±í™”
        const activeTab = document.getElementById(
          `detail${tabName.charAt(0).toUpperCase() + tabName.slice(1)}Tab`
        );
        const activeContent = document.getElementById(
          `detail${tabName.charAt(0).toUpperCase() + tabName.slice(1)}Content`
        );

        if (activeTab && activeContent) {
          activeTab.className =
            "flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors bg-purple-600 text-white";
          activeContent.classList.remove("hidden");
        }
      }

      // resetPassword í•¨ìˆ˜ ìˆ˜ì •
      async function resetPassword(userId) {
        const newPassword = prompt("ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
        if (!newPassword) return;

        try {
          const res = await fetch(
            `https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/users/${userId}/reset-password`,
            {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`,
              },
              body: JSON.stringify({ newPassword }),
            }
          );

          const data = await res.json();
          showToast(data.message);
          if (res.ok) {
            fetchUsers(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          }
        } catch (err) {
          showToast("ì„œë²„ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // adjustCoins í•¨ìˆ˜ ìˆ˜ì • (ëª¨ë‹¬ ì‚¬ìš©ìœ¼ë¡œ ê°œì„ )
      async function adjustCoins(userId) {
        return new Promise((resolve) => {
          // ëª¨ë‹¬ ìƒì„±
          const modal = document.createElement("div");
          modal.className =
            "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50";
          modal.innerHTML = `
            <div class="bg-gray-800 p-6 rounded-lg shadow-xl max-w-md w-full mx-4">
              <h3 class="text-lg font-semibold text-white mb-4">ì”ì•¡ ì¡°ì •</h3>
              <div class="mb-4">
                <label class="block text-gray-300 text-sm font-medium mb-2">
                  ì¡°ì •í•  ê¸ˆì•¡(ì›)ì„ ì…ë ¥í•˜ì„¸ìš” (ìŒìˆ˜ ê°€ëŠ¥):
                </label>
                <input 
                  type="number" 
                  id="adjustmentAmount" 
                  class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="ì˜ˆ: 10000 ë˜ëŠ” -5000"
                  step="1000"
                />
              </div>
              <div class="flex space-x-3">
                <button 
                  id="confirmAdjust" 
                  class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md font-medium transition-colors"
                >
                  í™•ì¸
                </button>
                <button 
                  id="cancelAdjust" 
                  class="flex-1 bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md font-medium transition-colors"
                >
                  ì·¨ì†Œ
                </button>
              </div>
            </div>
          `;

          document.body.appendChild(modal);

          const input = modal.querySelector("#adjustmentAmount");
          const confirmBtn = modal.querySelector("#confirmAdjust");
          const cancelBtn = modal.querySelector("#cancelAdjust");

          // ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤
          input.focus();

          // Enter í‚¤ë¡œ í™•ì¸
          input.addEventListener("keypress", (e) => {
            if (e.key === "Enter") {
              confirmBtn.click();
            }
          });

          // í™•ì¸ ë²„íŠ¼ í´ë¦­
          confirmBtn.addEventListener("click", async () => {
            const amount = input.value.trim();
            if (!amount) {
              showToast("ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.", "error");
              return;
            }

            const adjustment = parseInt(amount);
            if (isNaN(adjustment)) {
              showToast("ìœ íš¨í•œ ìˆ«ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.", "error");
              return;
            }

            try {
              const res = await fetch(
                `https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/users/${userId}/adjust-coins`,
                {
                  method: "PUT",
                  headers: {
                    "Content-Type": "application/json",
                    Authorization: `Bearer ${token}`,
                  },
                  body: JSON.stringify({ adjustment }),
                }
              );

              const data = await res.json();
              showToast(data.message);
              if (res.ok) {
                // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸: íŠ¹ì • ì‚¬ìš©ì ì”ì•¡ë§Œ ì—…ë°ì´íŠ¸
                if (data.newBalance !== undefined) {
                  updateUserBalanceInTable(userId, data.newBalance);
                } else {
                  fetchUsers(); // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ê°€ ì•ˆ ë˜ë©´ ì „ì²´ ìƒˆë¡œê³ ì¹¨
                }
              }
            } catch (err) {
              showToast("ì„œë²„ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", "error");
            }

            // ëª¨ë‹¬ ì œê±°
            document.body.removeChild(modal);
            resolve();
          });

          // ì·¨ì†Œ ë²„íŠ¼ í´ë¦­
          cancelBtn.addEventListener("click", () => {
            document.body.removeChild(modal);
            resolve();
          });

          // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
          modal.addEventListener("click", (e) => {
            if (e.target === modal) {
              document.body.removeChild(modal);
              resolve();
            }
          });

          // ESC í‚¤ë¡œ ë‹«ê¸°
          const handleEscape = (e) => {
            if (e.key === "Escape") {
              document.removeEventListener("keydown", handleEscape);
              document.body.removeChild(modal);
              resolve();
            }
          };
          document.addEventListener("keydown", handleEscape);
        });
      }

      // ê²Œì„ ê¸°ë¡ ì´ˆê¸°í™” í•¨ìˆ˜ ì¶”ê°€
      async function resetGameHistory() {
        if (
          !confirm(
            "ì •ë§ë¡œ ëª¨ë“  ê²Œì„ ê¸°ë¡ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
          )
        ) {
          return;
        }

        try {
          const res = await fetch(
            "https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/reset-game-history",
            {
              method: "DELETE",
              headers: {
                Authorization: `Bearer ${token}`,
              },
            }
          );

          if (res.ok) {
            showToast("ê²Œì„ ê¸°ë¡ì´ ì´ˆê¸°í™”ë˜ì—ˆë‹ˆë‹¤.");
            // í†µê³„ì™€ í…Œì´ë¸” ìƒˆë¡œê³ ì¹¨
            fetchRecentGames();
          } else {
            showToast("ê²Œì„ ê¸°ë¡ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          }
        } catch (err) {
          showToast("ì„œë²„ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // í™˜ì „ ìš”ì²­ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜ ìˆ˜ì •
      async function fetchExchangeRequests() {
        try {
          const res = await fetch(
            "https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/exchange-requests",
            {
              headers: { Authorization: `Bearer ${token}` },
            }
          );

          const requests = await res.json();
          const container = document.getElementById("exchangeRequestsTable");
          container.innerHTML = "";

          requests.forEach((request) => {
            const tr = document.createElement("tr");
            tr.className = "border-t border-gray-800";

            const statusClass = {
              pending: "text-yellow-400",
              approved: "text-green-400",
              rejected: "text-red-400",
            }[request.status];

            const statusText = {
              pending: "ëŒ€ê¸°ì¤‘",
              approved: "ìŠ¹ì¸ë¨",
              rejected: "ê±°ì ˆë¨",
            }[request.status];

            tr.innerHTML = `
              <td class="py-3 px-4">${new Date(
                request.createdAt
              ).toLocaleString()}</td>
              <td class="py-3 px-4">${request.username}</td>
              <td class="py-3 px-4 text-right text-yellow-400">${request.requestAmount.toLocaleString()} ì›</td>
              <td class="py-3 px-4 text-right">
                <div class="text-green-400">ì‹¤ìˆ˜ë ¹: ${request.actualAmount.toLocaleString()} ì›</div>
                <div class="text-red-400">ìˆ˜ìˆ˜ë£Œ: ${request.fee.toLocaleString()} ì›</div>
              </td>
              <td class="py-3 px-4 text-center">
                <span class="${statusClass} font-semibold">${statusText}</span>
              </td>
              <td class="py-3 px-4 text-center">
                ${
                  request.status === "pending"
                    ? `
                  <button 
                    onclick="handleExchange('${request._id}', 'approved')"
                    class="bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded mr-2"
                  >
                    ìŠ¹ì¸
                  </button>
                  <button 
                    onclick="handleExchange('${request._id}', 'rejected')"
                    class="bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded"
                  >
                    ê±°ì ˆ
                  </button>
                `
                    : ""
                }
              </td>
            `;
            container.appendChild(tr);
          });
        } catch (err) {
          showToast("í™˜ì „ ìš”ì²­ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // í™˜ì „ ìš”ì²­ ì²˜ë¦¬
      async function handleExchange(requestId, status) {
        if (
          !confirm(
            `ì •ë§ë¡œ ì´ í™˜ì „ ìš”ì²­ì„ ${
              status === "approved" ? "ìŠ¹ì¸" : "ê±°ì ˆ"
            }í•˜ì‹œê² ìŠµë‹ˆ?`
          )
        ) {
          return;
        }

        try {
          const res = await fetch(
            `https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/exchange-requests/${requestId}`,
            {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`,
              },
              body: JSON.stringify({ status }),
            }
          );

          const data = await res.json();
          showToast(data.message);

          if (res.ok) {
            fetchExchangeRequests(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            fetchFinancialSummary(); // ì¬ì • ìš”ì•½ ìƒˆë¡œê³ ì¹¨
          }
        } catch (err) {
          showToast("ì„œë²„ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // í™˜ì „ ìš”ì²­ ëª©ë¡ì€ DOMContentLoadedì—ì„œ ì²˜ë¦¬ë¨

      // Socket.IO ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€

      // ê¸°ì¡´ game.html í˜¸í™˜ìš© game_result ì´ë²¤íŠ¸ (ìƒˆë¡œìš´ admin ì»¨íŠ¸ë¡¤ ì‹œìŠ¤í…œì´ ìš°ì„ )
      socket.on("game_result", (data) => {
        // ì´ í•¸ë“¤ëŸ¬ì˜ ë‚´ìš©ì€ ì„œë²„ì—ì„œ ê²°ê³¼ê°€ ìë™ìœ¼ë¡œ ì²˜ë¦¬ë˜ë¯€ë¡œ ì œê±°í•©ë‹ˆë‹¤.
        // ê²Œì„ ê²°ê³¼ í‘œì‹œëŠ” game_result_with_cards í•¸ë“¤ëŸ¬ì—ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤.
      });

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ê²°ê³¼ ê´€ë¦¬ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
      document.addEventListener("DOMContentLoaded", () => {});

      // Socket.IO ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ìˆ˜ì •
      socket.on("recent_games_updated", (data) => {
        const { recentGames, stats: gameStats } = data; // ì„œë²„ì—ì„œ ì˜¤ëŠ” statsëŠ” ê²Œì„ ìŠ¹ë¦¬ í†µê³„ì´ë¯€ë¡œ gameStatsë¡œ ë³€ê²½
        // updateGameStats(recentGames, gameStats); // ì´ í•¨ìˆ˜ëŠ” ì´ì œ ìµœê·¼ ê²Œì„ 'ëª©ë¡' í†µê³„ë¥¼ ë‹¤ë£¸. ë² íŒ… í†µê³„ì™€ëŠ” ë‹¤ë¦„.
        // fetchRecentGames í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ í†µê³„ ì—…ë°ì´íŠ¸ê°€ ì´ë¯¸ ì²˜ë¦¬ë˜ê³  ìˆìŒ.
        // ë§Œì•½ ì—¬ê¸°ì„œë„ ìµœê·¼ ê²Œì„ ëª©ë¡ì— ëŒ€í•œ í†µê³„ë¥¼ í‘œì‹œí•´ì•¼ í•œë‹¤ë©´, í•´ë‹¹ ë¡œì§ì„ ì—¬ê¸°ì— ìœ ì§€.

        // ìµœê·¼ ê²Œì„ ê¸°ë¡ í…Œì´ë¸” ì—…ë°ì´íŠ¸
        const recentGamesTable = document.getElementById("recentGamesTable");
        if (recentGamesTable) {
          recentGamesTable.innerHTML = "";

          recentGames.forEach((game, index) => {
            const tr = document.createElement("tr");
            tr.className = "border-t border-gray-800";

            const resultClass = {
              player: "text-blue-400",
              banker: "text-red-400",
              tie: "text-green-400",
            }[game.result];

            const resultText =
              game.result === "player"
                ? "í”Œë ˆì´ì–´"
                : game.result === "banker"
                ? "ë±…ì»¤"
                : "íƒ€ì´";

            tr.innerHTML = `
              <td class="py-3 px-4">${recentGames.length - index}</td>
              <td class="py-3 px-4">
                 <span class="font-semibold ${resultClass}">${resultText}</span>
              </td>
              <td class="py-3 px-4">${new Date(game.date).toLocaleString()}</td>
              <td class="py-3 px-4 text-right">${formatAdminAmount(
                game.totalBets
              )}</td>
              <td class="py-3 px-4 text-right">${game.playerCount}ëª…</td>
              <td class="py-3 px-4 text-center">${
                game.playerPairOccurred
                  ? '<span class="text-xs font-semibold px-1.5 py-0.5 rounded bg-blue-500 text-white">P</span>'
                  : "-"
              }</td>
              <td class="py-3 px-4 text-center">${
                game.bankerPairOccurred
                  ? '<span class="text-xs font-semibold px-1.5 py-0.5 rounded bg-red-500 text-white">B</span>'
                  : "-"
              }</td>
            `;
            recentGamesTable.appendChild(tr);
          });
        }

        // "ìµœê·¼ ê²Œì„ ê¸°ë¡" ì„¹ì…˜ì˜ ì „ì²´ í†µê³„ ì—…ë°ì´íŠ¸ (P/B/T ìŠ¹ë¦¬ íšŸìˆ˜ ë“±)
        if (gameStats) {
          document.getElementById("playerWins").textContent =
            gameStats.playerWins || 0;
          document.getElementById("bankerWins").textContent =
            gameStats.bankerWins || 0;
          document.getElementById("tieWins").textContent = gameStats.ties || 0;
        }
      });

      // ì‹¤ì‹œê°„ ë² íŒ… í˜„í™© ì—…ë°ì´íŠ¸ (new_bet ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬)
      socket.on("new_bet", (data) => {
        const { stats } = data;
        if (stats) {
          // stats ê°ì²´ê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
          updateBettingStats(stats); // ì‹¤ì‹œê°„ ë² íŒ… í˜„í™© ì—…ë°ì´íŠ¸ í•¨ìˆ˜ í˜¸ì¶œ
        }
      });

      // ê²°ê³¼ ìŠ¹ì¸ ì™„ë£Œ ì•Œë¦¼ ì²˜ë¦¬
      socket.on("admin_result_approved", (data) => {
        showToast(`âœ… ${data.message}`, 3000);

        // ìë™ ìƒˆë¡œê³ ì¹¨ ëŒ€ì‹  ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ í™•ì¸
        setTimeout(() => {
          // ì¶”ê°€ì ì¸ ë°ì´í„° ë™ê¸°í™”ê°€ í•„ìš”í•œ ê²½ìš° ì—¬ê¸°ì„œ ì²˜ë¦¬
          fetchUsers();
          fetchAllBettingHistory();
          fetchHouseStatistics(); // í•˜ìš°ìŠ¤ í†µê³„ë„ ì—…ë°ì´íŠ¸
        }, 500);
      });

      // ê²Œì„ ê²°ê³¼ ìˆ˜ì‹  ì´ë²¤íŠ¸ (ì‹¤ì‹œê°„ ì ìˆ˜)
      socket.on("game_result", (data) => {
        const { result, playerScore, bankerScore } = data;

        // ìŠ¹ì í‘œì‹œ
        const gameWinner = document.getElementById("gameWinner");
        let winnerText = "";
        let winnerClass = "";

        if (result === "player") {
          winnerText = `í”Œë ˆì´ì–´ ìŠ¹ë¦¬! (${playerScore}-${bankerScore})`;
          winnerClass = "text-blue-400";
        } else if (result === "banker") {
          winnerText = `ë±…ì»¤ ìŠ¹ë¦¬! (${playerScore}-${bankerScore})`;
          winnerClass = "text-red-400";
        } else {
          winnerText = `íƒ€ì´! (${playerScore}-${bankerScore})`;
          winnerClass = "text-green-400";
        }

        gameWinner.textContent = winnerText;
        gameWinner.className = `text-xl font-bold text-center mb-2 ${winnerClass}`;
      });

      // ê²Œì„ ê²°ê³¼ ìˆ˜ì‹  ì´ë²¤íŠ¸ (ì¹´ë“œ ì •ë³´ í¬í•¨)
      socket.on("game_result_with_cards", (gameData) => {
        // ì¹´ë“œ ì •ë³´ í‘œì‹œ
        displayCards("playerCards", gameData.playerHand);
        displayCards("bankerCards", gameData.bankerHand);

        // ì ìˆ˜ í‘œì‹œ
        document.getElementById(
          "playerScore"
        ).textContent = `${gameData.playerHand.calculation} = ${gameData.playerScore}`;
        document.getElementById(
          "bankerScore"
        ).textContent = `${gameData.bankerHand.calculation} = ${gameData.bankerScore}`;

        // ìŠ¹ì í‘œì‹œ (ì ìˆ˜ í¬í•¨)
        const gameWinner = document.getElementById("gameWinner");
        let winnerText = "";
        let winnerClass = "";

        if (gameData.result === "player") {
          winnerText = `í”Œë ˆì´ì–´ ìŠ¹ë¦¬! (${gameData.playerScore}-${gameData.bankerScore})`;
          winnerClass = "text-blue-400";
        } else if (gameData.result === "banker") {
          winnerText = `ë±…ì»¤ ìŠ¹ë¦¬! (${gameData.playerScore}-${gameData.bankerScore})`;
          winnerClass = "text-red-400";
        } else {
          winnerText = `íƒ€ì´! (${gameData.playerScore}-${gameData.bankerScore})`;
          winnerClass = "text-green-400";
        }

        gameWinner.textContent = winnerText;
        gameWinner.className = `text-xl font-bold text-center mb-2 ${winnerClass}`;

        // í˜ì–´ ê²°ê³¼ í‘œì‹œ
        const pairResults = document.getElementById("pairResults");
        let pairText = "";
        if (gameData.playerPairOccurred || gameData.bankerPairOccurred) {
          const pairs = [];
          if (gameData.playerPairOccurred) pairs.push("í”Œë ˆì´ì–´ í˜ì–´");
          if (gameData.bankerPairOccurred) pairs.push("ë±…ì»¤ í˜ì–´");
          pairText = `${pairs.join(", ")} ë°œìƒ!`;
        } else {
          pairText = "í˜ì–´ ì—†ìŒ";
        }
        pairResults.textContent = pairText;

        // ë± ì •ë³´ ì—…ë°ì´íŠ¸
        updateDeckInfo(gameData.deckInfo);

        // ê²Œì„ ì‹œì‘ ë²„íŠ¼ í™œì„±í™”
        document.getElementById("adminStartGame").disabled = false;

        showToast("ê²Œì„ ê²°ê³¼ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!");
      });

      // ë± ì…”í”Œ ì™„ë£Œ ì´ë²¤íŠ¸
      socket.on("deck_shuffled", (data) => {
        showToast(data.message);
        updateDeckInfo(data.deckInfo);
      });

      // ë± ì •ë³´ ìˆ˜ì‹  ì´ë²¤íŠ¸
      socket.on("deck_info", (deckInfo) => {
        updateDeckInfo(deckInfo);
      });

      // ìë™ ê²Œì„ ê´€ë ¨ ì†Œì¼“ ì´ë²¤íŠ¸ë“¤ (í†µí•©)
      socket.on("auto_game_started", (data) => {
        autoGameState.isActive = true;
        autoGameState.gameCount = data.gameCount;
        autoGameState.maxGames = data.maxGames;
        updateGameControls();

        const gameTypeText =
          data.maxGames === 0 ? "ë¬´ì œí•œ" : `${data.maxGames}íšŒ`;
        updateAutoStatus(`ìë™ ê²Œì„ ì§„í–‰ ì¤‘ (${gameTypeText})`);
        showToast(data.message, "success");
      });

      socket.on("auto_game_status", (data) => {
        autoGameState.isActive = data.isActive;
        autoGameState.gameCount = data.gameCount;
        autoGameState.maxGames = data.maxGames;

        if (data.isActive) {
          const gameTypeText =
            data.maxGames === 0 ? "ë¬´ì œí•œ" : `${data.maxGames}íšŒ`;
          const progressText =
            data.maxGames === 0
              ? `${data.gameCount}íšŒ ì§„í–‰`
              : `${data.gameCount}/${data.maxGames}`;
          updateAutoStatus(`ìë™ ê²Œì„ ì§„í–‰ ì¤‘ (${gameTypeText})`);

          const progressEl = document.getElementById("autoProgress");
          if (progressEl) {
            progressEl.textContent = `(${progressText})`;
          }
        } else {
          hideAutoStatus();
        }
        updateGameControls();
      });

      socket.on("auto_game_stopped", (data) => {
        autoGameState.isActive = false;
        autoGameState.gameCount = 0;
        autoGameState.maxGames = 0;
        updateGameControls();
        hideAutoStatus();
        showToast(data.message, "info");
      });

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ê²Œì„ ìƒíƒœ í™•ì¸
      socket.on("connect", () => {
        // ìë™ ê²Œì„ ìƒíƒœ ìš”ì²­
        socket.emit("get_auto_game_status");
      });

      // ì‹¤ì‹œê°„ ì¹´ë“œ í‘œì‹œ ì´ë²¤íŠ¸ (ì¹´ë“œ í•˜ë‚˜ì”© ë°›ì•„ì˜¤ê¸°)
      socket.on("card_dealt_to_user_ui", (data) => {
        const { target, cardValue, cardSuit, cardIndex, isNewHand } = data;

        // ìƒˆë¡œìš´ í•¸ë“œ ì‹œì‘ ì‹œ ì¹´ë“œ í´ë¦¬ì–´
        if (isNewHand && cardIndex === 0) {
          if (target === "player") {
            document.getElementById("playerCards").innerHTML = "";
            document.getElementById("playerScore").textContent = "";
          } else if (target === "banker") {
            document.getElementById("bankerCards").innerHTML = "";
            document.getElementById("bankerScore").textContent = "";
          }
        }

        // ì¹´ë“œ í‘œì‹œ
        displaySingleCard(target, cardValue, cardSuit, cardIndex);
      });

      // ì¹´ë“œ í´ë¦¬ì–´ ì´ë²¤íŠ¸
      socket.on("clear_cards_display_on_user_html", () => {
        // ëª¨ë“  ì¹´ë“œì™€ ì ìˆ˜ í´ë¦¬ì–´
        document.getElementById("playerCards").innerHTML =
          '<span class="text-gray-500 text-sm">ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤</span>';
        document.getElementById("bankerCards").innerHTML =
          '<span class="text-gray-500 text-sm">ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤</span>';
        document.getElementById("playerScore").textContent = "";
        document.getElementById("bankerScore").textContent = "";

        // ê²Œì„ ê²°ê³¼ë„ ì´ˆê¸°í™”
        const gameWinner = document.getElementById("gameWinner");
        if (gameWinner) {
          gameWinner.textContent = "ê²Œì„ ê²°ê³¼ ëŒ€ê¸° ì¤‘...";
          gameWinner.className =
            "text-base font-bold text-center mb-1 text-gray-500";
        }

        const pairResults = document.getElementById("pairResults");
        if (pairResults) {
          pairResults.textContent = "";
        }
      });

      // ì¹´ë“œ í‘œì‹œ í•¨ìˆ˜ (ì „ì²´ í•¸ë“œ)
      function displayCards(containerId, handData) {
        const container = document.getElementById(containerId);
        container.innerHTML = "";

        handData.cards.forEach((card, index) => {
          const cardDiv = document.createElement("div");
          cardDiv.className =
            "inline-block mr-2 mb-1 px-2 py-1 bg-white text-black rounded text-sm font-bold";

          // ì¹´ë“œ ê°’ ë³€í™˜ (0ì„ 10ìœ¼ë¡œ í‘œì‹œ)
          let displayValue = card.value;
          if (card.value === "0") displayValue = "10";

          // ìŠˆíŠ¸ ì´ëª¨ì§€ (ì„œë²„ì˜ H, D, C, S í˜•ì‹ì— ë§ì¶¤)
          const suitEmoji = {
            H: "â™¥ï¸", // Hearts
            D: "â™¦ï¸", // Diamonds
            C: "â™£ï¸", // Clubs
            S: "â™ ï¸", // Spades
          };

          cardDiv.textContent = `${displayValue}${suitEmoji[card.suit] || ""}`;

          // ë¹¨ê°„ìƒ‰ ì¹´ë“œëŠ” ë¹¨ê°„ í…ìŠ¤íŠ¸ë¡œ
          if (card.suit === "H" || card.suit === "D") {
            cardDiv.className += " text-red-600";
          }

          container.appendChild(cardDiv);
        });
      }

      // ê°œë³„ ì¹´ë“œ í‘œì‹œ í•¨ìˆ˜ (ì‹¤ì‹œê°„ìš©)
      function displaySingleCard(target, cardValue, cardSuit, cardIndex) {
        const containerId = target === "player" ? "playerCards" : "bankerCards";
        const container = document.getElementById(containerId);

        if (!container) return;

        const cardDiv = document.createElement("div");
        cardDiv.className =
          "inline-block mr-2 mb-1 px-2 py-1 bg-white text-black rounded text-sm font-bold";

        // ì¹´ë“œ ê°’ ë³€í™˜
        let displayValue = cardValue;
        if (cardValue === "0") displayValue = "10";

        // ìŠˆíŠ¸ ì´ëª¨ì§€
        const suitEmoji = {
          H: "â™¥ï¸", // Hearts
          D: "â™¦ï¸", // Diamonds
          C: "â™£ï¸", // Clubs
          S: "â™ ï¸", // Spades
        };

        cardDiv.textContent = `${displayValue}${suitEmoji[cardSuit] || ""}`;

        // ë¹¨ê°„ìƒ‰ ì¹´ë“œëŠ” ë¹¨ê°„ í…ìŠ¤íŠ¸ë¡œ
        if (cardSuit === "H" || cardSuit === "D") {
          cardDiv.className += " text-red-600";
        }

        // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ ì¶”ê°€
        cardDiv.style.opacity = "0";
        cardDiv.style.transform = "scale(0.8)";

        container.appendChild(cardDiv);

        // ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰
        setTimeout(() => {
          cardDiv.style.transition = "all 0.3s ease-out";
          cardDiv.style.opacity = "1";
          cardDiv.style.transform = "scale(1)";
        }, 50);
      }

      // ë± ì •ë³´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
      function updateDeckInfo(deckInfo) {
        const deckInfoElement = document.getElementById("deckInfo");
        if (deckInfoElement && deckInfo) {
          deckInfoElement.textContent = `ë‚¨ì€ ì¹´ë“œ: ${deckInfo.remainingCards}ì¥ (${deckInfo.remainingDecks}ë±)`;
        }
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ë± ì •ë³´ ìš”ì²­
      document.addEventListener("DOMContentLoaded", () => {
        socket.emit("get_deck_info");

        // ì‚¬ìš©ì ìƒì„¸ì •ë³´ ëª¨ë‹¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document
          .getElementById("closeUserDetail")
          .addEventListener("click", function () {
            document.getElementById("userDetailModal").classList.add("hidden");
          });

        // ìƒì„¸ì •ë³´ ëª¨ë‹¬ íƒ­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document
          .getElementById("detailOverviewTab")
          .addEventListener("click", function () {
            switchDetailTab("overview");
          });

        document
          .getElementById("detailBettingTab")
          .addEventListener("click", function () {
            switchDetailTab("betting");
          });

        document
          .getElementById("detailFinancialTab")
          .addEventListener("click", function () {
            switchDetailTab("financial");
          });

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
        document
          .getElementById("userDetailModal")
          .addEventListener("click", function (e) {
            if (e.target === this) {
              this.classList.add("hidden");
            }
          });
      });

      // ì¬ì • ìš”ì•½ ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜
      async function fetchFinancialSummary() {
        try {
          const res = await fetch(
            "https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/users-financial-summary",
            {
              headers: { Authorization: `Bearer ${token}` },
            }
          );
          if (!res.ok)
            throw new Error("ì¬ì • ìš”ì•½ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");

          const summaries = await res.json();
          const tableBody = document.getElementById("financialSummaryTable");
          tableBody.innerHTML = "";

          summaries.forEach((summary) => {
            const tr = document.createElement("tr");
            tr.className =
              "border-t border-gray-800 hover:bg-gray-700/50 transition-colors";

            const profitClass =
              summary.financialProfit > 0
                ? "text-green-400"
                : summary.financialProfit < 0
                ? "text-red-400"
                : "text-gray-400";

            tr.innerHTML = `
              <td class="py-3 px-4 font-medium">${summary.username}</td>
              <td class="py-3 px-4 text-right text-yellow-400 font-bold">${summary.currentBalance.toLocaleString()} ì›</td>
              <td class="py-3 px-4 text-right text-blue-400">${summary.totalDeposited.toLocaleString()} ì›</td>
              <td class="py-3 px-4 text-right text-orange-400">${summary.totalExchanged.toLocaleString()} ì›</td>
              <td class="py-3 px-4 text-right ${profitClass} font-semibold">${summary.financialProfit.toLocaleString()} ì›</td>
              <td class="py-3 px-4 text-center">
                <button 
                  class="adjust-coins bg-yellow-600 hover:bg-yellow-700 text-white px-2.5 py-1.5 rounded text-sm font-medium transition-colors"
                  data-id="${summary.userId}"
                >
                  ì”ì•¡ ì¡°ì ˆ
                </button>
              </td>
            `;
            tableBody.appendChild(tr);
          });

          // ì”ì•¡ ì¡°ì ˆ ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
          document
            .querySelectorAll("#financialSummaryTable .adjust-coins")
            .forEach((button) => {
              button.addEventListener("click", function () {
                const userId = this.getAttribute("data-id");
                adjustCoins(userId);
              });
            });
        } catch (err) {
          showToast(err.message);
        }
      }

      // ì¶©ì „ ìš”ì²­ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜
      async function fetchDepositRequests() {
        try {
          const res = await fetch(
            "https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/deposit-requests",
            {
              headers: { Authorization: `Bearer ${token}` },
            }
          );
          const requests = await res.json();
          const container = document.getElementById("depositRequestsTable");
          container.innerHTML = "";

          requests.forEach((request) => {
            const tr = document.createElement("tr");
            tr.className = "border-t border-gray-800";

            const statusClass = {
              pending: "text-yellow-400",
              approved: "text-green-400",
              rejected: "text-red-400",
            }[request.status];

            const statusText = {
              pending: "ëŒ€ê¸°ì¤‘",
              approved: "ìŠ¹ì¸ë¨",
              rejected: "ê±°ì ˆë¨",
            }[request.status];

            tr.innerHTML = `
              <td class="py-3 px-4">${new Date(
                request.createdAt
              ).toLocaleString()}</td>
              <td class="py-3 px-4">${request.username}</td>
              <td class="py-3 px-4 text-right text-yellow-400">${request.amount.toLocaleString()} ì›</td>
              <td class="py-3 px-4 text-center">
                <span class="${statusClass} font-semibold">${statusText}</span>
              </td>
              <td class="py-3 px-4 text-center">
                ${
                  request.status === "pending"
                    ? `
                  <button 
                    onclick="handleDeposit('${request._id}', 'approved')"
                    class="bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded mr-2"
                  >ìŠ¹ì¸</button>
                  <button 
                    onclick="handleDeposit('${request._id}', 'rejected')"
                    class="bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded"
                  >ê±°ì ˆ</button>
                `
                    : ""
                }
              </td>
            `;
            container.appendChild(tr);
          });
        } catch (err) {
          showToast("ì¶©ì „ ìš”ì²­ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ì¶©ì „ ìš”ì²­ ì²˜ë¦¬ í•¨ìˆ˜
      async function handleDeposit(requestId, status) {
        if (
          !confirm(
            `ì •ë§ë¡œ ì´ ì¶©ì „ ìš”ì²­ì„ ${
              status === "approved" ? "ìŠ¹ì¸" : "ê±°ì ˆ"
            }í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`
          )
        ) {
          return;
        }

        try {
          const res = await fetch(
            `https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/deposit-requests/${requestId}`,
            {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`,
              },
              body: JSON.stringify({ status }),
            }
          );

          const data = await res.json();
          showToast(data.message);

          if (res.ok) {
            fetchDepositRequests(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            fetchFinancialSummary(); // ì¬ì • ìš”ì•½ ìƒˆë¡œê³ ì¹¨
          }
        } catch (err) {
          showToast("ì„œë²„ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ìŠ¹ë¶€ ì¡°ì‘ íŒ¨ë„ í† ê¸€ í•¨ìˆ˜
      function toggleFixPanel() {
        const modal = document.getElementById("fixPanelModal");
        if (modal.classList.contains("hidden")) {
          modal.classList.remove("hidden");
        } else {
          modal.classList.add("hidden");
        }
      }

      // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
      function closeFixPanelOnOutsideClick(event) {
        if (event.target.id === "fixPanelModal") {
          toggleFixPanel();
        }
      }

      // ìŠ¹ë¶€ ì¡°ì‘ í•¨ìˆ˜
      function fixGameResult(result) {
        if (!socket) {
          showToast("ì†Œì¼“ ì—°ê²°ì´ ì—†ìŠµë‹ˆë‹¤.");
          return;
        }

        // ë² íŒ…ì´ ì§„í–‰ ì¤‘ì¼ ë•Œë§Œ ì¡°ì‘ ê°€ëŠ¥
        if (!bettingActive) {
          showToast("ë² íŒ… ì‹œê°„ì´ ì•„ë‹™ë‹ˆë‹¤.");
          return;
        }

        // ì„ íƒëœ íŒ¨í„´ ê°€ì ¸ì˜¤ê¸°
        const patternSelect = document.getElementById("patternSelect");
        const selectedPattern = parseInt(patternSelect.value);

        const resultText =
          result === "player"
            ? "í”Œë ˆì´ì–´"
            : result === "banker"
            ? "ë±…ì»¤"
            : "íƒ€ì´";

        // íŒ¨í„´ ì„¤ëª…
        const patternDescriptions = {
          player: {
            1: "ë‚´ì¶”ëŸ´ 9 vs 8",
            2: "ì„¸ ë²ˆì§¸ ì¹´ë“œë¡œ ì—­ì „ìŠ¹",
            3: "ê°„ë°œì˜ ì°¨ì´ë¡œ ìŠ¹ë¦¬",
          },
          banker: {
            1: "ë‚´ì¶”ëŸ´ 9 vs 8",
            2: "ë±…ì»¤ ë£°ì— ì˜í•œ ìŠ¹ë¦¬",
            3: "ì••ë„ì  ìŠ¹ë¦¬",
          },
          tie: {
            1: "ë‚´ì¶”ëŸ´ 8 íƒ€ì´",
            2: "ì„¸ ë²ˆì§¸ ì¹´ë“œ í›„ íƒ€ì´",
            3: "ë‚®ì€ ì ìˆ˜ íƒ€ì´",
          },
        };

        const patternDesc =
          patternDescriptions[result][selectedPattern] || "ê¸°ë³¸ íŒ¨í„´";

        if (
          confirm(
            `ë‹¤ìŒ ê²Œì„ ê²°ê³¼ë¥¼ ${resultText} ìŠ¹ë¦¬ë¡œ ì¡°ì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\níŒ¨í„´: ${patternDesc}`
          )
        ) {
          socket.emit("admin_fix_result", { result, pattern: selectedPattern });

          // ë²„íŠ¼ ì‹œê°ì  í”¼ë“œë°±
          const buttons = ["fixPlayerBtn", "fixBankerBtn", "fixTieBtn"];
          buttons.forEach((btnId) => {
            const btn = document.getElementById(btnId);
            btn.classList.remove("bg-blue-600", "bg-red-600", "bg-green-600");
            btn.classList.add("bg-gray-700");
          });

          const activeBtn = document.getElementById(
            `fix${result.charAt(0).toUpperCase() + result.slice(1)}Btn`
          );
          if (activeBtn) {
            activeBtn.classList.remove("bg-gray-700");
            if (result === "player") {
              activeBtn.classList.add("bg-blue-600");
            } else if (result === "banker") {
              activeBtn.classList.add("bg-red-600");
            } else if (result === "tie") {
              activeBtn.classList.add("bg-green-600");
            }
          }

          // ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
          const statusDisplay = document.getElementById("fixStatusDisplay");
          const statusText = document.getElementById("fixStatusText");
          statusDisplay.classList.remove("hidden");
          statusText.textContent = `ì„¤ì •ë¨: ${resultText} ìŠ¹ë¦¬ (${patternDesc})`;
          statusDisplay.classList.remove("text-gray-400");
          statusDisplay.classList.add("text-green-400");

          // ëª¨ë‹¬ ë‹«ê¸°
          setTimeout(() => {
            toggleFixPanel();
          }, 1500);
        }
      }

      // ìŠ¹ë¶€ ì¡°ì‘ ê´€ë ¨ ì†Œì¼“ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      socket.on("result_fixed", (data) => {
        showToast(data.message);
      });

      // ê²Œì„ ì‹œì‘ ì‹œ ì¡°ì‘ ë²„íŠ¼ ì´ˆê¸°í™”
      socket.on("betting_started", () => {
        bettingActive = true; // ë² íŒ… í™œì„±í™”
        resetFixPanel();
      });

      // ë² íŒ… ì¢…ë£Œ ì‹œ ìƒíƒœ ì—…ë°ì´íŠ¸
      socket.on("betting_closed", () => {
        bettingActive = false; // ë² íŒ… ë¹„í™œì„±í™”
        resetFixPanel();
      });

      // ìŠ¹ë¶€ ì¡°ì‘ íŒ¨ë„ ì´ˆê¸°í™” í•¨ìˆ˜
      function resetFixPanel() {
        const buttons = ["fixPlayerBtn", "fixBankerBtn", "fixTieBtn"];
        buttons.forEach((btnId) => {
          const btn = document.getElementById(btnId);
          if (btn) {
            btn.classList.remove("bg-blue-600", "bg-red-600", "bg-green-600");
            btn.classList.add("bg-gray-700");
          }
        });

        // ìƒíƒœ í‘œì‹œ ì´ˆê¸°í™”
        const statusDisplay = document.getElementById("fixStatusDisplay");
        const statusText = document.getElementById("fixStatusText");
        if (statusDisplay && statusText) {
          statusDisplay.classList.add("hidden");
          statusText.textContent = "ì„¤ì •ëœ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤";
          statusDisplay.classList.remove("text-green-400");
          statusDisplay.classList.add("text-gray-400");
        }
      }
    </script>

    <!-- í”Œë¡œíŒ… ì±„íŒ… UI (Admin) -->
    <!-- ì±„íŒ… í”Œë¡œíŒ… ë²„íŠ¼ -->
    <div
      id="chatFloatingButton"
      class="fixed bottom-6 right-6 z-40 transition-all duration-300"
    >
      <button
        class="w-14 h-14 bg-gradient-to-r from-yellow-600 to-yellow-500 rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 flex items-center justify-center text-white bg-opacity-90 backdrop-blur-sm"
      >
        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
          <path
            fill-rule="evenodd"
            d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z"
            clip-rule="evenodd"
          ></path>
        </svg>
        <!-- ìƒˆ ë©”ì‹œì§€ ì•Œë¦¼ ë±ƒì§€ -->
        <div
          id="chatNotificationBadge"
          class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full text-xs text-white flex items-center justify-center font-bold hidden animate-pulse"
        >
          <span id="chatNotificationCount">0</span>
        </div>
      </button>
    </div>

    <!-- ì±„íŒ… ì°½ (Admin - PC ë ˆì´ì•„ì›ƒìš© ë„“ì´ ì œí•œ) -->
    <div
      id="chatWindow"
      class="fixed bottom-6 right-6 h-[500px] w-[500px] bg-gradient-to-b from-gray-800 to-gray-900 rounded-xl border-2 border-yellow-500 shadow-2xl z-50 hidden transform transition-all duration-300 backdrop-blur-md bg-opacity-95"
    >
      <div class="flex flex-col h-full">
        <!-- ì±„íŒ… í—¤ë” -->
        <div
          class="flex items-center justify-between p-4 border-b border-yellow-500 rounded-t-xl bg-gradient-to-r from-yellow-600 to-yellow-500"
        >
          <h3 class="text-white font-bold text-lg flex items-center">
            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
              <path
                fill-rule="evenodd"
                d="M18 3a1 1 0 00-1.447-.894L8.763 6H5a3 3 0 000 6h.28l1.771 5.316A1 1 0 008 18h1a1 1 0 001-1v-4.382l6.553 3.276A1 1 0 0018 15V3z"
                clip-rule="evenodd"
              ></path>
            </svg>
            ê´€ë¦¬ì ì±„íŒ…
          </h3>
          <button
            id="closeChatButton"
            class="text-white hover:text-gray-300 transition-colors"
          >
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
              <path
                fill-rule="evenodd"
                d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                clip-rule="evenodd"
              ></path>
            </svg>
          </button>
        </div>

        <!-- ì±„íŒ… ë©”ì‹œì§€ ì˜ì—­ -->
        <div
          id="chatMessages"
          class="flex-1 p-4 overflow-y-auto custom-scrollbar space-y-3"
        >
          <!-- ì±„íŒ… ë©”ì‹œì§€ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
        </div>

        <!-- ì±„íŒ… ì…ë ¥ ì˜ì—­ -->
        <div class="p-4 border-t border-yellow-500">
          <div class="flex space-x-2 mb-2">
            <button
              id="highlightMessageBtn"
              class="px-3 py-1 bg-yellow-600 text-white rounded text-xs hover:bg-yellow-700 transition-colors"
              title="ì´ ë©”ì‹œì§€ë¥¼ ê°•ì¡°í•˜ì—¬ ì „ì†¡í•©ë‹ˆë‹¤"
            >
              ê°•ì¡° ë©”ì‹œì§€
            </button>
            <span class="text-xs text-gray-400 flex items-center"
              >ê´€ë¦¬ì ë©”ì‹œì§€ëŠ” ëª¨ë“  ì‚¬ìš©ìì—ê²Œ íŒì—…ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤</span
            >
          </div>
          <div class="flex space-x-2">
            <input
              type="text"
              id="chatMessageInput"
              placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
              maxlength="500"
              class="flex-1 px-3 py-2 bg-gray-700 border border-yellow-500 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-yellow-400 text-sm"
            />
            <button
              id="sendChatButton"
              class="px-4 py-2 bg-gradient-to-r from-yellow-600 to-yellow-500 text-white rounded-lg hover:from-yellow-700 hover:to-yellow-600 transition-all duration-300 font-bold text-sm"
            >
              ì „ì†¡
            </button>
          </div>
          <div class="text-xs text-gray-400 mt-1 flex justify-between">
            <span><span id="chatCharCount">0</span>/500</span>
            <span id="highlightIndicator" class="text-yellow-400 hidden"
              >ê°•ì¡° ë©”ì‹œì§€ë¡œ ì „ì†¡ë©ë‹ˆë‹¤</span
            >
          </div>
        </div>
      </div>
    </div>

    <script>
      // ===========================
      // ì±„íŒ… ê´€ë ¨ ë³€ìˆ˜ ë° í•¨ìˆ˜ë“¤ (Admin)
      // ===========================

      let isChatOpen = false;
      let unreadChatCount = 0;
      let isHighlightMode = false;

      // ì±„íŒ… ê´€ë ¨ DOM ìš”ì†Œë“¤
      const chatFloatingButton = document.getElementById("chatFloatingButton");
      const chatWindow = document.getElementById("chatWindow");
      const closeChatButton = document.getElementById("closeChatButton");
      const chatMessages = document.getElementById("chatMessages");
      const chatMessageInput = document.getElementById("chatMessageInput");
      const sendChatButton = document.getElementById("sendChatButton");
      const chatCharCount = document.getElementById("chatCharCount");
      const chatNotificationBadge = document.getElementById(
        "chatNotificationBadge"
      );
      const chatNotificationCount = document.getElementById(
        "chatNotificationCount"
      );
      const highlightMessageBtn = document.getElementById(
        "highlightMessageBtn"
      );
      const highlightIndicator = document.getElementById("highlightIndicator");

      // ì±„íŒ…ì°½ ì—´ê¸°/ë‹«ê¸°
      function toggleChat() {
        if (isChatOpen) {
          closeChatWindow();
        } else {
          openChatWindow();
        }
      }

      function openChatWindow() {
        if (chatWindow && chatFloatingButton) {
          chatWindow.classList.remove("hidden");
          chatFloatingButton.style.opacity = "0.5";
          isChatOpen = true;

          // ì½ì§€ ì•Šì€ ë©”ì‹œì§€ ì¹´ìš´íŠ¸ ì´ˆê¸°í™”
          unreadChatCount = 0;
          updateChatNotificationBadge();

          // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ
          if (chatMessages) {
            setTimeout(() => {
              chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 100);
          }

          // ì±„íŒ… ê¸°ë¡ ë¡œë“œ
          loadChatHistory();
        }
      }

      function closeChatWindow() {
        if (chatWindow && chatFloatingButton) {
          chatWindow.classList.add("hidden");
          chatFloatingButton.style.opacity = "1";
          isChatOpen = false;
        }
      }

      // ì±„íŒ… ê¸°ë¡ ë¡œë“œ
      async function loadChatHistory() {
        try {
          const res = await fetch(
            "https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/chat/messages",
            {
              headers: { Authorization: `Bearer ${token}` },
            }
          );

          if (res.ok) {
            const messages = await res.json();
            displayChatMessages(messages);
          }
        } catch (err) {
          console.error("ì±„íŒ… ê¸°ë¡ ë¡œë“œ ì˜¤ë¥˜:", err);
        }
      }

      // ì±„íŒ… ë©”ì‹œì§€ë“¤ í‘œì‹œ
      function displayChatMessages(messages) {
        if (!chatMessages) return;

        chatMessages.innerHTML = "";
        messages.forEach((message) => {
          appendChatMessage(message);
        });

        // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ
        setTimeout(() => {
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }, 100);
      }

      // ì±„íŒ… ë©”ì‹œì§€ ì¶”ê°€
      function appendChatMessage(message) {
        if (!chatMessages) return;

        const messageEl = document.createElement("div");
        messageEl.className = `chat-message ${
          message.isAdmin ? "admin-message" : "user-message"
        }`;

        const timeStr = new Date(message.createdAt).toLocaleTimeString(
          "ko-KR",
          {
            hour: "2-digit",
            minute: "2-digit",
          }
        );

        const adminBadge = message.isAdmin
          ? '<span class="inline-block px-2 py-1 bg-yellow-500 text-black text-xs font-bold rounded-full mr-2">ê´€ë¦¬ì</span>'
          : "";
        const deleteBtn =
          "<button onclick=\"deleteChatMessage('" +
          message._id +
          '\')" class="text-red-400 hover:text-red-300 text-xs ml-2" title="ë©”ì‹œì§€ ì‚­ì œ"><svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" clip-rule="evenodd"></path><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg></button>';

        messageEl.innerHTML = `
          <div class="flex flex-col ${
            message.isAdmin
              ? "bg-yellow-500 bg-opacity-10 border border-yellow-500 rounded-lg p-3"
              : "bg-gray-700 bg-opacity-50 rounded-lg p-3"
          }">
            <div class="flex items-center justify-between mb-1">
              <div class="flex items-center">
                ${adminBadge}
                <span class="font-bold ${
                  message.isAdmin ? "text-yellow-400" : "text-white"
                } text-sm">${escapeHtml(message.username)}</span>
              </div>
              <div class="flex items-center">
                <span class="text-gray-400 text-xs">${timeStr}</span>
                ${deleteBtn}
              </div>
            </div>
            <p class="text-white text-sm break-words">${escapeHtml(
              message.message
            )}</p>
          </div>
        `;

        chatMessages.appendChild(messageEl);
      }

      // HTML ì´ìŠ¤ì¼€ì´í”„ í•¨ìˆ˜
      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      // ì±„íŒ… ë©”ì‹œì§€ ì „ì†¡
      async function sendChatMessage() {
        const message = chatMessageInput?.value.trim();
        if (!message || message.length > 500) return;

        try {
          // Socketìœ¼ë¡œ ë©”ì‹œì§€ ì „ì†¡ (ë” ë¹ ë¥¸ ì‘ë‹µì„ ìœ„í•´)
          socket.emit("send_chat_message", { message });

          // ì…ë ¥ì°½ ì´ˆê¸°í™”
          if (chatMessageInput) {
            chatMessageInput.value = "";
            updateCharCount();
          }

          // ê°•ì¡° ëª¨ë“œ í•´ì œ
          if (isHighlightMode) {
            toggleHighlightMode();
          }
        } catch (err) {
          console.error("ì±„íŒ… ì „ì†¡ ì˜¤ë¥˜:", err);
          showToast("ì±„íŒ… ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ì±„íŒ… ë©”ì‹œì§€ ì‚­ì œ (ê´€ë¦¬ìë§Œ)
      async function deleteChatMessage(messageId) {
        if (!confirm("ì´ ë©”ì‹œì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

        try {
          const res = await fetch(
            `https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/chat/message/${messageId}`,
            {
              method: "DELETE",
              headers: { Authorization: `Bearer ${token}` },
            }
          );

          if (res.ok) {
            showToast("ë©”ì‹œì§€ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
            // ì±„íŒ… ê¸°ë¡ ë‹¤ì‹œ ë¡œë“œ
            loadChatHistory();
          } else {
            showToast("ë©”ì‹œì§€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          }
        } catch (err) {
          console.error("ë©”ì‹œì§€ ì‚­ì œ ì˜¤ë¥˜:", err);
          showToast("ë©”ì‹œì§€ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ê°•ì¡° ë©”ì‹œì§€ ëª¨ë“œ í† ê¸€
      function toggleHighlightMode() {
        isHighlightMode = !isHighlightMode;

        if (isHighlightMode) {
          highlightMessageBtn.classList.remove(
            "bg-yellow-600",
            "hover:bg-yellow-700"
          );
          highlightMessageBtn.classList.add("bg-red-600", "hover:bg-red-700");
          highlightMessageBtn.textContent = "ì¼ë°˜ ë©”ì‹œì§€";
          highlightIndicator.classList.remove("hidden");
          chatMessageInput.classList.add("border-red-500");
          chatMessageInput.classList.remove("border-yellow-500");
        } else {
          highlightMessageBtn.classList.remove(
            "bg-red-600",
            "hover:bg-red-700"
          );
          highlightMessageBtn.classList.add(
            "bg-yellow-600",
            "hover:bg-yellow-700"
          );
          highlightMessageBtn.textContent = "ê°•ì¡° ë©”ì‹œì§€";
          highlightIndicator.classList.add("hidden");
          chatMessageInput.classList.remove("border-red-500");
          chatMessageInput.classList.add("border-yellow-500");
        }
      }

      // ë¬¸ì ìˆ˜ ì—…ë°ì´íŠ¸
      function updateCharCount() {
        if (chatMessageInput && chatCharCount) {
          const count = chatMessageInput.value.length;
          chatCharCount.textContent = count;

          if (count > 450) {
            chatCharCount.style.color = "#ef4444"; // ë¹¨ê°„ìƒ‰
          } else if (count > 350) {
            chatCharCount.style.color = "#f59e0b"; // ì£¼í™©ìƒ‰
          } else {
            chatCharCount.style.color = "#6b7280"; // íšŒìƒ‰
          }
        }
      }

      // ì±„íŒ… ì•Œë¦¼ ë±ƒì§€ ì—…ë°ì´íŠ¸
      function updateChatNotificationBadge() {
        if (chatNotificationBadge && chatNotificationCount) {
          if (unreadChatCount > 0 && !isChatOpen) {
            chatNotificationBadge.classList.remove("hidden");
            chatNotificationCount.textContent =
              unreadChatCount > 99 ? "99+" : unreadChatCount;
          } else {
            chatNotificationBadge.classList.add("hidden");
          }
        }
      }

      // ì±„íŒ… ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
      if (chatFloatingButton) {
        chatFloatingButton.addEventListener("click", toggleChat);
      }

      if (closeChatButton) {
        closeChatButton.addEventListener("click", closeChatWindow);
      }

      if (sendChatButton) {
        sendChatButton.addEventListener("click", sendChatMessage);
      }

      if (highlightMessageBtn) {
        highlightMessageBtn.addEventListener("click", toggleHighlightMode);
      }

      if (chatMessageInput) {
        chatMessageInput.addEventListener("input", updateCharCount);
        chatMessageInput.addEventListener("keydown", (e) => {
          if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            sendChatMessage();
          }
        });
      }

      // ì´ˆê¸° ë¬¸ì ìˆ˜ ì„¤ì •
      updateCharCount();

      // ì±„íŒ… ê´€ë ¨ Socket ì´ë²¤íŠ¸ë“¤ (Admin)

      // ìƒˆ ì±„íŒ… ë©”ì‹œì§€ ìˆ˜ì‹ 
      socket.on("new_chat_message", (message) => {
        // ì±„íŒ…ì°½ì´ ì—´ë ¤ìˆìœ¼ë©´ ë©”ì‹œì§€ ì¶”ê°€
        if (isChatOpen) {
          appendChatMessage(message);
          // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ
          setTimeout(() => {
            if (chatMessages) {
              chatMessages.scrollTop = chatMessages.scrollHeight;
            }
          }, 100);
        } else {
          // ì±„íŒ…ì°½ì´ ë‹«í˜€ìˆìœ¼ë©´ ì½ì§€ ì•Šì€ ë©”ì‹œì§€ ì¹´ìš´íŠ¸ ì¦ê°€
          unreadChatCount++;
          updateChatNotificationBadge();
        }
      });

      // ì±„íŒ… ë©”ì‹œì§€ ì‚­ì œ (ìë™ ì—…ë°ì´íŠ¸)
      socket.on("chat_message_deleted", (data) => {
        if (isChatOpen) {
          loadChatHistory();
        }
      });

      // ì±„íŒ… ì°¸ì—¬ ì‹ í˜¸
      socket.emit("join_chat");
    </script>
  </body>
</html>
