<!DOCTYPE html>
<html lang="ko" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ê³¨ë“  ì¹´ì§€ë…¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <style>
      /* Tailwind CSSì˜ ë‹¤í¬ ëª¨ë“œ ì‚¬ìš© */
      :root {
        --tw-bg-opacity: 1;
        --tw-text-opacity: 1;
      }
      .toast {
        visibility: hidden;
        min-width: 250px;
        margin-left: -125px;
        background-color: #333;
        color: #fff;
        text-align: center;
        border-radius: 2px;
        padding: 16px;
        position: fixed;
        z-index: 1;
        left: 50%;
        bottom: 30px;
      }
      .toast.show {
        visibility: visible;
        -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
        animation: fadein 0.5s, fadeout 0.5s 2.5s;
      }
      .toast.toast-info {
        background-color: #3b82f6;
        border-left: 4px solid #1d4ed8;
      }
      .toast.toast-success {
        background-color: #10b981;
        border-left: 4px solid #047857;
      }
      .toast.toast-error {
        background-color: #ef4444;
        border-left: 4px solid #dc2626;
      }
      @-webkit-keyframes fadein {
        from {
          bottom: 0;
          opacity: 0;
        }
        to {
          bottom: 30px;
          opacity: 1;
        }
      }
      @keyframes fadein {
        from {
          bottom: 0;
          opacity: 0;
        }
        to {
          bottom: 30px;
          opacity: 1;
        }
      }
      @-webkit-keyframes fadeout {
        from {
          bottom: 30px;
          opacity: 1;
        }
        to {
          bottom: 0;
          opacity: 0;
        }
      }
      @keyframes fadeout {
        from {
          bottom: 30px;
          opacity: 1;
        }
        to {
          bottom: 0;
          opacity: 0;
        }
      }
      .scrollable-table {
        max-height: 400px;
        overflow-y: auto;
      }

      @media (max-width: 640px) {
        .responsive-table {
          display: block;
          width: 100%;
          overflow-x: auto;
        }
      }

      /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
      .custom-scrollbar {
        scrollbar-width: thin;
        scrollbar-color: #4b5563 transparent;
      }

      .custom-scrollbar::-webkit-scrollbar {
        width: 6px;
      }

      .custom-scrollbar::-webkit-scrollbar-track {
        background: transparent;
      }

      .custom-scrollbar::-webkit-scrollbar-thumb {
        background-color: #4b5563;
        border-radius: 3px;
      }

      /* í…Œì´ë¸” í–‰ í˜¸ë²„ íš¨ */
      tbody tr {
        transition: background-color 0.2s;
      }

      tbody tr:hover {
        background-color: rgba(55, 65, 81, 0.5);
      }

      /* Sticky í—¤ë” ìŠ¤íƒ€ì¼ */
      thead {
        position: sticky;
        top: 0;
        z-index: 10;
      }

      /* ìµœê·¼ ê²Œì„ ê²°ê³¼ (Big Road) ìŠ¤íƒ€ì¼ ì¶”ê°€ */
      #recentResults {
        display: flex;
        flex-direction: row; /* ê°€ë¡œë¡œ ì—´ ë°°ì¹˜ */
        overflow-x: auto; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ */
        padding: 8px;
        min-height: 130px; /* ìµœì†Œ ë†’ì´ (6ê°œ ì•„ì´í…œ + íŒ¨ë”© ê³ ë ¤) */
        align-items: flex-start; /* ì—´ ìƒë‹¨ ì •ë ¬ */
        gap: 4px; /* ì—´ ê°„ ê°„ê²© */
        -webkit-overflow-scrolling: touch; /* iOS ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤ */
        background-color: rgba(0, 0, 0, 0.2); /* ë°°ê²½ìƒ‰ ì•½ê°„ ì¶”ê°€ */
        border-radius: 6px;
      }

      .result-column {
        display: flex;
        flex-direction: column; /* ì„¸ë¡œë¡œ ì•„ì´í…œ ë°°ì¹˜ */
        gap: 4px; /* ì•„ì´í…œ ê°„ ê°„ê²© */
      }

      .result-cell {
        width: 18px; /* ì…€ ë„ˆë¹„ */
        height: 18px; /* ì…€ ë†’ì´ */
        border-radius: 50%; /* ì›í˜• */
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 0.7rem;
        font-weight: bold;
        color: white;
        text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.5);
        flex-shrink: 0; /* ì¤„ì–´ë“¤ì§€ ì•Šë„ë¡ */
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .result-cell.player {
        background-color: #3b82f6; /* íŒŒë€ìƒ‰ */
      }
      .result-cell.banker {
        background-color: #ef4444; /* ë¹¨ê°„ìƒ‰ */
      }
      .result-cell.tie {
        background-color: #10b981; /* ë…¹ìƒ‰ */
      }
      .result-cell.player-pair {
        border: 2px solid #60a5fa; /* í”Œë ˆì´ì–´ í˜ì–´ í‘œì‹œ (ë°ì€ íŒŒë‘ í…Œë‘ë¦¬) */
        box-shadow: 0 0 3px #60a5fa;
      }
      .result-cell.banker-pair {
        border: 2px solid #f87171; /* ë±…ì»¤ í˜ì–´ í‘œì‹œ (ë°ì€ ë¹¨ê°• í…Œë‘ë¦¬) */
        box-shadow: 0 0 3px #f87171;
      }
    </style>
  </head>
  <body class="bg-gray-900 text-white">
    <div class="container mx-auto p-4 md:p-8">
      <!-- í—¤ë” ë° ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ -->
      <header
        class="flex flex-col md:flex-row justify-between items-center mb-6"
      >
        <h1 class="text-3xl font-bold mb-4 md:mb-0">ê³¨ë“  ì¹´ì§€ë…¸</h1>
        <button
          id="logout"
          class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded w-full md:w-auto"
        >
          ë¡œê·¸ì•„ì›ƒ
        </button>
      </header>

      <!-- ê²Œì„ ê´€ë¦¬ ì„¹ì…˜ ìˆ˜ì • -->
      <div class="mb-6 bg-gray-800 p-6 rounded-lg shadow">
        <h2 class="text-2xl font-semibold mb-4 text-purple-400">ê²Œì„ ê´€ë¦¬</h2>

        <!-- ë² íŒ… ìƒíƒœ ë° íƒ€ì´ë¨¸ -->
        <div
          class="flex flex-col md:flex-row justify-between items-center mb-4 gap-4"
        >
          <div class="flex items-center space-x-4">
            <div
              id="bettingStatus"
              class="text-lg font-semibold text-yellow-400"
            >
              í˜„ì¬ ìƒíƒœ: ëŒ€ê¸°ì¤‘
            </div>
            <div
              id="autoStatus"
              class="text-sm font-medium text-gray-400 hidden"
            >
              ğŸ¤– ìë™ ë² íŒ… ëŒ€ê¸° ì¤‘... <span id="autoCountdown"></span>
            </div>
            <div id="timer" class="text-2xl font-bold text-blue-400"></div>
          </div>
          <div class="flex flex-col md:flex-row gap-3 w-full md:w-auto">
            <button
              id="startBetting"
              class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg text-lg font-bold transition duration-300 w-full md:w-auto"
            >
              ë² íŒ… ì‹œì‘
            </button>
            <button
              id="autoStartBetting"
              class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg text-lg font-bold transition duration-300 w-full md:w-auto"
            >
              ìë™ ë² íŒ… ì‹œì‘
            </button>
            <button
              id="autoStopBetting"
              class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg text-lg font-bold transition duration-300 w-full md:w-auto hidden"
            >
              ìë™ ë² íŒ… ì¤‘ì§€
            </button>
          </div>
        </div>

        <!-- ê²Œì„ ì»¨íŠ¸ë¡¤ ì„¹ì…˜ ì¶”ê°€ -->
        <div class="mb-6 bg-gray-700 p-4 rounded-lg">
          <h3 class="text-lg font-semibold mb-3 text-gray-300">ê²Œì„ ì»¨íŠ¸ë¡¤</h3>
          <div class="flex flex-col md:flex-row gap-3 items-center">
            <div class="flex gap-3 w-full md:w-auto">
              <button
                id="adminStartGame"
                class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-bold transition duration-300 w-full md:w-auto"
              >
                ğŸ® ê²Œì„ ì‹œì‘
              </button>
              <button
                id="adminShuffleDeck"
                class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg font-bold transition duration-300 w-full md:w-auto"
              >
                ğŸ”„ ë± ì…”í”Œ
              </button>
            </div>
            <div class="text-sm text-gray-400" id="deckInfo">
              ë± ì •ë³´: ë¡œë”© ì¤‘...
            </div>
          </div>
        </div>

        <!-- ê²Œì„ ê²°ê³¼ í‘œì‹œ ì„¹ì…˜ ì¶”ê°€ -->
        <div
          id="gameResultDisplay"
          class="mb-6 bg-gray-700 p-4 rounded-lg hidden"
        >
          <h3 class="text-lg font-semibold mb-3 text-gray-300">
            í˜„ì¬ ê²Œì„ ê²°ê³¼
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <h4 class="text-md font-semibold mb-2 text-blue-400">í”Œë ˆì´ì–´</h4>
              <div id="playerCards" class="mb-2"></div>
              <div id="playerScore" class="text-lg font-bold"></div>
            </div>
            <div>
              <h4 class="text-md font-semibold mb-2 text-red-400">ë±…ì»¤</h4>
              <div id="bankerCards" class="mb-2"></div>
              <div id="bankerScore" class="text-lg font-bold"></div>
            </div>
          </div>
          <div class="mt-4">
            <div
              id="gameWinner"
              class="text-xl font-bold text-center mb-2"
            ></div>
            <div
              id="pairResults"
              class="text-center text-sm text-gray-400"
            ></div>
          </div>
        </div>

        <!-- ì‹¤ì‹œê°„ ë² íŒ… í˜„í™© -->
        <div class="mb-6">
          <h3 class="text-lg font-semibold mb-3 text-gray-300">
            ì‹¤ì‹œê°„ ë² íŒ… í˜„í™©
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <!-- í”Œë ˆì´ì–´ ë² íŒ… -->
            <div
              class="bg-gradient-to-br from-blue-900 to-blue-800 p-4 rounded-lg"
            >
              <div class="text-sm text-gray-300 mb-1">í”Œë ˆì´ì–´</div>
              <div class="flex justify-between items-center">
                <span
                  id="adminPlayerBetAmount"
                  class="text-xl font-bold text-white"
                  >0 ì›</span
                >
                <span id="adminPlayerBetCount" class="text-sm text-gray-300"
                  >0ëª…</span
                >
              </div>
            </div>
            <!-- ë±…ì»¤ ë² íŒ… -->
            <div
              class="bg-gradient-to-br from-red-900 to-red-800 p-4 rounded-lg"
            >
              <div class="text-sm text-gray-300 mb-1">ë±…ì»¤</div>
              <div class="flex justify-between items-center">
                <span
                  id="adminBankerBetAmount"
                  class="text-xl font-bold text-white"
                  >0 ì›</span
                >
                <span id="adminBankerBetCount" class="text-sm text-gray-300"
                  >0ëª…</span
                >
              </div>
            </div>
            <!-- íƒ€ì´ ë² íŒ… -->
            <div
              class="bg-gradient-to-br from-purple-900 to-purple-800 p-4 rounded-lg"
            >
              <div class="text-sm text-gray-300 mb-1">íƒ€ì´</div>
              <div class="flex justify-between items-center">
                <span
                  id="adminTieBetAmount"
                  class="text-xl font-bold text-white"
                  >0 ì›</span
                >
                <span id="adminTieBetCount" class="text-sm text-gray-300"
                  >0ëª…</span
                >
              </div>
            </div>
            <!-- í”Œë ˆì´ì–´ í˜ì–´ ë² íŒ… -->
            <div
              class="bg-gradient-to-br from-sky-800 to-sky-700 p-4 rounded-lg"
            >
              <div class="text-sm text-gray-300 mb-1">P í˜ì–´</div>
              <div class="flex justify-between items-center">
                <span
                  id="adminPlayerPairBetAmount"
                  class="text-xl font-bold text-white"
                  >0 ì›</span
                >
                <span id="adminPlayerPairBetCount" class="text-sm text-gray-300"
                  >0ëª…</span
                >
              </div>
            </div>
            <!-- ë±…ì»¤ í˜ì–´ ë² íŒ… -->
            <div
              class="bg-gradient-to-br from-pink-800 to-pink-700 p-4 rounded-lg"
            >
              <div class="text-sm text-gray-300 mb-1">B í˜ì–´</div>
              <div class="flex justify-between items-center">
                <span
                  id="adminBankerPairBetAmount"
                  class="text-xl font-bold text-white"
                  >0 ì›</span
                >
                <span id="adminBankerPairBetCount" class="text-sm text-gray-300"
                  >0ëª…</span
                >
              </div>
            </div>
            <!-- ì´ ë² íŒ… í˜„í™© -->
            <div
              class="bg-gradient-to-br from-gray-700 to-gray-600 p-4 rounded-lg"
            >
              <div class="text-sm text-gray-300 mb-1">ì´ê³„</div>
              <div class="flex justify-between items-center">
                <span
                  id="adminTotalBetAmount"
                  class="text-xl font-bold text-white"
                  >0 ì›</span
                >
                <span id="adminTotalBetCount" class="text-sm text-gray-300"
                  >0ëª…</span
                >
              </div>
            </div>
          </div>
        </div>

        <!-- ê²Œì„ ê²°ê³¼ ê´€ë¦¬ -->
        <div id="pendingResult" class="hidden">
          <div class="bg-gray-900 p-4 rounded-lg mb-4">
            <h3 class="text-lg font-semibold mb-3 text-gray-300">
              ëŒ€ê¸° ì¤‘ì¸ ê²Œì„ ê²°ê³¼
            </h3>
            <div id="resultDetails" class="mb-4"></div>
            <div class="flex justify-end space-x-4">
              <button
                id="approveResult"
                class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded"
              >
                ìŠ¹ì¸
              </button>
              <button
                id="rejectResult"
                class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded"
              >
                ê±°ì ˆ
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- ì¶©ì „ ë° í™˜ì „ ê´€ë¦¬ ì„¹ì…˜ -->
      <div class="mb-6 bg-gray-800 p-6 rounded-lg shadow">
        <h2 class="text-2xl font-semibold mb-4 text-purple-400">
          ì¶©ì „ ë° í™˜ì „ ê´€ë¦¬
        </h2>

        <!-- ì¬ì • ìš”ì•½ -->
        <div class="mb-6 bg-gray-700/50 p-4 rounded-lg">
          <h3 class="text-lg font-semibold mb-3 text-gray-300">ì¬ì • ìš”ì•½</h3>
          <div class="max-h-[400px] overflow-y-auto custom-scrollbar">
            <table class="min-w-full bg-gray-900 rounded-lg">
              <thead class="bg-gray-800 sticky top-0">
                <tr>
                  <th class="py-3 px-4 text-left">ì‚¬ìš©ì</th>
                  <th class="py-3 px-4 text-right">í˜„ì¬ ì”ì•¡</th>
                  <th class="py-3 px-4 text-right">ì´ ì¶©ì „ì•¡</th>
                  <th class="py-3 px-4 text-right">ì´ í™˜ì „ì•¡</th>
                  <th class="py-3 px-4 text-right">ì†ìµ</th>
                  <th class="py-3 px-4 text-center">ê´€ë¦¬</th>
                </tr>
              </thead>
              <tbody id="financialSummaryTable">
                <!-- ì¬ì • ìš”ì•½ ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- ì¶©ì „ ìš”ì²­ -->
        <div class="mb-6 bg-gray-700/50 p-4 rounded-lg">
          <h3 class="text-lg font-semibold mb-3 text-gray-300">ì¶©ì „ ìš”ì²­</h3>
          <div class="max-h-[400px] overflow-y-auto custom-scrollbar">
            <table class="min-w-full bg-gray-900 rounded-lg">
              <thead class="bg-gray-800 sticky top-0">
                <tr>
                  <th class="py-3 px-4 text-left">ì‹ ì²­ì‹œê°„</th>
                  <th class="py-3 px-4 text-left">ì‚¬ìš©ì</th>
                  <th class="py-3 px-4 text-right">ì‹ ì²­ê¸ˆì•¡(ì›)</th>
                  <th class="py-3 px-4 text-center">ìƒíƒœ</th>
                  <th class="py-3 px-4 text-center">ê´€ë¦¬</th>
                </tr>
              </thead>
              <tbody id="depositRequestsTable">
                <!-- ì¶©ì „ ìš”ì²­ ëª©ë¡ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- í™˜ì „ ìš”ì²­ -->
        <div class="bg-gray-700/50 p-4 rounded-lg">
          <h3 class="text-lg font-semibold mb-3 text-gray-300">í™˜ì „ ìš”ì²­</h3>
          <div class="max-h-[400px] overflow-y-auto custom-scrollbar">
            <table class="min-w-full bg-gray-900 rounded-lg">
              <thead class="bg-gray-800 sticky top-0">
                <tr>
                  <th class="py-3 px-4 text-left">ì‹ ì²­ì‹œê°„</th>
                  <th class="py-3 px-4 text-left">ì‚¬ìš©ì</th>
                  <th class="py-3 px-4 text-right">ì‹ ì²­ê¸ˆì•¡(ì›)</th>
                  <th class="py-3 px-4 text-right">ì‹¤ìˆ˜ë ¹ì•¡(ì›)</th>
                  <th class="py-3 px-4 text-center">ìƒíƒœ</th>
                  <th class="py-3 px-4 text-center">ê´€ë¦¬</th>
                </tr>
              </thead>
              <tbody id="exchangeRequestsTable">
                <!-- í™˜ì „ ìš”ì²­ ëª©ë¡ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ì‚¬ìš©ì ê´€ë¦¬ ì„¹ì…˜ ìˆ˜ì • -->
      <div class="mb-6 bg-gray-800 p-6 rounded-lg shadow">
        <h2 class="text-2xl font-semibold mb-4 text-purple-400">ì‚¬ìš©ì ê´€ë¦¬</h2>
        <div class="max-h-[400px] overflow-y-auto custom-scrollbar">
          <table class="min-w-full bg-gray-900 rounded-lg">
            <thead class="bg-gray-800 sticky top-0">
              <tr>
                <th class="py-3 px-4 text-left">ì‚¬ìš©ì</th>
                <th class="py-3 px-4 text-right">ì”ì•¡(ì›)</th>
                <th class="py-3 px-4 text-center">ìƒíƒœ</th>
                <th class="py-3 px-4 text-center">ê¶Œí•œ</th>
                <th class="py-3 px-4 text-right">ìŠ¹ë¦¬</th>
                <th class="py-3 px-4 text-right">íŒ¨ë°°</th>
                <th class="py-3 px-4 text-right">ì´ ë² íŒ…</th>
                <th class="py-3 px-4 text-right">ìŠ¹ë¥ </th>
                <th class="py-3 px-4 text-center">ê´€ë¦¬</th>
              </tr>
            </thead>
            <tbody id="userTable">
              <!-- ì‚¬ìš©ì ëª©ë¡ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- ìµœê·¼ ê²Œì„ ê¸°ë¡ ì„¹ì…˜ ìˆ˜ì • -->
      <div class="mb-6 bg-gray-800 p-6 rounded-lg shadow">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-2xl font-semibold text-purple-400">ìµœê·¼ ê²Œì„ ê¸°ë¡</h2>
          <button
            onclick="resetGameHistory()"
            class="bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded text-sm font-medium transition-colors flex items-center gap-2"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-4 w-4"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
              />
            </svg>
            ê¸°ë¡ ì´ˆê¸°í™”
          </button>
        </div>

        <!-- ê²Œì„ ê²°ê³¼ í†µê³„ -->
        <div class="grid grid-cols-4 gap-4 mb-6">
          <div
            class="bg-gradient-to-br from-blue-900 to-blue-800 p-4 rounded-lg"
          >
            <div class="text-sm text-gray-300 mb-1">í”Œë ˆì´ì–´ ìŠ¹ë¦¬</div>
            <div class="flex justify-between items-center">
              <div id="playerWins" class="text-xl font-bold text-white">0</div>
              <div id="playerWinRate" class="text-sm text-gray-300">0%</div>
            </div>
          </div>
          <div class="bg-gradient-to-br from-red-900 to-red-800 p-4 rounded-lg">
            <div class="text-sm text-gray-300 mb-1">ë±…ì»¤ ìŠ¹ë¦¬</div>
            <div class="flex justify-between items-center">
              <div id="bankerWins" class="text-xl font-bold text-white">0</div>
              <div id="bankerWinRate" class="text-sm text-gray-300">0%</div>
            </div>
          </div>
          <div
            class="bg-gradient-to-br from-purple-900 to-purple-800 p-4 rounded-lg"
          >
            <div class="text-sm text-gray-300 mb-1">íƒ€ì´</div>
            <div class="flex justify-between items-center">
              <div id="tieWins" class="text-xl font-bold text-white">0</div>
              <div id="tieWinRate" class="text-sm text-gray-300">0%</div>
            </div>
          </div>
          <div
            class="bg-gradient-to-br from-gray-700 to-gray-800 p-4 rounded-lg"
          >
            <div class="text-sm text-gray-300 mb-1">ì „ì²´ ê²Œì„</div>
            <div class="text-xl font-bold text-white" id="totalGames">0</div>
          </div>
        </div>

        <!-- ìµœê·¼ ê²°ê³¼ í‘œì‹œ -->
        <div class="bg-gray-900 p-4 rounded-lg mb-6">
          <h3 class="text-lg font-semibold mb-3 text-gray-300">ê²°ê³¼ íŒ¨í„´</h3>
          <div class="grid grid-cols-6 gap-1" id="recentResults">
            <!-- ìµœê·¼ ê²°ê³¼ê°€ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
          </div>
        </div>

        <!-- ìƒì„¸ ê¸°ë¡ í…Œì´ë¸” -->
        <div class="overflow-x-auto max-h-[400px] custom-scrollbar">
          <table class="min-w-full bg-gray-900 rounded-lg">
            <thead class="bg-gray-800 sticky top-0 z-10">
              <tr>
                <th class="py-3 px-4 text-left">ë²ˆí˜¸</th>
                <th class="py-3 px-4 text-left">ê²°ê³¼</th>
                <th class="py-3 px-4 text-left">ì‹œê°„</th>
                <th class="py-3 px-4 text-right">ì´ ë² íŒ…ì•¡(ì›)</th>
                <th class="py-3 px-4 text-right">ë² íŒ… ì¸ì›</th>
                <th class="py-3 px-4 text-center">Pí˜ì–´</th>
                <th class="py-3 px-4 text-center">Bí˜ì–´</th>
              </tr>
            </thead>
            <tbody id="recentGamesTable">
              <!-- ê²Œì„ ê¸°ë¡ì´ ì—¬ê¸° ì¶”ê°€ ë©ë‹ˆë‹¤ -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- ë¦¬ë”ë³´ë“œ ì„¹ì…˜ ìˆ˜ì • -->
      <div class="mb-6 bg-gray-800 p-6 rounded-lg shadow">
        <h2 class="text-2xl font-semibold mb-4 text-purple-400">ë¦¬ë”ë³´ë“œ</h2>
        <div class="max-h-[400px] overflow-y-auto custom-scrollbar">
          <table class="min-w-full bg-gray-900 rounded-lg">
            <thead class="bg-gray-800 sticky top-0">
              <tr>
                <th class="py-3 px-4 text-left">ìˆœìœ„</th>
                <th class="py-3 px-4 text-left">ì‚¬ìš©ì</th>
                <th class="py-3 px-4 text-right">ë³´ìœ ì•¡(ì›)</th>
                <th class="py-3 px-4 text-right">ìŠ¹ë¥ </th>
                <th class="py-3 px-4 text-right">ì´ ë² íŒ…</th>
              </tr>
            </thead>
            <tbody id="leaderboardTable">
              <!-- ë¦¬ë”ë³´ë“œ ëª©ì´í„°ê°€ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- ì „ì²´ ë² íŒ… ê¸°ë¡ ì„¹ì…˜ ìˆ˜ì • -->
      <div class="mb-6 bg-gray-800 p-6 rounded-lg shadow">
        <h2 class="text-2xl font-semibold mb-4 text-purple-400">
          ì „ì²´ ë² íŒ… ê¸°ë¡
        </h2>
        <div class="max-h-[400px] overflow-y-auto custom-scrollbar">
          <table class="min-w-full bg-gray-900 rounded-lg">
            <thead class="bg-gray-800 sticky top-0">
              <tr>
                <th class="py-3 px-4 text-left">ì‹œê°„</th>
                <th class="py-3 px-4 text-left">ì‚¬ìš©ì</th>
                <th class="py-3 px-4 text-center">ì„ íƒ</th>
                <th class="py-3 px-4 text-right">ë² íŒ…ì•¡(ì›)</th>
                <th class="py-3 px-4 text-center">ê²°ê³¼</th>
              </tr>
            </thead>
            <tbody id="allBettingHistoryTable">
              <!-- ë² íŒ… ê¸°ë¡ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- í† ìŠ¤íŠ¸ ë©”ì‹œì§€ -->
      <div id="toast" class="toast">ë©”ì‹œì§€ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>

      <!-- ì˜¤ë””ì˜¤ ìš”ì†Œë“¤ -->
      <audio id="bettingStartSound" src="sound.mp3" preload="auto"></audio>
      <audio id="bettingEndSound" src="endsound.mp3" preload="auto"></audio>
      <audio id="playerWinSound" src="player.mp3" preload="auto"></audio>
      <audio id="bankerWinSound" src="banker.mp3" preload="auto"></audio>
      <audio id="tieSound" src="tie.mp3" preload="auto"></audio>
    </div>

    <script>
      const token = localStorage.getItem("token");
      if (!token) {
        window.location.href = "index.html";
      }

      let socket = io(
        "https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app"
      );

      // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
      function showToast(message, type = "default") {
        const toast = document.getElementById("toast");
        toast.textContent = message;

        // ê¸°ì¡´ íƒ€ì… í´ë˜ìŠ¤ ì œê±°
        toast.classList.remove("toast-info", "toast-success", "toast-error");

        // íƒ€ì…ë³„ ìŠ¤íƒ€ì¼ ì ìš©
        if (type === "info") {
          toast.classList.add("toast-info");
        } else if (type === "success") {
          toast.classList.add("toast-success");
        } else if (type === "error") {
          toast.classList.add("toast-error");
        }

        toast.classList.add("show");
        setTimeout(() => {
          toast.classList.remove("show");
        }, 3000);
      }

      // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ì„ ìœ„í•œ ìš”ì²­
      async function fetchUsers() {
        try {
          const res = await fetch(
            "https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/users-stats",
            {
              headers: { Authorization: `Bearer ${token}` },
            }
          );

          if (res.status === 403 || res.status === 401) {
            showToast("ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");
            window.location.href = "index.html";
          }

          const stats = await res.json();
          const userTable = document.getElementById("userTable");
          userTable.innerHTML = "";

          stats.forEach((user, index) => {
            const tr = document.createElement("tr");
            tr.classList.add("text-center");
            tr.innerHTML = `
                <td class="py-2">${user.username}</td>
                <td class="py-2">${user.balance} ì›</td>
                <td class="py-2">${user.role}</td>
                <td class="py-2">${user.isApproved ? "ìŠ¹ì¸ë¨" : "ëŒ€ê¸° ì¤‘"}</td>
                <td class="py-2">${user.wins}</td>
                <td class="py-2">${user.losses}</td>
                <td class="py-2">${user.totalBets}</td>
                <td class="py-2">${user.winRate}</td>
                <td class="py-2">${user.profit} ì›</td>
                <td class="py-2">
                    ${
                      !user.isApproved
                        ? `<button data-id="${user.id}" class="approve-user bg-purple-500 text-white px-2 py-1 rounded mr-2">ìŠ¹ì¸</button>`
                        : ""
                    }
                    <button data-id="${
                      user.id
                    }" class="reset-password bg-yellow-500 text-white px-2 py-1 rounded mr-2">ë¹„ë²ˆ ì´ˆê¸°í™”</button>
                    <button data-id="${
                      user.id
                    }" class="delete-user bg-red-500 text-white px-2 py-1 rounded mr-2">ì‚­ì œ</button>
                    ${
                      user.role !== "superadmin"
                        ? `
                    <button 
                      onclick="toggleAdmin('${user._id}', '${user.role}')"
                      class="${
                        user.role === "admin"
                          ? "bg-gray-600 hover:bg-gray-700"
                          : "bg-purple-600 hover:bg-purple-700"
                      } text-white px-2.5 py-1.5 rounded text-sm font-medium transition-colors"
                    >
                      ${user.role === "admin" ? "ê´€ë¦¬ì í•´ì œ" : "ê´€ë¦¬ì ì§€ì •"}
                    </button>
                  `
                        : ""
                    }
                    <button data-id="${
                      user.id
                    }" class="adjust-coins bg-yellow-600 hover:bg-yellow-700 text-white px-2.5 py-1.5 rounded text-sm font-medium transition-colors"
                    >
                      ì”ì•¡ ì¡°ì ˆ
                    </button>
                    
            `;
            userTable.appendChild(tr);
          });

          // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
          document.querySelectorAll(".approve-user").forEach((button) => {
            button.addEventListener("click", function () {
              const userId = this.getAttribute("data-id");
              approveUser(userId);
            });
          });
          document.querySelectorAll(".delete-user").forEach((button) => {
            button.addEventListener("click", function () {
              const userId = this.getAttribute("data-id");
              deleteUser(userId);
            });
          });
          document.querySelectorAll(".reset-password").forEach((button) => {
            button.addEventListener("click", function () {
              const userId = this.getAttribute("data-id");
              resetPassword(userId);
            });
          });
          document.querySelectorAll(".toggle-admin").forEach((button) => {
            button.addEventListener("click", function () {
              const userId = this.getAttribute("data-id");
              const currentRole = this.getAttribute("data-role");
              toggleAdmin(userId, currentRole);
            });
          });
          document.querySelectorAll(".adjust-coins").forEach((button) => {
            button.addEventListener("click", function () {
              const userId = this.getAttribute("data-id");
              adjustCoins(userId);
            });
          });
          document.querySelectorAll(".view-betting").forEach((button) => {
            button.addEventListener("click", viewBettingDetails);
          });
        } catch (err) {}
      }

      async function approveUser(userId) {
        if (!confirm("ì´ ì‚¬ìš©ìë¥¼ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

        try {
          const res = await fetch(
            `https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/users/${userId}/approve`,
            {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`,
              },
            }
          );

          const data = await res.json();

          if (res.ok) {
            showToast(data.message);
            fetchUsers(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          } else {
            showToast(data.message || "ì‚¬ìš©ì ìŠ¹ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          }
        } catch (err) {
          showToast("ì„œë²„ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      async function deleteUser(userId) {
        if (!confirm("ì •ë§ë¡œ ì´ ì‚¬ìš©ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

        try {
          const res = await fetch(
            `https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/users/${userId}`,
            {
              method: "DELETE",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`,
              },
            }
          );

          const data = await res.json();

          if (res.ok) {
            showToast(data.message);
            fetchUsers(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          } else {
            showToast(data.message || "ì‚¬ìš©ì ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          }
        } catch (err) {
          showToast("ì„œë²„ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      async function resetPassword(e) {
        const userId = e.target.getAttribute("data-id");
        const newPassword = prompt("ìƒˆ ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
        if (newPassword) {
          try {
            const res = await fetch(
              `https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/users/${userId}/reset-password`,
              {
                method: "PUT",
                headers: {
                  "Content-Type": "application/json",
                  Authorization: `Bearer ${token}`,
                },
                body: JSON.stringify({ newPassword }),
              }
            );
            const data = await res.json();
            showToast(data.message);
          } catch (err) {}
        }
      }

      async function toggleAdmin(userId, currentRole) {
        const isAdmin = currentRole === "admin";
        const action = isAdmin ? "í•´ì œ" : "ì§€ì •";

        if (!confirm(`ì´ ì‚¬ìš©ìë¥¼ ê´€ë¦¬ìì„œ ${action}í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

        try {
          const res = await fetch(
            `https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/users/${userId}/toggle-admin`,
            {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`,
              },
              body: JSON.stringify({ setAdmin: !isAdmin }),
            }
          );

          if (res.ok) {
            showToast(`ê´€ë¦¬ìê°€ ${action}ë˜ì—ˆë‹ˆë‹¤.`);
            fetchUsers();
          } else {
            showToast(`ê´€ë¦¬ì ${action}ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.`);
          }
        } catch (err) {
          showToast("ì„œë²„ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ì‹¤ì‹œê°„ ë² íŒ… í˜„í™© ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ê°œì„ ëœ ë²„ì „)
      function updateBettingStats(stats) {
        // ê° ë² íŒ… ì˜µì…˜ì— ëŒ€í•œ ê¸ˆì•¡ ë° ì¸ì›ìˆ˜ ì—…ë°ì´íŠ¸
        const playerAmountEl = document.getElementById("adminPlayerBetAmount");
        const playerCountEl = document.getElementById("adminPlayerBetCount");
        if (playerAmountEl)
          playerAmountEl.textContent = formatAdminAmount(
            stats.player?.total_bet_amount
          );
        if (playerCountEl)
          playerCountEl.textContent = (stats.player?.bettor_count || 0) + "ëª…";

        const bankerAmountEl = document.getElementById("adminBankerBetAmount");
        const bankerCountEl = document.getElementById("adminBankerBetCount");
        if (bankerAmountEl)
          bankerAmountEl.textContent = formatAdminAmount(
            stats.banker?.total_bet_amount
          );
        if (bankerCountEl)
          bankerCountEl.textContent = (stats.banker?.bettor_count || 0) + "ëª…";

        const tieAmountEl = document.getElementById("adminTieBetAmount");
        const tieCountEl = document.getElementById("adminTieBetCount");
        if (tieAmountEl)
          tieAmountEl.textContent = formatAdminAmount(
            stats.tie?.total_bet_amount
          );
        if (tieCountEl)
          tieCountEl.textContent = (stats.tie?.bettor_count || 0) + "ëª…";

        const playerPairAmountEl = document.getElementById(
          "adminPlayerPairBetAmount"
        );
        const playerPairCountEl = document.getElementById(
          "adminPlayerPairBetCount"
        );
        if (playerPairAmountEl)
          playerPairAmountEl.textContent = formatAdminAmount(
            stats.player_pair?.total_bet_amount
          );
        if (playerPairCountEl)
          playerPairCountEl.textContent =
            (stats.player_pair?.bettor_count || 0) + "ëª…";

        const bankerPairAmountEl = document.getElementById(
          "adminBankerPairBetAmount"
        );
        const bankerPairCountEl = document.getElementById(
          "adminBankerPairBetCount"
        );
        if (bankerPairAmountEl)
          bankerPairAmountEl.textContent = formatAdminAmount(
            stats.banker_pair?.total_bet_amount
          );
        if (bankerPairCountEl)
          bankerPairCountEl.textContent =
            (stats.banker_pair?.bettor_count || 0) + "ëª…";

        // ì´ê³„ ê³„ì‚° ë° ì—…ë°ì´íŠ¸
        const totalBetAmount =
          (stats.player?.total_bet_amount || 0) +
          (stats.banker?.total_bet_amount || 0) +
          (stats.tie?.total_bet_amount || 0) +
          (stats.player_pair?.total_bet_amount || 0) +
          (stats.banker_pair?.total_bet_amount || 0);

        const totalBetCount =
          (stats.player?.bettor_count || 0) +
          (stats.banker?.bettor_count || 0) +
          (stats.tie?.bettor_count || 0) +
          (stats.player_pair?.bettor_count || 0) +
          (stats.banker_pair?.bettor_count || 0);

        const totalAmountEl = document.getElementById("adminTotalBetAmount");
        const totalCountEl = document.getElementById("adminTotalBetCount");
        if (totalAmountEl)
          totalAmountEl.textContent = formatAdminAmount(totalBetAmount);
        if (totalCountEl) totalCountEl.textContent = totalBetCount + "ëª…";
      }

      // ì‚¬ìš©ì í…Œì´ë¸”ì—ì„œ íŠ¹ì • ì‚¬ìš©ìì˜ ì”ì•¡ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
      function updateUserBalanceInTable(userId, newBalance) {
        const userTable = document.getElementById("userTable");
        if (!userTable) return;

        const rows = userTable.querySelectorAll("tr");
        rows.forEach((row) => {
          const adjustButton = row.querySelector(
            `.adjust-coins[data-id="${userId}"]`
          );
          if (adjustButton) {
            // í•´ë‹¹ ì‚¬ìš©ìì˜ í–‰ì„ ì°¾ì•˜ìœ¼ë©´ ì”ì•¡ ì—…ë°ì´íŠ¸
            const balanceCell = row.querySelector("td:nth-child(2)"); // ì”ì•¡ ì—´
            if (balanceCell) {
              balanceCell.innerHTML = `<span class="text-yellow-400 font-bold">${newBalance.toLocaleString()} ì›</span>`;

              // ì—…ë°ì´íŠ¸ íš¨ê³¼ ì¶”ê°€
              balanceCell.style.background = "rgba(34, 197, 94, 0.2)";
              setTimeout(() => {
                balanceCell.style.background = "";
              }, 1500);
            }
          }
        });
      }

      // admin.htmlìš© ê¸ˆì•¡ í¬ë§·íŒ… í•¨ìˆ˜
      function formatAdminAmount(amount) {
        if (typeof amount !== "number") amount = 0;
        return amount.toLocaleString() + " ì›";
      }

      // ê²Œì„ ê²°ê³¼ ìŠ¹ì¸ í›„ ìë™ ë°ì´í„° ì—…ë°ì´íŠ¸
      function handleResultApproved() {
        // ë² íŒ… í†µê³„ ì´ˆê¸°í™”
        const emptyStats = {
          player: { total_bet_amount: 0, bettor_count: 0 },
          banker: { total_bet_amount: 0, bettor_count: 0 },
          tie: { total_bet_amount: 0, bettor_count: 0 },
          player_pair: { total_bet_amount: 0, bettor_count: 0 },
          banker_pair: { total_bet_amount: 0, bettor_count: 0 },
        };
        updateBettingStats(emptyStats);

        // ìµœê·¼ ê²Œì„ ê¸°ë¡ ì—…ë°ì´íŠ¸
        fetchRecentGames();

        // ì‚¬ìš©ì ëª©ë¡ ì—…ë°ì´íŠ¸ (ì”ì•¡ ë³€ê²½ ë°˜ì˜)
        fetchUsers();

        // ë² íŒ… ê¸°ë¡ ì—…ë°ì´íŠ¸
        fetchAllBettingHistory();

        // ê²Œì„ ìƒíƒœ UI ì—…ë°ì´íŠ¸
        updateGameControls();

        showToast("ê²Œì„ ê²°ê³¼ê°€ ìŠ¹ì¸ë˜ì–´ ëª¨ë“  ë°ì´í„°ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.");

        // ìë™ ë² íŒ… ëª¨ë“œì¸ ê²½ìš° ë‹¤ìŒ ê²Œì„ ìŠ¤ì¼€ì¤„
        if (autoGameState.isActive) {
          scheduleNextAutoBetting();
        }
      }

      // ê²Œì„ ìƒíƒœ ê´€ë¦¬ ìˆ˜ì •
      let gameState = {
        isBetting: false,
      };

      // ìë™ ë² íŒ… ìƒíƒœ ê´€ë¦¬
      let autoGameState = {
        isActive: false,
        autoTimer: null,
        countdownTimer: null,
        nextAutoStart: null,
      };

      // ê²Œì„ ìƒíƒœì— ë”°ë¥¸ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™” í•¨ìˆ˜ ìˆ˜ì •
      function updateGameControls() {
        const startButton = document.getElementById("startBetting");
        const autoStartButton = document.getElementById("autoStartBetting");
        const autoStopButton = document.getElementById("autoStopBetting");

        startButton.disabled = gameState.isBetting || autoGameState.isActive;
        autoStartButton.disabled =
          gameState.isBetting || autoGameState.isActive;

        // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
        if (gameState.isBetting || autoGameState.isActive) {
          startButton.classList.add("opacity-50", "cursor-not-allowed");
          autoStartButton.classList.add("opacity-50", "cursor-not-allowed");
        } else {
          startButton.classList.remove("opacity-50", "cursor-not-allowed");
          autoStartButton.classList.remove("opacity-50", "cursor-not-allowed");
        }

        // ìë™ ë² íŒ… ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€
        if (autoGameState.isActive) {
          autoStartButton.classList.add("hidden");
          autoStopButton.classList.remove("hidden");
        } else {
          autoStartButton.classList.remove("hidden");
          autoStopButton.classList.add("hidden");
        }
      }

      // ìë™ ë² íŒ… ì‹œì‘ í•¨ìˆ˜
      function startAutoBetting() {
        autoGameState.isActive = true;
        updateGameControls();
        updateAutoStatus("ìë™ ë² íŒ…ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
        showToast("ğŸ¤– ìë™ ë² íŒ…ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!");

        // ì²« ë² íŒ… ì¦‰ì‹œ ì‹œì‘
        if (!gameState.isBetting) {
          triggerBettingStart();
        }
      }

      // ìë™ ë² íŒ… ì¤‘ì§€ í•¨ìˆ˜
      function stopAutoBetting() {
        autoGameState.isActive = false;

        // íƒ€ì´ë¨¸ë“¤ ì •ë¦¬
        if (autoGameState.autoTimer) {
          clearTimeout(autoGameState.autoTimer);
          autoGameState.autoTimer = null;
        }
        if (autoGameState.countdownTimer) {
          clearInterval(autoGameState.countdownTimer);
          autoGameState.countdownTimer = null;
        }

        updateGameControls();
        hideAutoStatus();
        showToast("â¹ï¸ ìë™ ë² íŒ…ì´ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤!");
      }

      // ë² íŒ… ì‹œì‘ íŠ¸ë¦¬ê±° í•¨ìˆ˜
      function triggerBettingStart() {
        socket.emit("start_betting");
        gameState.isBetting = true;
        updateGameControls();

        // ë² íŒ… ì‹œì‘ ì†Œë¦¬ ì¬ìƒ
        const bettingStartSound = document.getElementById("bettingStartSound");
        bettingStartSound?.play();
      }

      // ìë™ ê²°ê³¼ ìŠ¹ì¸ í•¨ìˆ˜
      function autoApproveResult() {
        if (!autoGameState.isActive) return;

        const approveButton = document.getElementById("approveResult");
        if (approveButton && !approveButton.disabled) {
          // ìë™ ìŠ¹ì¸ ì‹¤í–‰
          approveButton.click();
        }
      }

      // ë‹¤ìŒ ìë™ ë² íŒ… ìŠ¤ì¼€ì¤„ í•¨ìˆ˜
      function scheduleNextAutoBetting() {
        if (!autoGameState.isActive) return;

        updateAutoStatus("ë‹¤ìŒ ìë™ ë² íŒ…ê¹Œì§€");
        autoGameState.nextAutoStart = Date.now() + 4000; // 4ì´ˆ í›„

        // ì¹´ìš´íŠ¸ë‹¤ìš´ í‘œì‹œ
        startAutoCountdown();

        // 4ì´ˆ í›„ ë‹¤ìŒ ë² íŒ… ì‹œì‘
        autoGameState.autoTimer = setTimeout(() => {
          if (autoGameState.isActive && !gameState.isBetting) {
            triggerBettingStart();
          }
        }, 4000);
      }

      // ìë™ ë² íŒ… ì¹´ìš´íŠ¸ë‹¤ìš´ í‘œì‹œ
      function startAutoCountdown() {
        if (autoGameState.countdownTimer) {
          clearInterval(autoGameState.countdownTimer);
        }

        autoGameState.countdownTimer = setInterval(() => {
          if (!autoGameState.isActive || !autoGameState.nextAutoStart) {
            clearInterval(autoGameState.countdownTimer);
            return;
          }

          const remaining = Math.max(
            0,
            Math.ceil((autoGameState.nextAutoStart - Date.now()) / 1000)
          );
          const countdownEl = document.getElementById("autoCountdown");

          if (countdownEl) {
            countdownEl.textContent = `(${remaining}ì´ˆ)`;
          }

          if (remaining <= 0) {
            clearInterval(autoGameState.countdownTimer);
            autoGameState.countdownTimer = null;
            autoGameState.nextAutoStart = null;
          }
        }, 100);
      }

      // ìë™ ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
      function updateAutoStatus(message) {
        const autoStatusEl = document.getElementById("autoStatus");
        if (autoStatusEl) {
          autoStatusEl.classList.remove("hidden");
          autoStatusEl.innerHTML = `ğŸ¤– ${message} <span id="autoCountdown"></span>`;
        }
      }

      // ìë™ ìƒíƒœ í‘œì‹œ ìˆ¨ê¹€
      function hideAutoStatus() {
        const autoStatusEl = document.getElementById("autoStatus");
        if (autoStatusEl) {
          autoStatusEl.classList.add("hidden");
        }
      }

      // ë² íŒ… ì‹œì‘ ë²„íŠ¼ ì´ë²¤íŠ¸
      document
        .getElementById("startBetting")
        .addEventListener("click", async () => {
          triggerBettingStart();
        });

      // ìë™ ë² íŒ… ì‹œì‘ ë²„íŠ¼ ì´ë²¤íŠ¸
      document
        .getElementById("autoStartBetting")
        .addEventListener("click", () => {
          startAutoBetting();
        });

      // ìë™ ë² íŒ… ì¤‘ì§€ ë²„íŠ¼ ì´ë²¤íŠ¸
      document
        .getElementById("autoStopBetting")
        .addEventListener("click", () => {
          stopAutoBetting();
        });

      // ê²Œì„ ì»¨íŠ¸ë¡¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      document
        .getElementById("adminStartGame")
        .addEventListener("click", () => {
          socket.emit("admin_start_game");
          showToast("ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤!");
          document.getElementById("adminStartGame").disabled = true;
        });

      document
        .getElementById("adminShuffleDeck")
        .addEventListener("click", () => {
          socket.emit("admin_shuffle_deck");
          showToast("ë±ì„ ì…”í”Œí•©ë‹ˆë‹¤!");
        });

      // Socket.io ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤ (ê°œì„ ëœ ë²„ì „)
      socket.on("betting_status", (status) => {
        gameState.isBetting = status.active;
        updateGameControls();

        // ë² íŒ… ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
        const bettingStatusEl = document.getElementById("bettingStatus");
        if (bettingStatusEl) {
          if (status.active) {
            bettingStatusEl.textContent = "í˜„ì¬ ìƒíƒœ: ë² íŒ… ì¤‘";
            bettingStatusEl.className = "text-lg font-semibold text-green-400";
          } else {
            bettingStatusEl.textContent = "í˜„ì¬ ìƒíƒœ: ëŒ€ê¸°ì¤‘";
            bettingStatusEl.className = "text-lg font-semibold text-yellow-400";
          }
        }

        if (status.stats) {
          updateBettingStats(status.stats);
        }

        // ë² íŒ…ì´ í™œì„±í™”ë˜ì–´ ìˆê³  ì¢…ë£Œ ì‹œê°„ì´ ìˆìœ¼ë©´ íƒ€ì´ë¨¸ ì‹œì‘
        if (status.active && status.endTime) {
          startTimer(new Date(status.endTime));
        }
      });

      socket.on("betting_started", () => {
        const bettingStatusEl = document.getElementById("bettingStatus");
        if (bettingStatusEl) {
          bettingStatusEl.textContent = "í˜„ì¬ ìƒíƒœ: ë² íŒ… ì¤‘";
          bettingStatusEl.className = "text-lg font-semibold text-green-400";
        }
        gameState.isBetting = true;
        updateGameControls();
      });

      socket.on("betting_end_time", (endTime) => {
        startTimer(new Date(endTime));
      });

      socket.on("betting_closed", () => {
        const bettingStatusEl = document.getElementById("bettingStatus");
        const timerEl = document.getElementById("timer");

        if (bettingStatusEl) {
          bettingStatusEl.textContent = "í˜„ì¬ ìƒíƒœ: ë² íŒ… ë§ˆê°";
          bettingStatusEl.className = "text-lg font-semibold text-red-400";
        }

        gameState.isBetting = false;
        updateGameControls();

        if (timerEl) {
          timerEl.textContent = "";
        }

        // íƒ€ì´ë¨¸ ì •ë¦¬
        if (window.adminCountdownTimer) {
          clearInterval(window.adminCountdownTimer);
        }

        gameState.isBetting = false;
        updateGameControls();

        // ë² íŒ… ë§ˆê° ì†Œë¦¬ ì¬ìƒ
        const bettingEndSound = document.getElementById("bettingEndSound");
        if (bettingEndSound) {
          bettingEndSound.play().catch((err) => {});
        }

        // ë² íŒ… ë§ˆê° í›„ ìë™ìœ¼ë¡œ ê²Œì„ ì‹œì‘ (1ì´ˆ í›„)
        setTimeout(() => {
          socket.emit("admin_start_game");
        }, 1000);
      });

      // ìƒˆë¡œìš´ ë² íŒ…ì´ ë“¤ì–´ì˜¬ ë•Œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
      socket.on("new_bet", (data) => {
        if (data.stats) {
          updateBettingStats(data.stats);
        }
      });

      // ì‚¬ìš©ì ì”ì•¡ ë³€ê²½ ì‹œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
      socket.on("user_balance_updated", (data) => {
        if (data.userId && data.newBalance !== undefined) {
          updateUserBalanceInTable(data.userId, data.newBalance);
        }
      });

      // ê²Œì„ ê²°ê³¼ ìŠ¹ì¸/ê±°ì ˆ í›„ ìƒíƒœ ì´ˆê¸°í™”
      socket.on("result_approved", () => {
        const bettingStatusEl = document.getElementById("bettingStatus");
        if (bettingStatusEl) {
          bettingStatusEl.textContent = "í˜„ì¬ ìƒíƒœ: ëŒ€ê¸°ì¤‘";
          bettingStatusEl.className = "text-lg font-semibold text-yellow-400";
        }

        // ë² íŒ… í†µê³„ ì´ˆê¸°í™”
        updateBettingStats({
          player: { total_bet_amount: 0, bettor_count: 0 },
          banker: { total_bet_amount: 0, bettor_count: 0 },
          tie: { total_bet_amount: 0, bettor_count: 0 },
          player_pair: { total_bet_amount: 0, bettor_count: 0 },
          banker_pair: { total_bet_amount: 0, bettor_count: 0 },
        });

        // ê²Œì„ ê²°ê³¼ í‘œì‹œ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
        const gameResultDisplay = document.getElementById("gameResultDisplay");
        if (gameResultDisplay) {
          gameResultDisplay.classList.add("hidden");
        }

        // ê²Œì„ ì‹œì‘ ë²„íŠ¼ í™œì„±í™”
        document.getElementById("adminStartGame").disabled = false;

        // ì‚¬ìš©ì ëª©ë¡ê³¼ ê²Œì„ ê¸°ë¡ ìƒˆë¡œê³ ì¹¨
        fetchUsers();
        fetchRecentGames();

        // ìë™ ë² íŒ…ì´ í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ ë‹¤ìŒ ë² íŒ… ìŠ¤ì¼€ì¤„
        if (autoGameState.isActive) {
          scheduleNextAutoBetting();
        }
      });

      // ìƒˆë¡œìš´ ì¶©ì „ ìš”ì²­ ì•Œë¦¼
      socket.on("new_deposit_request", (data) => {
        showToast(
          `ğŸ’° ìƒˆë¡œìš´ ì¶©ì „ ìš”ì²­: ${
            data.username
          } - ${data.amount.toLocaleString()}ì›`,
          "info"
        );
        fetchDepositRequests(); // ì¶©ì „ ìš”ì²­ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        fetchFinancialSummary(); // ì¬ì • ìš”ì•½ ìƒˆë¡œê³ ì¹¨
      });

      // ìƒˆë¡œìš´ í™˜ì „ ìš”ì²­ ì•Œë¦¼
      socket.on("new_exchange_request", (data) => {
        showToast(
          `ğŸ’¸ ìƒˆë¡œìš´ í™˜ì „ ìš”ì²­: ${
            data.username
          } - ${data.requestAmount.toLocaleString()}ì› (ì‹¤ìˆ˜ë ¹: ${data.actualAmount.toLocaleString()}ì›)`,
          "info"
        );
        fetchExchangeRequests(); // í™˜ì „ ìš”ì²­ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        fetchFinancialSummary(); // ì¬ì • ìš”ì•½ ìƒˆë¡œê³ ì¹¨
      });

      // íƒ€ì´ë¨¸ ì‹œì‘ í•¨ìˆ˜
      function startTimer(endTime) {
        const timerElement = document.getElementById("timer");
        if (!timerElement) return;

        // ê¸°ì¡´ íƒ€ì´ë¨¸ê°€ ìˆìœ¼ë©´ ì •ë¦¬
        if (window.adminCountdownTimer) {
          clearInterval(window.adminCountdownTimer);
        }

        window.adminCountdownTimer = setInterval(() => {
          const now = new Date();
          const distance = endTime - now;
          if (distance < 0) {
            clearInterval(window.adminCountdownTimer);
            timerElement.textContent = "";
            return;
          }
          const seconds = Math.floor((distance / 1000) % 60);
          timerElement.innerHTML = `
            <span class="text-2xl font-bold ${
              seconds <= 10 ? "text-red-400 animate-pulse" : "text-blue-400"
            }">
              ${seconds}ì´ˆ
            </span>
          `;
        }, 1000);
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™” (ê°œì„ ëœ ë²„ì „)
      document.addEventListener("DOMContentLoaded", () => {
        updateGameControls();
        fetchAllBettingHistory();
        fetchRecentGames();
        fetchUsers(); // ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ
        fetchExchangeRequests(); // í™˜ì „ ìš”ì²­ ëª©ë¡ ë¡œë“œ
        fetchFinancialSummary(); // ì¬ì • ìš”ì•½ ë¡œë“œ
        fetchDepositRequests(); // ì¶©ì „ ìš”ì²­ ëª©ë¡ ë¡œë“œ

        // ì •ê¸°ì ì¸ ì—…ë°ì´íŠ¸ ì„¤ì •
        setInterval(() => {
          if (!gameState.isBetting) {
            fetchUsers(); // ë² íŒ… ì¤‘ì´ ì•„ë‹ ë•Œë§Œ ì‚¬ìš©ì ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            fetchFinancialSummary(); // ì¬ì • ìš”ì•½ë„ ì—…ë°ì´íŠ¸
          }
          fetchExchangeRequests(); // í™˜ì „ ìš”ì²­ì€ í•­ìƒ ì—…ë°ì´íŠ¸
          fetchDepositRequests(); // ì¶©ì „ ìš”ì²­ë„ í•­ìƒ ì—…ë°ì´íŠ¸
        }, 30000); // 30ì´ˆë§ˆë‹¤
      });

      // ë¦¬ë”ë³´ë“œ ê°€ì ¸ì˜¤ê¸°
      async function fetchLeaderboard() {
        try {
          const res = await fetch(
            "https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/leaderboard",
            {
              headers: { Authorization: `Bearer ${token}` },
            }
          );
          const leaderboard = await res.json();
          const leaderboardTable = document.getElementById("leaderboardTable");
          leaderboardTable.innerHTML = "";

          leaderboard.forEach((user, index) => {
            const tr = document.createElement("tr");
            tr.className = "border-t border-gray-800";

            const rankClass =
              index < 3
                ? [
                    "text-yellow-400 font-bold",
                    "text-gray-300 font-bold",
                    "text-orange-400 font-bold",
                  ][index]
                : "text-gray-400";

            tr.innerHTML = `
              <td class="py-3 px-4">
                <span class="${rankClass}">${index + 1}</span>
              </td>
              <td class="py-3 px-4">${user.username}</td>
              <td class="py-3 px-4 text-right text-yellow-400 font-bold">${
                user.balance
              } ì›</td>
              <td class="py-3 px-4 text-right">${user.winRate}%</td>
              <td class="py-3 px-4 text-right">${user.totalBets}</td>
            `;
            leaderboardTable.appendChild(tr);
          });
        } catch (err) {
          showToast("ë¦¬ë”ë³´ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ì „ì²´ ë² íŒ… ê¸°ë¡ ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜
      async function fetchAllBettingHistory() {
        try {
          const res = await fetch(
            "https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/all-betting-history",
            {
              headers: { Authorization: `Bearer ${token}` },
            }
          );

          if (!res.ok) {
            throw new Error("ë² íŒ… ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹¤.");
          }

          const allBets = await res.json();
          const container = document.getElementById("allBettingHistoryTable");
          container.innerHTML = "";

          if (allBets.length === 0) {
            container.innerHTML = `
              <tr>
                <td colspan="5" class="py-4 text-center text-gray-400">
                  ë² íŒ… ë¡ì´ ì—†ìŠµë‹ˆë‹¤.
                </td>
              </tr>
            `;
            return;
          }

          allBets.forEach((bet) => {
            const tr = document.createElement("tr");
            tr.className = "border-t border-gray-800";

            const resultClass =
              bet.result === "win"
                ? "text-green-400"
                : bet.result === "lose"
                ? "text-red-400"
                : "text-yellow-400";

            const resultText =
              bet.result === "win"
                ? "ìŠ¹ë¦¬"
                : bet.result === "lose"
                ? "íŒ¨ë°°"
                : "í™˜ê¸‰";

            const choiceKorean = {
              player: "í”Œë ˆì´ì–´",
              banker: "ë±…ì»¤",
              tie: "íƒ€ì´",
            };

            const profitClass =
              bet.profit >= 0 ? "text-green-400" : "text-red-400";
            const profitPrefix = bet.profit >= 0 ? "+" : "";

            tr.innerHTML = `
              <td class="py-3 px-4 text-sm text-gray-400">
                ${new Date(bet.date).toLocaleString()}
              </td>
              <td class="py-3 px-4">${bet.username}</td>
              <td class="py-3 px-4 text-center">
                ${choiceKorean[bet.choice]} â†’ ${choiceKorean[bet.gameResult]}
              </td>
              <td class="py-3 px-4 text-right">
                <span class="text-yellow-400">${bet.amount} ì›</span>
                <span class="${profitClass} ml-2">(${profitPrefix}${
              bet.profit
            } ì›)</span>
              </td>
              <td class="py-3 px-4 text-center">
                <span class="${resultClass} font-semibold">${resultText}</span>
              </td>
            `;
            container.appendChild(tr);
          });
        } catch (err) {
          showToast("ë² íŒ… ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ë¡œê·¸ì•„ì›ƒ
      document.getElementById("logout").addEventListener("click", () => {
        localStorage.removeItem("token");
        window.location.href = "index.html";
      });

      // ìµœê·¼ ê²Œì„ ê¸°ë¡ í‘œì‹œ í•¨ìˆ˜ ìˆ˜ì •
      async function fetchRecentGames() {
        try {
          const res = await fetch(
            "https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/recent-games?limit=20",
            {
              headers: { Authorization: `Bearer ${token}` },
            }
          );

          if (res.status === 403 || res.status === 401) {
            showToast("ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");
            window.location.href = "index.html";
          }

          const recentGames = await res.json();

          // í†µê³„ ê³„ì‚°
          const stats = {
            player: 0,
            banker: 0,
            tie: 0,
            total: recentGames.length,
          };

          recentGames.forEach((game) => {
            stats[game.result]++;
          });

          // í†µê³„ ì—…ë°ì´íŠ¸
          document.getElementById("playerWins").textContent = stats.player;
          document.getElementById("bankerWins").textContent = stats.banker;
          document.getElementById("tieWins").textContent = stats.tie;
          document.getElementById("totalGames").textContent = stats.total;

          // ìŠ¹ë¥  ê³„ì‚° ë° í‘œì‹œ
          if (stats.total > 0) {
            document.getElementById("playerWinRate").textContent = `${(
              (stats.player / stats.total) *
              100
            ).toFixed(1)}%`;
            document.getElementById("bankerWinRate").textContent = `${(
              (stats.banker / stats.total) *
              100
            ).toFixed(1)}%`;
            document.getElementById("tieWinRate").textContent = `${(
              (stats.tie / stats.total) *
              100
            ).toFixed(1)}%`;
          }

          // ê²°ê³¼ íŒ¨í„´ í‘œì‹œ
          const recentResultsContainer =
            document.getElementById("recentResults");
          recentResultsContainer.innerHTML = "";

          if (recentGames.length === 0) {
            recentResultsContainer.innerHTML = `<div class="text-center text-gray-500 py-4">ìµœê·¼ ê²Œì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
          } else {
            let currentColumn = null;
            let lastResultType = null;
            // APIì—ì„œ ìµœê·¼ 36ê°œ ì œí•œì„ ê±¸ ìˆ˜ ìˆì§€ë§Œ, í´ë¼ì´ì–¸íŠ¸ì—ì„œë„ í•œ ë²ˆ ë” ìŠ¬ë¼ì´ìŠ¤í•˜ì—¬ ìµœëŒ€ í‘œì‹œ ê°œìˆ˜ ê´€ë¦¬ (ì˜ˆ: ìµœê·¼ 72ê°œë¡œ ë¹…ë¡œë“œ êµ¬ì„±)
            const gamesToDisplay = recentGames.slice(-72).reverse(); // ìµœê·¼ 72ê°œë¡œ ë¹…ë¡œë“œ êµ¬ì„±, ì—­ìˆœìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼ ì˜¬ë°”ë¥¸ ìˆœì„œë¡œ í‘œì‹œ

            gamesToDisplay.forEach((game) => {
              const resultType = game.result;
              let cellText = resultType.charAt(0).toUpperCase();

              if (
                resultType !== lastResultType ||
                !currentColumn ||
                currentColumn.children.length >= 6
              ) {
                currentColumn = document.createElement("div");
                currentColumn.className = "result-column";
                recentResultsContainer.appendChild(currentColumn);
                lastResultType = resultType;
              }

              const resultElement = document.createElement("div");
              resultElement.className = `result-cell ${resultType}`;
              if (game.playerPairOccurred) {
                resultElement.classList.add("player-pair");
              }
              if (game.bankerPairOccurred) {
                resultElement.classList.add("banker-pair");
              }
              resultElement.textContent = cellText;
              currentColumn.appendChild(resultElement);
            });
            recentResultsContainer.scrollLeft =
              recentResultsContainer.scrollWidth; // í•­ìƒ ê°€ì¥ ìµœê·¼ ê²°ê³¼ê°€ ë³´ì´ë„ë¡ ìŠ¤í¬ë¡¤
          }

          // ìƒì„¸ ê¸°ë¡ í…Œì´ë¸” ì—…ë°ì´íŠ¸
          const recentGamesTable = document.getElementById("recentGamesTable");
          recentGamesTable.innerHTML = "";

          recentGames.forEach((game, index) => {
            const tr = document.createElement("tr");
            tr.className =
              "border-t border-gray-800 hover:bg-gray-800 transition-colors";

            const resultText =
              game.result === "player"
                ? "í”Œë ˆì´ì–´"
                : game.result === "banker"
                ? "ë±…ì»¤"
                : "íƒ€ì´";

            const resultClass =
              game.result === "player"
                ? "text-blue-400"
                : game.result === "banker"
                ? "text-red-400"
                : "text-green-400";

            tr.innerHTML = `
              <td class="py-3 px-4">${recentGames.length - index}</td>
              <td class="py-3 px-4">
                <span class="font-semibold ${resultClass}">${resultText}</span>
              </td>
              <td class="py-3 px-4">${new Date(game.date).toLocaleString()}</td>
              <td class="py-3 px-4 text-right">${game.totalBets} ì›</td>
              <td class="py-3 px-4 text-right">${game.playerCount}ëª…</td>
              <td class="py-3 px-4 text-center">${
                game.playerPairOccurred
                  ? '<span class="text-xs font-semibold px-1.5 py-0.5 rounded bg-blue-500 text-white">P</span>'
                  : "-"
              }</td>
              <td class="py-3 px-4 text-center">${
                game.bankerPairOccurred
                  ? '<span class="text-xs font-semibold px-1.5 py-0.5 rounded bg-red-500 text-white">B</span>'
                  : "-"
              }</td>
            `;
            recentGamesTable.appendChild(tr);
          });
        } catch (err) {
          showToast("ìµœê·¼ ê²Œì„ ê¸°ë¡ ë°í„°ë¥¼ ëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ì´ˆê¸° ë¦¬ë”ë³´ë“œ ë¡œë“œ (ë‹¤ë¥¸ í•­ëª©ë“¤ì€ DOMContentLoadedì—ì„œ ì²˜ë¦¬)
      fetchLeaderboard();

      // ì†Œì¼“ ì—°ê²° ë° ì´ˆê¸° ìƒíƒœ ìš”ì²­
      socket.on("connect", () => {
        socket.emit("authenticate", token);
        // ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ í˜„ì¬ ë² íŒ… ìƒíƒœ ìš”ì²­
        socket.emit("request_betting_status");
      });

      // ì‚¬ìš©ì ê´€ë¦¬ ì„¹ì…˜ ìˆ˜ì •
      async function fetchUsers() {
        try {
          const res = await fetch(
            "https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/users-stats",
            {
              headers: { Authorization: `Bearer ${token}` },
            }
          );

          if (!res.ok) {
            throw new Error("ì‚¬ìš©ì ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          }

          const users = await res.json();
          const userTable = document.getElementById("userTable");
          userTable.innerHTML = "";

          users.forEach((user) => {
            const tr = document.createElement("tr");
            tr.className =
              "border-t border-gray-800 hover:bg-gray-700/50 transition-colors";

            const roleClass =
              user.role === "admin" ? "text-purple-400" : "text-gray-300";
            const approvedClass = user.isApproved
              ? "text-green-400"
              : "text-red-400";
            const winRateClass =
              parseFloat(user.winRate) >= 50
                ? "text-green-400"
                : "text-gray-400";
            // ì†ìµ ê°’ì— ë”°ë¥¸ í´ë˜ìŠ¤ ì¶”ê°€
            const netProfit = user.netProfit || 0;
            const netProfitClass =
              netProfit > 0
                ? "text-green-400"
                : netProfit < 0
                ? "text-red-400"
                : "text-gray-400";

            tr.innerHTML = `
              <td class="py-3 px-4 font-medium">${user.username}</td>
              <td class="py-3 px-4 text-right text-yellow-400 font-bold">${
                user.balance
              } ì›</td>
              <td class="py-3 px-4 text-center">
                <span class="${approvedClass} font-medium">
                  ${user.isApproved ? "ìŠ¹ì¸ë¨" : "ë¯¸ìŠ¹ì¸"}
                </span>
              </td>
              <td class="py-3 px-4 text-center">
                <span class="${roleClass} font-medium">
                  ${user.role === "admin" ? "ê´€ë¦¬ì" : "ì¼ë°˜"}
                </span>
              </td>
              <td class="py-3 px-4 text-right text-green-400">${user.wins}</td>
              <td class="py-3 px-4 text-right text-red-400">${user.losses}</td>
              <td class="py-3 px-4 text-right">${user.totalBets}</td>
              <td class="py-3 px-4 text-right ${winRateClass}">${
              user.winRate
            }%</td>
              <td class="py-3 px-4 text-right ${netProfitClass}">${user.netProfit.toLocaleString()}ì›</td> <!-- ì†ìµ í‘œì‹œ -->
              <td class="py-3 px-4">
                <div class="flex justify-center gap-2">
                  <button 
                    class="adjust-coins bg-yellow-600 hover:bg-yellow-700 text-white px-2.5 py-1.5 rounded text-sm font-medium transition-colors"
                    data-id="${user._id}"
                  >
                    ì”ì•¡ ì¡°ì ˆ
                  </button>
                  ${
                    !user.isApproved
                      ? `
                    <button 
                      class="approve-user bg-green-600 hover:bg-green-700 text-white px-2.5 py-1.5 rounded text-sm font-medium transition-colors"
                      data-id="${user._id}"
                    >
                      ìŠ¹ì¸
                    </button>
                  `
                      : ""
                  }
                  ${
                    user.role !== "superadmin"
                      ? `
                    <button 
                      onclick="toggleAdmin('${user._id}', '${user.role}')"
                      class="${
                        user.role === "admin"
                          ? "bg-gray-600 hover:bg-gray-700"
                          : "bg-purple-600 hover:bg-purple-700"
                      } text-white px-2.5 py-1.5 rounded text-sm font-medium transition-colors"
                    >
                      ${user.role === "admin" ? "ê´€ë¦¬ì í•´ì œ" : "ê´€ë¦¬ì ì§€ì •"}
                    </button>
                  `
                      : ""
                  }
                  <button 
                    class="reset-password bg-blue-600 hover:bg-blue-700 text-white px-2.5 py-1.5 rounded text-sm font-medium transition-colors"
                    data-id="${user._id}"
                  >
                    ë¹„ë°€ë²ˆí˜¸
                  </button>
                  <button 
                    class="delete-user bg-red-600 hover:bg-red-700 text-white px-2.5 py-1.5 rounded text-sm font-medium transition-colors"
                    data-id="${user._id}"
                  >
                    ì‚­ì œ
                  </button>
                </div>
              </td>
            `;
            userTable.appendChild(tr);
          });

          // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
          setupUserManagementListeners();
        } catch (err) {
          showToast("ì‚¬ìš©ì ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ì‚¬ìš©ì ê´€ë¦¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
      function setupUserManagementListeners() {
        document.querySelectorAll(".adjust-coins").forEach((button) => {
          button.addEventListener("click", function () {
            const userId = this.getAttribute("data-id");
            adjustCoins(userId);
          });
        });

        document.querySelectorAll(".approve-user").forEach((button) => {
          button.addEventListener("click", function () {
            const userId = this.getAttribute("data-id");
            approveUser(userId);
          });
        });

        document.querySelectorAll(".delete-user").forEach((button) => {
          button.addEventListener("click", function () {
            const userId = this.getAttribute("data-id");
            deleteUser(userId);
          });
        });

        document.querySelectorAll(".reset-password").forEach((button) => {
          button.addEventListener("click", function () {
            const userId = this.getAttribute("data-id");
            resetPassword(userId);
          });
        });
      }

      // resetPassword í•¨ìˆ˜ ìˆ˜ì •
      async function resetPassword(userId) {
        const newPassword = prompt("ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
        if (!newPassword) return;

        try {
          const res = await fetch(
            `https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/users/${userId}/reset-password`,
            {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`,
              },
              body: JSON.stringify({ newPassword }),
            }
          );

          const data = await res.json();
          showToast(data.message);
          if (res.ok) {
            fetchUsers(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          }
        } catch (err) {
          showToast("ì„œë²„ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // adjustCoins í•¨ìˆ˜ ìˆ˜ì • (ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ê°œì„ )
      async function adjustCoins(userId) {
        const amount = prompt("ì¡°ì •í•  ê¸ˆì•¡(ì›)ì„ ì…ë ¥í•˜ì„¸ìš” (ìŒìˆ˜ ê°€ëŠ¥):");
        if (amount === null) return;

        const adjustment = parseInt(amount);
        if (isNaN(adjustment)) {
          showToast("ìœ íš¨í•œ ìˆ«ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }

        try {
          const res = await fetch(
            `https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/users/${userId}/adjust-coins`,
            {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`,
              },
              body: JSON.stringify({ adjustment }),
            }
          );

          const data = await res.json();
          showToast(data.message);
          if (res.ok) {
            // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸: íŠ¹ì • ì‚¬ìš©ì ì”ì•¡ë§Œ ì—…ë°ì´íŠ¸
            if (data.newBalance !== undefined) {
              updateUserBalanceInTable(userId, data.newBalance);
            } else {
              fetchUsers(); // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ê°€ ì•ˆ ë˜ë©´ ì „ì²´ ìƒˆë¡œê³ ì¹¨
            }
          }
        } catch (err) {
          showToast("ì„œë²„ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ê²Œì„ ê¸°ë¡ ì´ˆê¸°í™” í•¨ìˆ˜ ì¶”ê°€
      async function resetGameHistory() {
        if (
          !confirm(
            "ì •ë§ë¡œ ëª¨ë“  ê²Œì„ ê¸°ë¡ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
          )
        ) {
          return;
        }

        try {
          const res = await fetch(
            "https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/reset-game-history",
            {
              method: "DELETE",
              headers: {
                Authorization: `Bearer ${token}`,
              },
            }
          );

          if (res.ok) {
            showToast("ê²Œì„ ê¸°ë¡ì´ ì´ˆê¸°í™”ë˜ì—ˆë‹ˆë‹¤.");
            // í†µê³„ì™€ í…Œì´ë¸” ìƒˆë¡œê³ ì¹¨
            fetchRecentGames();
          } else {
            showToast("ê²Œì„ ê¸°ë¡ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          }
        } catch (err) {
          showToast("ì„œë²„ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // í™˜ì „ ìš”ì²­ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜ ìˆ˜ì •
      async function fetchExchangeRequests() {
        try {
          const res = await fetch(
            "https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/exchange-requests",
            {
              headers: { Authorization: `Bearer ${token}` },
            }
          );

          const requests = await res.json();
          const container = document.getElementById("exchangeRequestsTable");
          container.innerHTML = "";

          requests.forEach((request) => {
            const tr = document.createElement("tr");
            tr.className = "border-t border-gray-800";

            const statusClass = {
              pending: "text-yellow-400",
              approved: "text-green-400",
              rejected: "text-red-400",
            }[request.status];

            const statusText = {
              pending: "ëŒ€ê¸°ì¤‘",
              approved: "ìŠ¹ì¸ë¨",
              rejected: "ê±°ì ˆë¨",
            }[request.status];

            tr.innerHTML = `
              <td class="py-3 px-4">${new Date(
                request.createdAt
              ).toLocaleString()}</td>
              <td class="py-3 px-4">${request.username}</td>
              <td class="py-3 px-4 text-right text-yellow-400">${request.requestAmount.toLocaleString()} ì›</td>
              <td class="py-3 px-4 text-right">
                <div class="text-green-400">ì‹¤ìˆ˜ë ¹: ${request.actualAmount.toLocaleString()} ì›</div>
                <div class="text-red-400">ìˆ˜ìˆ˜ë£Œ: ${request.fee.toLocaleString()} ì›</div>
              </td>
              <td class="py-3 px-4 text-center">
                <span class="${statusClass} font-semibold">${statusText}</span>
              </td>
              <td class="py-3 px-4 text-center">
                ${
                  request.status === "pending"
                    ? `
                  <button 
                    onclick="handleExchange('${request._id}', 'approved')"
                    class="bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded mr-2"
                  >
                    ìŠ¹ì¸
                  </button>
                  <button 
                    onclick="handleExchange('${request._id}', 'rejected')"
                    class="bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded"
                  >
                    ê±°ì ˆ
                  </button>
                `
                    : ""
                }
              </td>
            `;
            container.appendChild(tr);
          });
        } catch (err) {
          showToast("í™˜ì „ ìš”ì²­ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // í™˜ì „ ìš”ì²­ ì²˜ë¦¬
      async function handleExchange(requestId, status) {
        if (
          !confirm(
            `ì •ë§ë¡œ ì´ í™˜ì „ ìš”ì²­ì„ ${
              status === "approved" ? "ìŠ¹ì¸" : "ê±°ì ˆ"
            }í•˜ì‹œê² ìŠµë‹ˆ?`
          )
        ) {
          return;
        }

        try {
          const res = await fetch(
            `https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/exchange-requests/${requestId}`,
            {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`,
              },
              body: JSON.stringify({ status }),
            }
          );

          const data = await res.json();
          showToast(data.message);

          if (res.ok) {
            fetchExchangeRequests(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            fetchFinancialSummary(); // ì¬ì • ìš”ì•½ ìƒˆë¡œê³ ì¹¨
          }
        } catch (err) {
          showToast("ì„œë²„ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // í™˜ì „ ìš”ì²­ ëª©ë¡ì€ DOMContentLoadedì—ì„œ ì²˜ë¦¬ë¨

      // Socket.IO ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      let currentPendingGameDetails = null; // ëŒ€ê¸°ì¤‘ì¸ ê²Œì„ ìƒì„¸ ì •ë³´ ì €ì¥
      let autoApproveTimerId = null; // ìë™ ìŠ¹ì¸ íƒ€ì´ë¨¸ ID

      // ê¸°ì¡´ game.html í˜¸í™˜ìš© game_result ì´ë²¤íŠ¸ (ìƒˆë¡œìš´ admin ì»¨íŠ¸ë¡¤ ì‹œìŠ¤í…œì´ ìš°ì„ )
      socket.on("game_result", (data) => {
        const {
          result,
          playerScore,
          bankerScore,
          timestamp,
          playerPairOccurred,
          bankerPairOccurred,
        } = data;

        // ê¸°ì¡´ ìë™ ìŠ¹ì¸ íƒ€ì´ë¨¸ê°€ ìˆë‹¤ë©´ ì·¨ì†Œ
        if (autoApproveTimerId) {
          clearTimeout(autoApproveTimerId);
          autoApproveTimerId = null;
        }

        currentPendingGameDetails = {
          result,
          playerScore,
          bankerScore,
          timestamp,
          playerPairOccurred: playerPairOccurred || false,
          bankerPairOccurred: bankerPairOccurred || false,
        };

        document.getElementById("pendingResult").classList.remove("hidden");
        document.getElementById("resultDetails").innerHTML = `
          <div class="bg-gray-700 p-4 rounded-lg mb-4">
            <div class="text-center text-xl font-bold mb-4">
              <span class="text-yellow-400">ìƒˆë¡œìš´ ê²Œì„ ê²°ê³¼</span>
            </div>
            <div class="grid grid-cols-2 gap-4 mb-4">
              <div class="bg-gray-800 p-3 rounded">
                <div class="text-sm text-gray-400">í”Œë ˆì´ì–´ ì ìˆ˜</div>
                <div class="text-xl font-bold text-blue-400">${playerScore}</div>
              </div>
              <div class="bg-gray-800 p-3 rounded">
                <div class="text-sm text-gray-400">ë±…ì»¤ ì ìˆ˜</div>
                <div class="text-xl font-bold text-red-400">${bankerScore}</div>
              </div>
            </div>
            <div class="text-center text-lg font-bold mb-4">
              ê²°ê³¼: <span class="text-yellow-400">${
                result === "player"
                  ? "í”Œë ˆì´ì–´ ìŠ¹"
                  : result === "banker"
                  ? "ë±…ì»¤ ìŠ¹"
                  : "íƒ€ì´"
              }</span>
            </div>
            <div class="text-sm text-gray-400 text-right">
              ${new Date(timestamp).toLocaleString()}
            </div>
          </div>
          <div class="text-center text-red-400 text-sm animate-pulse">
            * ê²°ê³¼ë¥¼ ìŠ¹ì¸í•˜ê±°ë‚˜ ê±°ì ˆí•´ì£¼ì„¸ìš” *
          </div>
        `;

        // ê²°ê³¼ ìŠ¹ì¸/ê±°ì ˆ ë²„íŠ¼ í™œí™”
        document.getElementById("approveResult").disabled = false;
        document.getElementById("rejectResult").disabled = false;

        // ìë™ ìŠ¹ì¸ íƒ€ì´ë¨¸ ì„¤ì • (ìë™ ë² íŒ… ëª¨ë“œì—ì„œëŠ” ì¦‰ì‹œ, ì•„ë‹ˆë©´ 2ì´ˆ í›„)
        const approvalDelay = autoGameState.isActive ? 1000 : 2000; // ìë™ ë² íŒ…ì‹œ 1ì´ˆ, ìˆ˜ë™ì‹œ 2ì´ˆ

        autoApproveTimerId = setTimeout(() => {
          const approveButton = document.getElementById("approveResult");
          // ë²„íŠ¼ì´ ì—¬ì „íˆ í™œì„±í™”ë˜ì–´ ìˆê³  (ì¦‰, ìˆ˜ë™ìœ¼ë¡œ í´ë¦­ë˜ì§€ ì•Šì•˜ê³ ), pendingResult ì„¹ì…˜ì´ ë³´ì´ëŠ” ê²½ìš°
          if (
            approveButton &&
            !approveButton.disabled &&
            !document
              .getElementById("pendingResult")
              .classList.contains("hidden")
          ) {
            const message = autoGameState.isActive
              ? "ğŸ¤– ìë™ ë² íŒ… ëª¨ë“œ: ê²Œì„ ê²°ê³¼ë¥¼ ìë™ìœ¼ë¡œ ìŠ¹ì¸í•©ë‹ˆë‹¤."
              : "2ì´ˆ ê²½ê³¼, ê²Œì„ ê²°ê³¼ë¥¼ ìë™ìœ¼ë¡œ ìŠ¹ì¸í•©ë‹ˆë‹¤.";
            showToast(message);
            approveButton.click();
          }
          autoApproveTimerId = null; // íƒ€ì´ë¨¸ ì‹¤í–‰ í›„ ID ì´ˆê¸°í™”
        }, approvalDelay);
      });

      // ìŠ¹ì¸/ê±°ì ˆ ë²„íŠ¼ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ìˆ˜ì •
      document.getElementById("approveResult").addEventListener("click", () => {
        if (autoApproveTimerId) {
          clearTimeout(autoApproveTimerId);
          autoApproveTimerId = null;
        }

        if (currentPendingGameDetails) {
          socket.emit("approve_result", currentPendingGameDetails);
          currentPendingGameDetails = null;
        } else {
          // Fallback ë˜ëŠ” ì˜¤ë¥˜ ì²˜ë¦¬: currentPendingGameDetailsê°€ ì—†ëŠ” ê²½ìš°
          // ê¸°ë³¸ approve_result ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œí‚¤ê±°ë‚˜, ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          // ì—¬ê¸°ì„œëŠ” ì´ì „ì²˜ëŸ¼ í˜ì–´ ì •ë³´ ì—†ì´ approve_resultë¥¼ ë³´ë‚´ë„ë¡ í•©ë‹ˆë‹¤.
          // í•˜ì§€ë§Œ ì´ ê²½ìš°ëŠ” ë°œìƒí•˜ì§€ ì•Šë„ë¡ game_result ìˆ˜ì‹  ì‹œ í•­ìƒ currentPendingGameDetailsê°€ ì„¤ì •ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
          socket.emit("approve_result");
        }
        document.getElementById("pendingResult").classList.add("hidden");

        // ê²°ê³¼ ìŠ¹ì¸ í›„ ì¦‰ì‹œ ë°ì´í„° ì—…ë°ì´íŠ¸
        setTimeout(() => {
          handleResultApproved();
        }, 1000); // 1ì´ˆ í›„ ì—…ë°ì´íŠ¸í•˜ì—¬ ì„œë²„ ì²˜ë¦¬ ì‹œê°„ í™•ë³´
      });

      document.getElementById("rejectResult").addEventListener("click", () => {
        if (autoApproveTimerId) {
          clearTimeout(autoApproveTimerId);
          autoApproveTimerId = null;
        }
        socket.emit("reject_result");
        document.getElementById("pendingResult").classList.add("hidden");
        showToast("ê²Œì„ ê²°ê³¼ê°€ ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤.");
      });

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ê²°ê³¼ ê´€ë¦¬ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
      document.addEventListener("DOMContentLoaded", () => {
        document.getElementById("pendingResult").classList.add("hidden");
      });

      // Socket.IO ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ìˆ˜ì •
      socket.on("recent_games_updated", (data) => {
        const { recentGames, stats: gameStats } = data; // ì„œë²„ì—ì„œ ì˜¤ëŠ” statsëŠ” ê²Œì„ ìŠ¹ë¦¬ í†µê³„ì´ë¯€ë¡œ gameStatsë¡œ ë³€ê²½
        // updateGameStats(recentGames, gameStats); // ì´ í•¨ìˆ˜ëŠ” ì´ì œ ìµœê·¼ ê²Œì„ 'ëª©ë¡' í†µê³„ë¥¼ ë‹¤ë£¸. ë² íŒ… í†µê³„ì™€ëŠ” ë‹¤ë¦„.
        // fetchRecentGames í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ í†µê³„ ì—…ë°ì´íŠ¸ê°€ ì´ë¯¸ ì²˜ë¦¬ë˜ê³  ìˆìŒ.
        // ë§Œì•½ ì—¬ê¸°ì„œë„ ìµœê·¼ ê²Œì„ ëª©ë¡ì— ëŒ€í•œ í†µê³„ë¥¼ í‘œì‹œí•´ì•¼ í•œë‹¤ë©´, í•´ë‹¹ ë¡œì§ì„ ì—¬ê¸°ì— ìœ ì§€.

        // ìµœê·¼ ê²Œì„ ê¸°ë¡ í…Œì´ë¸” ì—…ë°ì´íŠ¸
        const recentGamesTable = document.getElementById("recentGamesTable");
        if (recentGamesTable) {
          recentGamesTable.innerHTML = "";

          recentGames.forEach((game, index) => {
            const tr = document.createElement("tr");
            tr.className = "border-t border-gray-800";

            const resultClass = {
              player: "text-blue-400",
              banker: "text-red-400",
              tie: "text-green-400",
            }[game.result];

            const resultText =
              game.result === "player"
                ? "í”Œë ˆì´ì–´"
                : game.result === "banker"
                ? "ë±…ì»¤"
                : "íƒ€ì´";

            tr.innerHTML = `
              <td class="py-3 px-4">${recentGames.length - index}</td>
              <td class="py-3 px-4">
                 <span class="font-semibold ${resultClass}">${resultText}</span>
              </td>
              <td class="py-3 px-4">${new Date(game.date).toLocaleString()}</td>
              <td class="py-3 px-4 text-right">${formatAdminAmount(
                game.totalBets
              )}</td>
              <td class="py-3 px-4 text-right">${game.playerCount}ëª…</td>
              <td class="py-3 px-4 text-center">${
                game.playerPairOccurred
                  ? '<span class="text-xs font-semibold px-1.5 py-0.5 rounded bg-blue-500 text-white">P</span>'
                  : "-"
              }</td>
              <td class="py-3 px-4 text-center">${
                game.bankerPairOccurred
                  ? '<span class="text-xs font-semibold px-1.5 py-0.5 rounded bg-red-500 text-white">B</span>'
                  : "-"
              }</td>
            `;
            recentGamesTable.appendChild(tr);
          });
        }

        // "ìµœê·¼ ê²Œì„ ê¸°ë¡" ì„¹ì…˜ì˜ ì „ì²´ í†µê³„ ì—…ë°ì´íŠ¸ (P/B/T ìŠ¹ë¦¬ íšŸìˆ˜ ë“±)
        if (gameStats) {
          document.getElementById("playerWins").textContent =
            gameStats.playerWins || 0;
          document.getElementById("bankerWins").textContent =
            gameStats.bankerWins || 0;
          document.getElementById("tieWins").textContent = gameStats.ties || 0;
          document.getElementById("totalGames").textContent =
            gameStats.totalGames || 0;

          if (gameStats.totalGames > 0) {
            document.getElementById("playerWinRate").textContent = `${(
              (gameStats.playerWins / gameStats.totalGames) *
              100
            ).toFixed(1)}%`;
            document.getElementById("bankerWinRate").textContent = `${(
              (gameStats.bankerWins / gameStats.totalGames) *
              100
            ).toFixed(1)}%`;
            document.getElementById("tieWinRate").textContent = `${(
              (gameStats.ties / gameStats.totalGames) *
              100
            ).toFixed(1)}%`;
          } else {
            document.getElementById("playerWinRate").textContent = "0%";
            document.getElementById("bankerWinRate").textContent = "0%";
            document.getElementById("tieWinRate").textContent = "0%";
          }
        }
      });

      // ì‹¤ì‹œê°„ ë² íŒ… í˜„í™© ì—…ë°ì´íŠ¸ (new_bet ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬)
      socket.on("new_bet", (data) => {
        const { stats } = data;
        if (stats) {
          // stats ê°ì²´ê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
          updateBettingStats(stats); // ì‹¤ì‹œê°„ ë² íŒ… í˜„í™© ì—…ë°ì´íŠ¸ í•¨ìˆ˜ í˜¸ì¶œ
        }
      });

      // ê²°ê³¼ ìŠ¹ì¸ ì™„ë£Œ ì•Œë¦¼ ì²˜ë¦¬
      socket.on("admin_result_approved", (data) => {
        showToast(`âœ… ${data.message}`, 3000);

        // ìë™ ìƒˆë¡œê³ ì¹¨ ëŒ€ì‹  ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ í™•ì¸
        setTimeout(() => {
          // ì¶”ê°€ì ì¸ ë°ì´í„° ë™ê¸°í™”ê°€ í•„ìš”í•œ ê²½ìš° ì—¬ê¸°ì„œ ì²˜ë¦¬
          fetchUsers();
          fetchAllBettingHistory();
        }, 500);
      });

      // ê²Œì„ ê²°ê³¼ ìˆ˜ì‹  ì´ë²¤íŠ¸ (ì¹´ë“œ ì •ë³´ í¬í•¨)
      socket.on("game_result_with_cards", (gameData) => {
        // ê²Œì„ ê²°ê³¼ í‘œì‹œ ì„¹ì…˜ ë³´ì´ê¸°
        const gameResultDisplay = document.getElementById("gameResultDisplay");
        gameResultDisplay.classList.remove("hidden");

        // ì¹´ë“œ ì •ë³´ í‘œì‹œ
        displayCards("playerCards", gameData.playerHand);
        displayCards("bankerCards", gameData.bankerHand);

        // ì ìˆ˜ í‘œì‹œ
        document.getElementById(
          "playerScore"
        ).textContent = `${gameData.playerHand.calculation} = ${gameData.playerScore}`;
        document.getElementById(
          "bankerScore"
        ).textContent = `${gameData.bankerHand.calculation} = ${gameData.bankerScore}`;

        // ìŠ¹ì í‘œì‹œ
        const gameWinner = document.getElementById("gameWinner");
        let winnerText = "";
        let winnerClass = "";

        if (gameData.result === "player") {
          winnerText = "ğŸ‰ í”Œë ˆì´ì–´ ìŠ¹ë¦¬!";
          winnerClass = "text-blue-400";
        } else if (gameData.result === "banker") {
          winnerText = "ğŸ‰ ë±…ì»¤ ìŠ¹ë¦¬!";
          winnerClass = "text-red-400";
        } else {
          winnerText = "ğŸ¤ íƒ€ì´!";
          winnerClass = "text-green-400";
        }

        gameWinner.textContent = winnerText;
        gameWinner.className = `text-xl font-bold text-center mb-2 ${winnerClass}`;

        // í˜ì–´ ê²°ê³¼ í‘œì‹œ
        const pairResults = document.getElementById("pairResults");
        let pairText = "";
        if (gameData.playerPairOccurred || gameData.bankerPairOccurred) {
          const pairs = [];
          if (gameData.playerPairOccurred) pairs.push("í”Œë ˆì´ì–´ í˜ì–´");
          if (gameData.bankerPairOccurred) pairs.push("ë±…ì»¤ í˜ì–´");
          pairText = `${pairs.join(", ")} ë°œìƒ!`;
        } else {
          pairText = "í˜ì–´ ì—†ìŒ";
        }
        pairResults.textContent = pairText;

        // ë± ì •ë³´ ì—…ë°ì´íŠ¸
        updateDeckInfo(gameData.deckInfo);

        // ê²Œì„ ì‹œì‘ ë²„íŠ¼ í™œì„±í™”
        document.getElementById("adminStartGame").disabled = false;

        showToast("ê²Œì„ ê²°ê³¼ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!");
      });

      // ë± ì…”í”Œ ì™„ë£Œ ì´ë²¤íŠ¸
      socket.on("deck_shuffled", (data) => {
        showToast(data.message);
        updateDeckInfo(data.deckInfo);
      });

      // ë± ì •ë³´ ìˆ˜ì‹  ì´ë²¤íŠ¸
      socket.on("deck_info", (deckInfo) => {
        updateDeckInfo(deckInfo);
      });

      // ì¹´ë“œ í‘œì‹œ í•¨ìˆ˜
      function displayCards(containerId, handData) {
        const container = document.getElementById(containerId);
        container.innerHTML = "";

        handData.cards.forEach((card, index) => {
          const cardDiv = document.createElement("div");
          cardDiv.className =
            "inline-block mr-2 mb-1 px-2 py-1 bg-white text-black rounded text-sm font-bold";

          // ì¹´ë“œ ê°’ ë³€í™˜ (Të¥¼ 10ìœ¼ë¡œ í‘œì‹œ)
          let displayValue = card.value;
          if (card.value === "T") displayValue = "10";

          // ìŠˆíŠ¸ ì´ëª¨ì§€
          const suitEmoji = {
            hearts: "â™¥ï¸",
            diamonds: "â™¦ï¸",
            clubs: "â™£ï¸",
            spades: "â™ ï¸",
          };

          cardDiv.textContent = `${displayValue}${suitEmoji[card.suit] || ""}`;

          // ë¹¨ê°„ìƒ‰ ì¹´ë“œëŠ” ë¹¨ê°„ í…ìŠ¤íŠ¸ë¡œ
          if (card.suit === "hearts" || card.suit === "diamonds") {
            cardDiv.className += " text-red-600";
          }

          container.appendChild(cardDiv);
        });
      }

      // ë± ì •ë³´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
      function updateDeckInfo(deckInfo) {
        const deckInfoElement = document.getElementById("deckInfo");
        if (deckInfoElement && deckInfo) {
          deckInfoElement.textContent = `ë‚¨ì€ ì¹´ë“œ: ${deckInfo.remainingCards}ì¥ (${deckInfo.remainingDecks}ë±)`;
        }
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ë± ì •ë³´ ìš”ì²­
      document.addEventListener("DOMContentLoaded", () => {
        socket.emit("get_deck_info");
      });

      // ì¬ì • ìš”ì•½ ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜
      async function fetchFinancialSummary() {
        try {
          const res = await fetch(
            "https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/users-financial-summary",
            {
              headers: { Authorization: `Bearer ${token}` },
            }
          );
          if (!res.ok)
            throw new Error("ì¬ì • ìš”ì•½ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");

          const summaries = await res.json();
          const tableBody = document.getElementById("financialSummaryTable");
          tableBody.innerHTML = "";

          summaries.forEach((summary) => {
            const tr = document.createElement("tr");
            tr.className =
              "border-t border-gray-800 hover:bg-gray-700/50 transition-colors";

            const profitClass =
              summary.financialProfit > 0
                ? "text-green-400"
                : summary.financialProfit < 0
                ? "text-red-400"
                : "text-gray-400";

            tr.innerHTML = `
              <td class="py-3 px-4 font-medium">${summary.username}</td>
              <td class="py-3 px-4 text-right text-yellow-400 font-bold">${summary.currentBalance.toLocaleString()} ì›</td>
              <td class="py-3 px-4 text-right text-blue-400">${summary.totalDeposited.toLocaleString()} ì›</td>
              <td class="py-3 px-4 text-right text-orange-400">${summary.totalExchanged.toLocaleString()} ì›</td>
              <td class="py-3 px-4 text-right ${profitClass} font-semibold">${summary.financialProfit.toLocaleString()} ì›</td>
              <td class="py-3 px-4 text-center">
                <button 
                  class="adjust-coins bg-yellow-600 hover:bg-yellow-700 text-white px-2.5 py-1.5 rounded text-sm font-medium transition-colors"
                  data-id="${summary.userId}"
                >
                  ì”ì•¡ ì¡°ì ˆ
                </button>
              </td>
            `;
            tableBody.appendChild(tr);
          });

          // ì”ì•¡ ì¡°ì ˆ ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
          document
            .querySelectorAll("#financialSummaryTable .adjust-coins")
            .forEach((button) => {
              button.addEventListener("click", function () {
                const userId = this.getAttribute("data-id");
                adjustCoins(userId);
              });
            });
        } catch (err) {
          showToast(err.message);
        }
      }

      // ì¶©ì „ ìš”ì²­ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜
      async function fetchDepositRequests() {
        try {
          const res = await fetch(
            "https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/deposit-requests",
            {
              headers: { Authorization: `Bearer ${token}` },
            }
          );
          const requests = await res.json();
          const container = document.getElementById("depositRequestsTable");
          container.innerHTML = "";

          requests.forEach((request) => {
            const tr = document.createElement("tr");
            tr.className = "border-t border-gray-800";

            const statusClass = {
              pending: "text-yellow-400",
              approved: "text-green-400",
              rejected: "text-red-400",
            }[request.status];

            const statusText = {
              pending: "ëŒ€ê¸°ì¤‘",
              approved: "ìŠ¹ì¸ë¨",
              rejected: "ê±°ì ˆë¨",
            }[request.status];

            tr.innerHTML = `
              <td class="py-3 px-4">${new Date(
                request.createdAt
              ).toLocaleString()}</td>
              <td class="py-3 px-4">${request.username}</td>
              <td class="py-3 px-4 text-right text-yellow-400">${request.amount.toLocaleString()} ì›</td>
              <td class="py-3 px-4 text-center">
                <span class="${statusClass} font-semibold">${statusText}</span>
              </td>
              <td class="py-3 px-4 text-center">
                ${
                  request.status === "pending"
                    ? `
                  <button 
                    onclick="handleDeposit('${request._id}', 'approved')"
                    class="bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded mr-2"
                  >ìŠ¹ì¸</button>
                  <button 
                    onclick="handleDeposit('${request._id}', 'rejected')"
                    class="bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded"
                  >ê±°ì ˆ</button>
                `
                    : ""
                }
              </td>
            `;
            container.appendChild(tr);
          });
        } catch (err) {
          showToast("ì¶©ì „ ìš”ì²­ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ì¶©ì „ ìš”ì²­ ì²˜ë¦¬ í•¨ìˆ˜
      async function handleDeposit(requestId, status) {
        if (
          !confirm(
            `ì •ë§ë¡œ ì´ ì¶©ì „ ìš”ì²­ì„ ${
              status === "approved" ? "ìŠ¹ì¸" : "ê±°ì ˆ"
            }í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`
          )
        ) {
          return;
        }

        try {
          const res = await fetch(
            `https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/deposit-requests/${requestId}`,
            {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`,
              },
              body: JSON.stringify({ status }),
            }
          );

          const data = await res.json();
          showToast(data.message);

          if (res.ok) {
            fetchDepositRequests(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            fetchFinancialSummary(); // ì¬ì • ìš”ì•½ ìƒˆë¡œê³ ì¹¨
          }
        } catch (err) {
          showToast("ì„œë²„ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }
    </script>
  </body>
</html>
