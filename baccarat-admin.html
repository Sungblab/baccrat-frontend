<!DOCTYPE html>
<html lang="ko" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë°”ì¹´ë¼ ê´€ë¦¬ì íŒ¨ë„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* Tailwind CSSì˜ ë‹¤í¬ ëª¨ë“œ ì‚¬ìš© */
      :root {
        --tw-bg-opacity: 1;
        --tw-text-opacity: 1;
      }
      .toast {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #1f2937;
        color: white;
        padding: 12px 24px;
        border-radius: 8px;
        border-left: 4px solid #10b981;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        z-index: 9999;
        opacity: 0;
        transform: translateX(100px);
        transition: all 0.3s ease;
      }
      .toast.show {
        opacity: 1;
        transform: translateX(0);
      }
      .toast.error {
        border-left-color: #ef4444;
      }
      .toast.success {
        border-left-color: #10b981;
      }
      .toast.warning {
        border-left-color: #f59e0b;
      }
      .scrollable-table {
        max-height: 400px;
        overflow-y: auto;
      }

      @media (max-width: 640px) {
        .responsive-table {
          display: block;
          width: 100%;
          overflow-x: auto;
        }
      }

      /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
      .custom-scrollbar {
        scrollbar-width: thin;
        scrollbar-color: #4b5563 transparent;
      }

      .custom-scrollbar::-webkit-scrollbar {
        height: 8px;
      }

      .custom-scrollbar::-webkit-scrollbar-track {
        background: #374151;
        border-radius: 4px;
      }

      .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #6b7280;
        border-radius: 4px;
      }

      .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: #9ca3af;
      }

      /* í…Œì´ë¸” í–‰ í˜¸ë²„ íš¨ê³¼ */
      tbody tr {
        transition: background-color 0.2s;
      }

      tbody tr:hover {
        background-color: rgba(55, 65, 81, 0.5);
      }

      /* Sticky í—¤ë” ìŠ¤íƒ€ì¼ */
      thead {
        position: sticky;
        top: 0;
        z-index: 10;
      }

      /* ìµœê·¼ ê²Œì„ ê²°ê³¼ (Big Road) ìŠ¤íƒ€ì¼ ì¶”ê°€ */
      #recentResults {
        display: flex;
        flex-direction: row; /* ê°€ë¡œë¡œ ì—´ ë°°ì¹˜ */
        overflow-x: auto; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ */
        padding: 8px;
        min-height: 130px; /* ìµœì†Œ ë†’ì´ (6ê°œ ì•„ì´í…œ + íŒ¨ë”© ê³ ë ¤) */
        align-items: flex-start; /* ì—´ ìƒë‹¨ ì •ë ¬ */
        gap: 4px; /* ì—´ ê°„ ê°„ê²© */
        -webkit-overflow-scrolling: touch; /* iOS ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤ */
        background-color: rgba(0, 0, 0, 0.2); /* ë°°ê²½ìƒ‰ ì•½ê°„ ì¶”ê°€ */
        border-radius: 6px;
      }

      .result-column {
        display: flex;
        flex-direction: column;
        margin-right: 2px;
      }

      .result-cell {
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: bold;
        border-radius: 50%;
        margin-bottom: 2px;
        color: white;
        position: relative;
      }
      .result-cell.player {
        background-color: #3b82f6; /* blue-500 */
      }
      .result-cell.banker {
        background-color: #ef4444; /* red-500 */
      }
      .result-cell.tie {
        background-color: #10b981; /* green-500 */
      }
      .result-cell.player-pair::after {
        content: "";
        position: absolute;
        top: -2px;
        right: -2px;
        width: 8px;
        height: 8px;
        background-color: #fbbf24; /* yellow-400 */
        border-radius: 50%;
        border: 1px solid white;
      }
      .result-cell.banker-pair::before {
        content: "";
        position: absolute;
        top: -2px;
        left: -2px;
        width: 8px;
        height: 8px;
        background-color: #fbbf24; /* yellow-400 */
        border-radius: 50%;
        border: 1px solid white;
      }

      body {
        font-family: "Noto Serif KR", serif;
      }
    </style>
  </head>
  <body class="bg-gray-900 text-white">
    <div class="w-[100%] md:w-[80%] mx-auto p-2 md:p-6">
      <!-- í—¤ë” ë° ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
      <header
        class="flex flex-col md:flex-row justify-between items-center mb-4 md:mb-6"
      >
        <h1
          class="text-3xl font-bold text-yellow-500"
          style="text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5)"
        >
          ë°”ì¹´ë¼ ê²Œì„ ê´€ë¦¬
        </h1>
        <div class="flex gap-2">
          <button
            id="backToAdmin"
            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded w-full md:w-auto"
          >
            ê´€ë¦¬ì ë©”ì¸ìœ¼ë¡œ
          </button>
          <button
            id="logout"
            class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded w-full md:w-auto"
          >
            ë¡œê·¸ì•„ì›ƒ
          </button>
        </div>
      </header>

      <!-- ê²Œì„ ê´€ë¦¬, ë¦¬ë”ë³´ë“œ, ìµœê·¼ ê¸°ë¡ 3ê°œ ì„¹ì…˜ -->
      <div class="mb-4 md:mb-6 grid grid-cols-1 lg:grid-cols-3 gap-3 md:gap-6">
        <!-- ê²Œì„ ê´€ë¦¬ (ì™¼ìª½) -->
        <div class="bg-gray-800 p-3 md:p-4 rounded-lg shadow">
          <h3 class="text-lg font-semibold mb-4 text-purple-400">ê²Œì„ ê´€ë¦¬</h3>

          <!-- ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
          <div class="space-y-3 mb-4">
            <!-- 1. ìƒíƒœ ë° ê¸°ë³¸ ì»¨íŠ¸ë¡¤ -->
            <div class="bg-gray-700/50 p-3 rounded-lg">
              <div class="flex flex-col gap-3">
                <div class="flex items-center space-x-3">
                  <div
                    id="bettingStatus"
                    class="text-base font-semibold text-yellow-400"
                  >
                    í˜„ì¬ ìƒíƒœ: ëŒ€ê¸°ì¤‘
                  </div>
                  <div
                    id="timer"
                    class="text-xl font-bold text-blue-400 min-w-[50px]"
                  ></div>
                </div>
                <div class="flex flex-col space-y-2">
                  <button
                    id="startBetting"
                    class="bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg font-bold transition"
                  >
                    ë² íŒ… ì‹œì‘
                  </button>
                  <button
                    id="adminStartGame"
                    class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded-lg font-bold transition"
                  >
                    ê²Œì„ ì‹œì‘
                  </button>
                </div>
              </div>
            </div>

            <!-- 2. ìë™í™” ë° ë± ê´€ë¦¬ -->
            <div class="bg-gray-700/50 p-3 rounded-lg">
              <div class="flex flex-col gap-3">
                <div>
                  <h4 class="font-semibold text-gray-300">ìë™ ë² íŒ…</h4>
                  <div
                    id="autoStatus"
                    class="text-sm font-medium text-gray-400 hidden"
                  >
                    ìë™ ë² íŒ… ëŒ€ê¸° ì¤‘... <span id="autoCountdown"></span>
                  </div>
                </div>

                <!-- ì ‘ì† ìƒíƒœ -->
                <div class="bg-gray-800/50 p-2 rounded border border-green-600">
                  <div class="text-xs font-semibold text-green-400 mb-1">
                    ì ‘ì† ìƒíƒœ
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-xs text-gray-400">ë°”ì¹´ë¼:</span>
                    <span id="baccaratUsers" class="text-xs text-white font-bold">0</span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-xs text-gray-400">ë¸”ë™ì­:</span>
                    <span id="blackjackUsers" class="text-xs text-white font-bold">0</span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-xs text-gray-400">ì´ ì ‘ì†ì:</span>
                    <span id="totalUsers" class="text-xs text-white font-bold">0</span>
                  </div>
                  <!-- ìë™ ê²Œì„ ì°¸ì—¬ì ìˆ˜ ì¶”ê°€ -->
                  <div class="flex justify-between items-center mt-1 pt-1 border-t border-gray-600">
                    <span class="text-xs text-blue-400">ìë™ê²Œì„ ì°¸ì—¬:</span>
                    <span id="autoGameParticipants" class="text-xs text-blue-300 font-bold">0</span>
                  </div>
                </div>

                <!-- ì‚¬ìš©ì ì ‘ì† ê¸°ë°˜ ìë™ ê²Œì„ ìƒíƒœ -->
                <div class="bg-gray-800/50 p-2 rounded border border-blue-600">
                  <div class="text-xs font-semibold text-blue-400 mb-1">
                    ì‚¬ìš©ì ìë™ ê²Œì„
                  </div>
                  <div id="userAutoGameStatus" class="text-xs text-gray-400">
                    ëŒ€ê¸° ì¤‘ (ì ‘ì†ì ì—†ìŒ)
                  </div>
                  <!-- ì˜ˆì•½ ì¢…ë£Œ ìƒíƒœ í‘œì‹œ -->
                  <div id="scheduledStopStatus" class="text-xs text-orange-400 mt-1 hidden">
                    ê²Œì„ ì¢…ë£Œ ì˜ˆì•½ë¨
                  </div>
                  <!-- ê²Œì„ í†µê³„ í‘œì‹œ -->
                  <div id="gameStatsDisplay" class="text-xs text-gray-500 mt-1 hidden">
                    ì§„í–‰ëœ ê²Œì„: <span id="gameCount">0</span>íšŒ
                  </div>
                </div>

                <div class="flex flex-col space-y-2">
                  <button
                    id="autoStartBetting"
                    class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg font-bold transition"
                  >
                    ìë™ ì‹œì‘
                  </button>
                  <button
                    id="autoStopBetting"
                    class="bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-lg font-bold transition hidden"
                  >
                    ìë™ ì¤‘ì§€
                  </button>
                  <!-- ìˆ˜ë™ ê²Œì„ ì¤‘ì§€ ë²„íŠ¼ ì¶”ê°€ -->
                  <button
                    id="stopUserAutoGame"
                    class="bg-orange-600 hover:bg-orange-700 text-white px-3 py-2 rounded-lg font-bold transition hidden"
                  >
                    ê²Œì„ ê°•ì œ ì¤‘ì§€
                  </button>
                </div>

                  <hr class="border-gray-600 my-3" />

                  <!-- ë°±ê·¸ë¼ìš´ë“œ ê²Œì„ ì„¹ì…˜ -->
                  <div class="flex flex-col gap-3">
                    <div>
                      <h4 class="font-semibold text-gray-300">ë°±ê·¸ë¼ìš´ë“œ ê²Œì„</h4>
                      <div
                        id="backgroundStatus"
                        class="text-sm font-medium text-gray-400 hidden"
                      >
                        ë°±ê·¸ë¼ìš´ë“œ ê²Œì„ ì§„í–‰ ì¤‘...
                        <span id="backgroundProgress"></span>
                      </div>
                    </div>

                    <!-- ê²Œì„ íšŸìˆ˜ ì„ íƒ -->
                    <div>
                      <label class="block text-sm font-medium text-gray-400 mb-2"
                        >ê²Œì„ íšŸìˆ˜ ì„ íƒ</label
                      >
                      <select
                        id="backgroundGameCount"
                        class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-yellow-500 focus:ring-2 focus:ring-yellow-500"
                      >
                        <option value="50">50íšŒ</option>
                        <option value="100">100íšŒ</option>
                        <option value="200">200íšŒ</option>
                        <option value="500">500íšŒ</option>
                      </select>
                    </div>

                    <div class="flex flex-col space-y-2">
                      <button
                        id="startBackgroundGame"
                        class="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-2 rounded-lg font-bold transition"
                      >
                        ë°±ê·¸ë¼ìš´ë“œ ì‹œì‘
                      </button>
                      <button
                        id="stopBackgroundGame"
                        class="bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-lg font-bold transition hidden"
                      >
                        ë°±ê·¸ë¼ìš´ë“œ ì¤‘ì§€
                      </button>
                    </div>
                  </div>

                  <hr class="border-gray-600 my-3" />
                  <div class="flex flex-col gap-2">
                    <div id="deckInfo" class="text-sm text-gray-400">
                      ë± ì •ë³´: ë¡œë”© ì¤‘...
                    </div>
                    <button
                      id="adminShuffleDeck"
                      class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-2 rounded-lg font-bold transition"
                    >
                      ë± ì…”í”Œ
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- ì‹¤ì‹œê°„ ë² íŒ… í˜„í™© -->
          <div>
            <h4 class="text-base font-semibold mb-2 text-gray-300">
              ì‹¤ì‹œê°„ ë² íŒ… í˜„í™©
            </h4>
            <div
              class="bg-gray-900 rounded-lg overflow-x-auto border border-gray-700"
            >
              <table class="min-w-full text-sm">
                <thead class="bg-gray-700">
                  <tr>
                    <th scope="col" class="py-2 px-3 text-left font-semibold">
                      ë² íŒ… ì˜µì…˜
                    </th>
                    <th scope="col" class="py-2 px-3 text-right font-semibold">
                      ë² íŒ… ê¸ˆì•¡
                    </th>
                    <th scope="col" class="py-2 px-3 text-right font-semibold">
                      ë² íŒ… ì¸ì›
                    </th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-gray-700">
                  <!-- Player -->
                  <tr class="hover:bg-gray-800/50">
                    <td class="py-2 px-3 font-bold text-blue-400">í”Œë ˆì´ì–´</td>
                    <td
                      id="adminPlayerBetAmount"
                      class="py-2 px-3 text-right font-mono"
                    >
                      0 ì›
                    </td>
                    <td
                      id="adminPlayerBetCount"
                      class="py-2 px-3 text-right font-mono"
                    >
                      0ëª…
                    </td>
                  </tr>
                  <!-- Banker -->
                  <tr class="hover:bg-gray-800/50">
                    <td class="py-2 px-3 font-bold text-red-400">ë±…ì»¤</td>
                    <td
                      id="adminBankerBetAmount"
                      class="py-2 px-3 text-right font-mono"
                    >
                      0 ì›
                    </td>
                    <td
                      id="adminBankerBetCount"
                      class="py-2 px-3 text-right font-mono"
                    >
                      0ëª…
                    </td>
                  </tr>
                  <!-- Tie -->
                  <tr class="hover:bg-gray-800/50">
                    <td class="py-2 px-3 font-bold text-green-400">íƒ€ì´</td>
                    <td
                      id="adminTieBetAmount"
                      class="py-2 px-3 text-right font-mono"
                    >
                      0 ì›
                    </td>
                    <td
                      id="adminTieBetCount"
                      class="py-2 px-3 text-right font-mono"
                    >
                      0ëª…
                    </td>
                  </tr>
                  <!-- Player Pair -->
                  <tr class="hover:bg-gray-800/50">
                    <td class="py-2 px-3 font-bold text-sky-400">P í˜ì–´</td>
                    <td
                      id="adminPlayerPairBetAmount"
                      class="py-2 px-3 text-right font-mono"
                    >
                      0 ì›
                    </td>
                    <td
                      id="adminPlayerPairBetCount"
                      class="py-2 px-3 text-right font-mono"
                    >
                      0ëª…
                    </td>
                  </tr>
                  <!-- Banker Pair -->
                  <tr class="hover:bg-gray-800/50">
                    <td class="py-2 px-3 font-bold text-pink-400">B í˜ì–´</td>
                    <td
                      id="adminBankerPairBetAmount"
                      class="py-2 px-3 text-right font-mono"
                    >
                      0 ì›
                    </td>
                    <td
                      id="adminBankerPairBetCount"
                      class="py-2 px-3 text-right font-mono"
                    >
                      0ëª…
                    </td>
                  </tr>
                </tbody>
                <tfoot class="bg-gray-700">
                  <tr>
                    <td class="py-2 px-3 font-bold">ì´ê³„</td>
                    <td
                      id="adminTotalBetAmount"
                      class="py-2 px-3 text-right font-bold font-mono"
                    >
                      0 ì›
                    </td>
                    <td
                      id="adminTotalBetCount"
                      class="py-2 px-3 text-right font-bold font-mono"
                    >
                      0ëª…
                    </td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>
        </div>

        <!-- ë¦¬ë”ë³´ë“œ (ê°€ìš´ë°) -->
        <div class="bg-gray-800 p-3 md:p-4 rounded-lg shadow">
          <h3 class="text-lg font-semibold mb-4 text-purple-400">ë¦¬ë”ë³´ë“œ</h3>
          <div
            class="bg-gray-900 rounded-lg overflow-hidden border border-gray-700"
          >
            <div class="max-h-[500px] overflow-y-auto custom-scrollbar">
              <table class="min-w-full text-sm">
                <thead class="bg-gray-700 sticky top-0">
                  <tr>
                    <th class="py-2 px-3 text-left">ìˆœìœ„</th>
                    <th class="py-2 px-3 text-left">ì‚¬ìš©ì</th>
                    <th class="py-2 px-3 text-right">ë³´ìœ ì•¡</th>
                    <th class="py-2 px-3 text-right">ìŠ¹ë¥ </th>
                    <th class="py-2 px-3 text-right">ì´ ë² íŒ…</th>
                  </tr>
                </thead>
                <tbody id="leaderboardTable" class="divide-y divide-gray-700">
                  <!-- ë¦¬ë”ë³´ë“œ ëª©ë¡ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- ìµœê·¼ ê²Œì„ ê¸°ë¡ (ì˜¤ë¥¸ìª½) -->
        <div class="bg-gray-800 p-3 md:p-4 rounded-lg shadow">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold text-purple-400">ê²Œì„ ê¸°ë¡</h3>
            <button
              onclick="resetGameHistory()"
              class="bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-sm font-medium transition-colors"
            >
              ì´ˆê¸°í™”
            </button>
          </div>

          <!-- ê²Œì„ ê²°ê³¼ í‘œì‹œ ì„¹ì…˜ -->
          <div
            id="gameResultDisplay"
            class="mb-4 bg-gray-900 p-3 rounded-lg border border-gray-700"
          >
            <h4 class="text-base font-semibold mb-2 text-gray-300">
              ê²Œì„ ê²°ê³¼
            </h4>
            <div class="grid grid-cols-1 gap-2">
              <div>
                <h5 class="text-sm font-semibold mb-1 text-blue-400">
                  í”Œë ˆì´ì–´
                </h5>
                <div id="playerCards" class="mb-1 text-gray-500 text-sm">
                  ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤
                </div>
                <div id="playerScore" class="text-sm font-bold"></div>
              </div>
              <div>
                <h5 class="text-sm font-semibold mb-1 text-red-400">ë±…ì»¤</h5>
                <div id="bankerCards" class="mb-1 text-gray-500 text-sm">
                  ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤
                </div>
                <div id="bankerScore" class="text-sm font-bold"></div>
              </div>
            </div>
            <div class="mt-2">
              <div
                id="gameWinner"
                class="text-base font-bold text-center mb-1 text-gray-500"
              >
                ê²Œì„ ê²°ê³¼ ëŒ€ê¸° ì¤‘...
              </div>
              <div
                id="pairResults"
                class="text-center text-sm text-gray-400"
              ></div>
            </div>
          </div>

          <!-- ê²°ê³¼ íŒ¨í„´ -->
          <div class="bg-gray-900 p-3 rounded-lg mb-4 border border-gray-700">
            <div class="flex justify-between items-center mb-2">
              <h4 class="text-base font-semibold text-gray-300">íŒ¨í„´</h4>
              <!-- ê°„ë‹¨í•œ í†µê³„ (ì˜¤ë¥¸ìª½) -->
              <div class="flex items-center gap-3 text-sm">
                <span class="text-blue-400 font-semibold"
                  >P: <span id="playerWins">0</span></span
                >
                <span class="text-red-400 font-semibold"
                  >B: <span id="bankerWins">0</span></span
                >
                <span class="text-green-400 font-semibold"
                  >T: <span id="tieWins">0</span></span
                >
              </div>
            </div>
            <div class="grid grid-cols-6 gap-1" id="recentResults">
              <!-- ìµœê·¼ ê²°ê³¼ê°€ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
          </div>

          <!-- ê°„ë‹¨í•œ ê¸°ë¡ í…Œì´ë¸” -->
          <div
            class="bg-gray-900 rounded-lg overflow-hidden border border-gray-700 mb-4"
          >
            <div class="overflow-x-auto max-h-[500px] custom-scrollbar">
              <table class="min-w-full text-sm">
                <thead class="bg-gray-700 sticky top-0 z-10">
                  <tr>
                    <th class="py-2 px-3 text-left">#</th>
                    <th class="py-2 px-3 text-left">ê²°ê³¼</th>
                    <th class="py-2 px-3 text-right">ì¸ì›</th>
                  </tr>
                </thead>
                <tbody id="recentGamesTable" class="divide-y divide-gray-700">
                  <!-- ê²Œì„ ê¸°ë¡ì´ ì—¬ê¸° ì¶”ê°€ ë©ë‹ˆë‹¤ -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- ì „ì²´ ë² íŒ… ê¸°ë¡ ì„¹ì…˜ -->
      <div class="mb-4 md:mb-6 bg-gray-800 p-3 md:p-6 rounded-lg shadow">
        <h1 class="text-2xl font-semibold mb-4 text-purple-400">
          ì „ì²´ ë² íŒ… ê¸°ë¡
        </h1>
        <div
          class="bg-gray-900 rounded-lg overflow-hidden border border-gray-700"
        >
          <div class="max-h-[400px] overflow-y-auto custom-scrollbar">
            <table class="min-w-full text-sm">
              <thead class="bg-gray-700 sticky top-0">
                <tr>
                  <th class="py-3 px-4 text-left">ì‹œê°„</th>
                  <th class="py-3 px-4 text-left">ì‚¬ìš©ì</th>
                  <th class="py-3 px-4 text-center">ì„ íƒ</th>
                  <th class="py-3 px-4 text-right">ë² íŒ…ì•¡</th>
                  <th class="py-3 px-4 text-center">ê²°ê³¼</th>
                  <th class="py-3 px-4 text-center">
                    <button
                      id="showFixPanelBtn"
                      class="hover:text-gray-300 text-sm px-2 py-1"
                      onclick="toggleFixPanel()"
                      title="ê³ ê¸‰ ì˜µì…˜"
                    >
                      ê´€ë¦¬
                    </button>
                  </th>
                </tr>
              </thead>
              <tbody
                id="allBettingHistoryTable"
                class="divide-y divide-gray-700"
              >
                <!-- ë² íŒ… ê¸°ë¡ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ìŠ¹ë¶€ ì¡°ì‘ íŒ¨ë„ ëª¨ë‹¬ -->
      <div
        id="fixPanelModal"
        class="fixed inset-0 bg-black bg-opacity-80 z-50 hidden backdrop-blur-sm"
        onclick="closeFixPanelOnOutsideClick(event)"
      >
        <div
          class="fixed bottom-0 left-0 right-0 bg-gradient-to-t from-gray-900 to-gray-800 rounded-t-2xl border-t border-gray-600 p-6"
          onclick="event.stopPropagation()"
        >
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-bold text-white">ê³ ê¸‰ ê²Œì„ ì„¤ì •</h3>
            <button
              id="closeFixPanel"
              class="text-gray-400 hover:text-white"
              onclick="toggleFixPanel()"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-6 w-6"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M6 18L18 6M6 6l12 12"
                />
              </svg>
            </button>
          </div>

          <div class="space-y-4">
            <!-- íŒ¨í„´ ì„ íƒ -->
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">
                ê²Œì„ íŒ¨í„´ ì„ íƒ
              </label>
              <select
                id="patternSelect"
                class="w-full bg-gray-700 text-white px-3 py-2 rounded border border-gray-600 focus:border-blue-500 focus:outline-none"
              >
                <option value="1">íŒ¨í„´ 1 - ë‚´ì¶”ëŸ´ ìŠ¹ë¶€ (9 vs 8)</option>
                <option value="2">íŒ¨í„´ 2 - ì—­ì „ìŠ¹/ë±…ì»¤ë£° ìŠ¹ë¶€</option>
                <option value="3">íŒ¨í„´ 3 - ê°„ë°œì˜ ì°¨ì´/ì••ë„ì  ìŠ¹ë¶€</option>
              </select>
            </div>

            <!-- ê²°ê³¼ ì„ íƒ ë²„íŠ¼ë“¤ -->
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">
                ê²Œì„ ê²°ê³¼ ì„¤ì •
              </label>
              <div class="grid grid-cols-3 gap-3">
                <button
                  id="fixPlayerBtn"
                  class="bg-gray-700 hover:bg-blue-600 text-white py-3 px-4 rounded-lg transition-colors font-medium"
                  onclick="fixGameResult('player')"
                >
                  <div class="text-lg">ğŸ”µ</div>
                  <div class="text-sm">í”Œë ˆì´ì–´</div>
                </button>
                <button
                  id="fixBankerBtn"
                  class="bg-gray-700 hover:bg-red-600 text-white py-3 px-4 rounded-lg transition-colors font-medium"
                  onclick="fixGameResult('banker')"
                >
                  <div class="text-lg">ğŸ”´</div>
                  <div class="text-sm">ë±…ì»¤</div>
                </button>
                <button
                  id="fixTieBtn"
                  class="bg-gray-700 hover:bg-green-600 text-white py-3 px-4 rounded-lg transition-colors font-medium"
                  onclick="fixGameResult('tie')"
                >
                  <div class="text-lg">ğŸŸ¢</div>
                  <div class="text-sm">íƒ€ì´</div>
                </button>
              </div>
            </div>

            <!-- í˜„ì¬ ìƒíƒœ í‘œì‹œ -->
            <div
              id="fixStatusDisplay"
              class="text-center text-sm text-gray-400 hidden"
            >
              <div class="bg-gray-800 rounded-lg p-3">
                <span id="fixStatusText">ì„¤ì •ëœ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</span>
              </div>
            </div>

            <!-- ì£¼ì˜ì‚¬í•­ -->
            <div
              class="text-xs text-gray-500 text-center bg-gray-800 rounded-lg p-3"
            >
              âš ï¸ ì´ ê¸°ëŠ¥ì€ ë² íŒ…ì´ í™œì„±í™”ëœ ìƒíƒœì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- í† ìŠ¤íŠ¸ ì•Œë¦¼ -->
    <div id="toast" class="toast"></div>

    <!-- JavaScript ì½”ë“œëŠ” ì›ë³¸ admin.htmlì—ì„œ ë³µì‚¬í•´ì•¼ í•¨ -->
    <script>
      // í† í° í™•ì¸ ë° ì¸ì¦
      const token = localStorage.getItem("token");
      if (!token) {
        window.location.href = "index.html";
      }

      // ì†Œì¼“ ì—°ê²°
      const socket = io(
        "https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app"
      );

      // ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ê¸°ëŠ¥
      document
        .getElementById("backToAdmin")
        .addEventListener("click", function () {
          window.location.href = "admin.html";
        });

      // ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥
      document.getElementById("logout").addEventListener("click", function () {
        if (confirm("ì •ë§ ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
          localStorage.removeItem("token");
          showToast("ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.", "info");
          setTimeout(() => {
            window.location.href = "index.html";
          }, 1000);
        }
      });

      // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
      function showToast(message, type = "info") {
        const toast = document.getElementById("toast");
        toast.textContent = message;
        toast.className = `toast show toast-${type}`;
        setTimeout(() => {
          toast.className = "toast";
        }, 3000);
      }

      // ì¸ì¦ ì˜¤ë¥˜ ì²˜ë¦¬
      function handleAuthError() {
        showToast("ì¸ì¦ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.", "error");
        setTimeout(() => {
          localStorage.removeItem("token");
          window.location.href = "index.html";
        }, 2000);
      }

      // ë² íŒ… ì‹œì‘ ë²„íŠ¼
      document.getElementById("startBetting").addEventListener("click", () => {
        socket.emit("start_betting");
        showToast("ë² íŒ…ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.", "info");
      });

      // ê²Œì„ ì‹œì‘ ë²„íŠ¼
      document
        .getElementById("adminStartGame")
        .addEventListener("click", () => {
          socket.emit("admin_start_game");
          showToast("ê²Œì„ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.", "info");
        });

      // ì‚¬ìš©ì ìë™ ê²Œì„ ì‹œì‘
      document.getElementById('autoStartBetting').addEventListener('click', function() {
        socket.emit('start_auto_betting');
        document.getElementById('autoStartBetting').style.display = 'none';
        document.getElementById('autoStopBetting').style.display = 'block';
        document.getElementById('stopUserAutoGame').classList.remove('hidden');
        showToast('ì‚¬ìš©ì ìë™ ê²Œì„ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
      });

      // ì‚¬ìš©ì ìë™ ê²Œì„ ì¤‘ì§€ (ì˜ˆì•½ ì¢…ë£Œ)
      document.getElementById('autoStopBetting').addEventListener('click', function() {
        socket.emit('stop_auto_betting');
        document.getElementById('autoStopBetting').classList.add('hidden');
        showToast('ìë™ ê²Œì„ ì˜ˆì•½ ì¢…ë£Œê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤. í˜„ì¬ ê²Œì„ ì™„ë£Œ í›„ ì¢…ë£Œë©ë‹ˆë‹¤.', 'info');
      });

      // ì‚¬ìš©ì ìë™ ê²Œì„ ê°•ì œ ì¤‘ì§€
      document.getElementById('stopUserAutoGame').addEventListener('click', function() {
        if (confirm('ì •ë§ë¡œ ì§„í–‰ ì¤‘ì¸ ê²Œì„ì„ ê°•ì œë¡œ ì¤‘ì§€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          socket.emit('stop_auto_game');
        }
      });

      // ë°±ê·¸ë¼ìš´ë“œ ê²Œì„ ì‹œì‘/ì¤‘ì§€ ë²„íŠ¼
      document
        .getElementById("startBackgroundGame")
        .addEventListener("click", () => {
          const gameCount = document.getElementById(
            "backgroundGameCount"
          ).value;
          socket.emit("start_background_game", {
            maxGames: parseInt(gameCount),
          });
          showToast(
            `ë°±ê·¸ë¼ìš´ë“œ ê²Œì„ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. (${gameCount}íšŒ)`,
            "info"
          );
        });

      document
        .getElementById("stopBackgroundGame")
        .addEventListener("click", () => {
          socket.emit("stop_background_game");
          showToast("ë°±ê·¸ë¼ìš´ë“œ ê²Œì„ì´ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.", "info");
        });

      // ë± ì…”í”Œ ë²„íŠ¼
      document
        .getElementById("adminShuffleDeck")
        .addEventListener("click", () => {
          socket.emit("admin_shuffle_deck");
          showToast("ë±ì´ ì…”í”Œë˜ì—ˆìŠµë‹ˆë‹¤.", "info");
        });

      // ì†Œì¼“ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      socket.on("connect", () => {
        socket.emit("authenticate", token);
        socket.emit("request_betting_status");
      });

      // ë² íŒ… ìƒíƒœ ì—…ë°ì´íŠ¸
      socket.on("betting_status", (status) => {
        if (status.active) {
          document.getElementById("bettingStatus").textContent =
            "í˜„ì¬ ìƒíƒœ: ë² íŒ… ì§„í–‰ì¤‘";
        } else {
          document.getElementById("bettingStatus").textContent =
            "í˜„ì¬ ìƒíƒœ: ëŒ€ê¸°ì¤‘";
        }

        if (status.stats) {
          document.getElementById(
            "adminPlayerBetAmount"
          ).textContent = `${status.stats.player.total_bet_amount.toLocaleString()} ì›`;
          document.getElementById(
            "adminPlayerBetCount"
          ).textContent = `${status.stats.player.bettor_count}ëª…`;
          document.getElementById(
            "adminBankerBetAmount"
          ).textContent = `${status.stats.banker.total_bet_amount.toLocaleString()} ì›`;
          document.getElementById(
            "adminBankerBetCount"
          ).textContent = `${status.stats.banker.bettor_count}ëª…`;
          document.getElementById(
            "adminTieBetAmount"
          ).textContent = `${status.stats.tie.total_bet_amount.toLocaleString()} ì›`;
          document.getElementById(
            "adminTieBetCount"
          ).textContent = `${status.stats.tie.bettor_count}ëª…`;
          document.getElementById(
            "adminPlayerPairBetAmount"
          ).textContent = `${status.stats.player_pair.total_bet_amount.toLocaleString()} ì›`;
          document.getElementById(
            "adminPlayerPairBetCount"
          ).textContent = `${status.stats.player_pair.bettor_count}ëª…`;
          document.getElementById(
            "adminBankerPairBetAmount"
          ).textContent = `${status.stats.banker_pair.total_bet_amount.toLocaleString()} ì›`;
          document.getElementById(
            "adminBankerPairBetCount"
          ).textContent = `${status.stats.banker_pair.bettor_count}ëª…`;

          const totalAmount = Object.values(status.stats).reduce(
            (sum, stat) => sum + stat.total_bet_amount,
            0
          );
          const totalCount = Object.values(status.stats).reduce(
            (sum, stat) => sum + stat.bettor_count,
            0
          );
          document.getElementById(
            "adminTotalBetAmount"
          ).textContent = `${totalAmount.toLocaleString()} ì›`;
          document.getElementById(
            "adminTotalBetCount"
          ).textContent = `${totalCount}ëª…`;
        }
      });

      socket.on("betting_started", () => {
        document.getElementById("bettingStatus").textContent =
          "í˜„ì¬ ìƒíƒœ: ë² íŒ… ì§„í–‰ì¤‘";
        showToast("ë² íŒ…ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!", "success");
      });

      socket.on("betting_closed", () => {
        document.getElementById("bettingStatus").textContent =
          "í˜„ì¬ ìƒíƒœ: ë² íŒ… ì¢…ë£Œ";
        showToast("ë² íŒ…ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.", "info");
      });

      // ë² íŒ… ì¢…ë£Œ ì‹œê°„ íƒ€ì´ë¨¸
      socket.on("betting_end_time", (endTime) => {
        const timerElement = document.getElementById("timer");
        const updateTimer = () => {
          const now = new Date().getTime();
          const end = new Date(endTime).getTime();
          const timeLeft = Math.max(0, Math.floor((end - now) / 1000));

          if (timeLeft > 0) {
            timerElement.textContent = `${timeLeft}ì´ˆ`;
            setTimeout(updateTimer, 1000);
          } else {
            timerElement.textContent = "";
          }
        };
        updateTimer();
      });

      socket.on("game_result", (result) => {
        const winner =
          result.result === "player"
            ? "í”Œë ˆì´ì–´"
            : result.result === "banker"
            ? "ë±…ì»¤"
            : "íƒ€ì´";
        document.getElementById("gameWinner").textContent = `${winner} ìŠ¹ë¦¬!`;
        document.getElementById(
          "playerScore"
        ).textContent = `ì ìˆ˜: ${result.playerScore}`;
        document.getElementById(
          "bankerScore"
        ).textContent = `ì ìˆ˜: ${result.bankerScore}`;

        let pairText = "";
        if (result.playerPairOccurred) pairText += "í”Œë ˆì´ì–´ í˜ì–´ ";
        if (result.bankerPairOccurred) pairText += "ë±…ì»¤ í˜ì–´";
        document.getElementById("pairResults").textContent =
          pairText || "í˜ì–´ ì—†ìŒ";

        showToast(`ê²Œì„ ê²°ê³¼: ${winner} ìŠ¹ë¦¬!`, "success");
      });

      socket.on("deck_info", (deckInfo) => {
        document.getElementById(
          "deckInfo"
        ).textContent = `ë± ì •ë³´: ${deckInfo.remaining}ì¥ ë‚¨ìŒ`;
      });

      // ì‹¤ì‹œê°„ ë² íŒ… í˜„í™© ì—…ë°ì´íŠ¸
      socket.on("new_bet", (data) => {
        if (data.stats) {
          // ë² íŒ… í˜„í™© ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
          document.getElementById(
            "adminPlayerBetAmount"
          ).textContent = `${data.stats.player.total_bet_amount.toLocaleString()} ì›`;
          document.getElementById(
            "adminPlayerBetCount"
          ).textContent = `${data.stats.player.bettor_count}ëª…`;
          document.getElementById(
            "adminBankerBetAmount"
          ).textContent = `${data.stats.banker.total_bet_amount.toLocaleString()} ì›`;
          document.getElementById(
            "adminBankerBetCount"
          ).textContent = `${data.stats.banker.bettor_count}ëª…`;
          document.getElementById(
            "adminTieBetAmount"
          ).textContent = `${data.stats.tie.total_bet_amount.toLocaleString()} ì›`;
          document.getElementById(
            "adminTieBetCount"
          ).textContent = `${data.stats.tie.bettor_count}ëª…`;
          document.getElementById(
            "adminPlayerPairBetAmount"
          ).textContent = `${data.stats.player_pair.total_bet_amount.toLocaleString()} ì›`;
          document.getElementById(
            "adminPlayerPairBetCount"
          ).textContent = `${data.stats.player_pair.bettor_count}ëª…`;
          document.getElementById(
            "adminBankerPairBetAmount"
          ).textContent = `${data.stats.banker_pair.total_bet_amount.toLocaleString()} ì›`;
          document.getElementById(
            "adminBankerPairBetCount"
          ).textContent = `${data.stats.banker_pair.bettor_count}ëª…`;

          // ì´ê³„ ê³„ì‚° ë° ì—…ë°ì´íŠ¸
          const totalAmount = Object.values(data.stats).reduce(
            (sum, stat) => sum + stat.total_bet_amount,
            0
          );
          const totalCount = Object.values(data.stats).reduce(
            (sum, stat) => sum + stat.bettor_count,
            0
          );
          document.getElementById(
            "adminTotalBetAmount"
          ).textContent = `${totalAmount.toLocaleString()} ì›`;
          document.getElementById(
            "adminTotalBetCount"
          ).textContent = `${totalCount}ëª…`;
        }
      });

      // ì‚¬ìš©ì ì ‘ì† ê¸°ë°˜ ìë™ ê²Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸
      socket.on("user_auto_game_status_update", (status) => {
        const userAutoGameStatus =
          document.getElementById("userAutoGameStatus");
        if (userAutoGameStatus) {
          if (status.isActive) {
            userAutoGameStatus.textContent = `í™œì„±í™” (ì ‘ì†ì ${status.connectedUsers}ëª…)`;
            userAutoGameStatus.className = "text-xs text-green-400";
          } else {
            userAutoGameStatus.textContent = `ëŒ€ê¸° ì¤‘ (ì ‘ì†ì ${status.connectedUsers}ëª…)`;
            userAutoGameStatus.className = "text-xs text-gray-400";
          }
        }
      });

      // ë¦¬ë”ë³´ë“œ ë¡œë“œ
      async function fetchLeaderboard() {
        try {
          const res = await fetch(
            "https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/leaderboard",
            {
              headers: { Authorization: `Bearer ${token}` },
            }
          );

          if (res.status === 403 || res.status === 401) {
            handleAuthError();
            return;
          }

          const leaderboard = await res.json();
          const tbody = document.getElementById("leaderboardTable");
          tbody.innerHTML = "";

          leaderboard.forEach((user, index) => {
            const tr = document.createElement("tr");
            tr.className = "hover:bg-gray-800/50 transition-colors";

            const winRate = parseFloat(user.winRate) || 0;
            const rankClass =
              index < 3 ? "text-yellow-400 font-bold" : "text-gray-400";

            tr.innerHTML = `
              <td class="py-2 px-3 ${rankClass}">${index + 1}</td>
              <td class="py-2 px-3 font-medium">${user.username}</td>
              <td class="py-2 px-3 text-right font-mono">${user.balance.toLocaleString()}ì›</td>
              <td class="py-2 px-3 text-right font-mono">${winRate.toFixed(
                1
              )}%</td>
              <td class="py-2 px-3 text-right font-mono">${(
                user.totalBets || 0
              ).toLocaleString()}ì›</td>
            `;
            tbody.appendChild(tr);
          });
        } catch (err) {
          console.error("ë¦¬ë”ë³´ë“œ ë¡œë“œ ì˜¤ë¥˜:", err);
        }
      }

      // ê²Œì„ ê¸°ë¡ ì´ˆê¸°í™”
      function resetGameHistory() {
        if (confirm("ì •ë§ë¡œ ê²Œì„ ê¸°ë¡ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
          document.getElementById("recentResults").innerHTML = "";
          document.getElementById("recentGamesTable").innerHTML = "";
          document.getElementById("playerWins").textContent = "0";
          document.getElementById("bankerWins").textContent = "0";
          document.getElementById("tieWins").textContent = "0";
          showToast("ê²Œì„ ê¸°ë¡ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.", "info");
        }
      }

      // ì „ì²´ ë² íŒ… ê¸°ë¡ ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜
      async function fetchAllBettingHistory() {
        try {
          const res = await fetch(
            "https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/all-betting-history",
            {
              headers: { Authorization: `Bearer ${token}` },
            }
          );

          if (!res.ok) {
            throw new Error("ë² íŒ… ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          }

          const allBets = await res.json();
          const container = document.getElementById("allBettingHistoryTable");
          container.innerHTML = "";

          if (allBets.length === 0) {
            container.innerHTML = `
              <tr>
                <td colspan="6" class="py-4 text-center text-gray-400">
                  ë² íŒ… ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.
                </td>
              </tr>
            `;
            return;
          }

          allBets.forEach((bet) => {
            const tr = document.createElement("tr");
            tr.className = "border-t border-gray-800";

            const resultClass =
              bet.result === "win"
                ? "text-green-400"
                : bet.result === "lose"
                ? "text-red-400"
                : "text-yellow-400";

            const resultText =
              bet.result === "win"
                ? "ìŠ¹ë¦¬"
                : bet.result === "lose"
                ? "íŒ¨ë°°"
                : "í™˜ê¸‰";

            const choiceKorean = {
              player: "í”Œë ˆì´ì–´",
              banker: "ë±…ì»¤",
              tie: "íƒ€ì´",
              player_pair: "í”Œë ˆì´ì–´í˜ì–´",
              banker_pair: "ë±…ì»¤í˜ì–´",
            };

            const profitClass =
              bet.profit >= 0 ? "text-green-400" : "text-red-400";
            const profitPrefix = bet.profit >= 0 ? "+" : "";

            tr.innerHTML = `
              <td class="py-3 px-4 text-sm text-gray-400">
                ${new Date(bet.date).toLocaleString()}
              </td>
              <td class="py-3 px-4">${bet.username}</td>
              <td class="py-3 px-4 text-center">
                ${choiceKorean[bet.choice] || bet.choice} â†’ ${
              choiceKorean[bet.gameResult] || bet.gameResult
            }
              </td>
              <td class="py-3 px-4 text-right">
                <span class="text-yellow-400">${bet.amount} ì›</span>
                <span class="${profitClass} ml-2">(${profitPrefix}${
              bet.profit
            } ì›)</span>
              </td>
              <td class="py-3 px-4 text-center">
                <span class="${resultClass} font-semibold">${resultText}</span>
              </td>
              <td class="py-3 px-4 text-center">
                <!-- Empty cell for alignment -->
              </td>
            `;
            container.appendChild(tr);
          });
        } catch (err) {
          showToast("ë² íŒ… ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", "error");
        }
      }

      // ìŠ¹ë¶€ ì¡°ì‘ íŒ¨ë„ í† ê¸€ í•¨ìˆ˜
      function toggleFixPanel() {
        const modal = document.getElementById("fixPanelModal");
        if (modal.classList.contains("hidden")) {
          modal.classList.remove("hidden");
        } else {
          modal.classList.add("hidden");
        }
      }

      // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
      function closeFixPanelOnOutsideClick(event) {
        if (event.target.id === "fixPanelModal") {
          toggleFixPanel();
        }
      }

      // ìŠ¹ë¶€ ì¡°ì‘ í•¨ìˆ˜
      function fixGameResult(result) {
        if (!socket) {
          showToast("ì†Œì¼“ ì—°ê²°ì´ ì—†ìŠµë‹ˆë‹¤.", "error");
          return;
        }

        // ë² íŒ…ì´ ì§„í–‰ ì¤‘ì¼ ë•Œë§Œ ì¡°ì‘ ê°€ëŠ¥
        if (!bettingActive) {
          showToast("ë² íŒ… ì‹œê°„ì´ ì•„ë‹™ë‹ˆë‹¤.", "error");
          return;
        }

        // ì„ íƒëœ íŒ¨í„´ ê°€ì ¸ì˜¤ê¸°
        const patternSelect = document.getElementById("patternSelect");
        const selectedPattern = parseInt(patternSelect.value);

        const resultText =
          result === "player"
            ? "í”Œë ˆì´ì–´"
            : result === "banker"
            ? "ë±…ì»¤"
            : "íƒ€ì´";

        // íŒ¨í„´ ì„¤ëª…
        const patternDescriptions = {
          player: {
            1: "ë‚´ì¶”ëŸ´ 9 vs 8",
            2: "ì„¸ ë²ˆì§¸ ì¹´ë“œë¡œ ì—­ì „ìŠ¹",
            3: "ê°„ë°œì˜ ì°¨ì´ë¡œ ìŠ¹ë¦¬",
          },
          banker: {
            1: "ë‚´ì¶”ëŸ´ 9 vs 8",
            2: "ë±…ì»¤ ë£°ì— ì˜í•œ ìŠ¹ë¦¬",
            3: "ì••ë„ì  ìŠ¹ë¦¬",
          },
          tie: {
            1: "ë‚´ì¶”ëŸ´ 8 íƒ€ì´",
            2: "ì„¸ ë²ˆì§¸ ì¹´ë“œ í›„ íƒ€ì´",
            3: "ë‚®ì€ ì ìˆ˜ íƒ€ì´",
          },
        };

        const patternDesc =
          patternDescriptions[result][selectedPattern] || "ê¸°ë³¸ íŒ¨í„´";

        if (
          confirm(
            `ë‹¤ìŒ ê²Œì„ ê²°ê³¼ë¥¼ ${resultText} ìŠ¹ë¦¬ë¡œ ì¡°ì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\níŒ¨í„´: ${patternDesc}`
          )
        ) {
          socket.emit("admin_fix_result", { result, pattern: selectedPattern });

          // ë²„íŠ¼ ì‹œê°ì  í”¼ë“œë°±
          const buttons = ["fixPlayerBtn", "fixBankerBtn", "fixTieBtn"];
          buttons.forEach((btnId) => {
            const btn = document.getElementById(btnId);
            btn.classList.remove("bg-blue-600", "bg-red-600", "bg-green-600");
            btn.classList.add("bg-gray-700");
          });

          const activeBtn = document.getElementById(
            `fix${result.charAt(0).toUpperCase() + result.slice(1)}Btn`
          );
          if (activeBtn) {
            activeBtn.classList.remove("bg-gray-700");
            if (result === "player") {
              activeBtn.classList.add("bg-blue-600");
            } else if (result === "banker") {
              activeBtn.classList.add("bg-red-600");
            } else if (result === "tie") {
              activeBtn.classList.add("bg-green-600");
            }
          }

          // ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
          const statusDisplay = document.getElementById("fixStatusDisplay");
          const statusText = document.getElementById("fixStatusText");
          statusDisplay.classList.remove("hidden");
          statusText.textContent = `ì„¤ì •ë¨: ${resultText} ìŠ¹ë¦¬ (${patternDesc})`;
          statusDisplay.classList.remove("text-gray-400");
          statusDisplay.classList.add("text-green-400");

          // ëª¨ë‹¬ ë‹«ê¸°
          setTimeout(() => {
            toggleFixPanel();
          }, 1500);
        }
      }

      // ìŠ¹ë¶€ ì¡°ì‘ íŒ¨ë„ ì´ˆê¸°í™” í•¨ìˆ˜
      function resetFixPanel() {
        const buttons = ["fixPlayerBtn", "fixBankerBtn", "fixTieBtn"];
        buttons.forEach((btnId) => {
          const btn = document.getElementById(btnId);
          if (btn) {
            btn.classList.remove("bg-blue-600", "bg-red-600", "bg-green-600");
            btn.classList.add("bg-gray-700");
          }
        });

        // ìƒíƒœ í‘œì‹œ ì´ˆê¸°í™”
        const statusDisplay = document.getElementById("fixStatusDisplay");
        const statusText = document.getElementById("fixStatusText");
        if (statusDisplay && statusText) {
          statusDisplay.classList.add("hidden");
          statusText.textContent = "ì„¤ì •ëœ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤";
          statusDisplay.classList.remove("text-green-400");
          statusDisplay.classList.add("text-gray-400");
        }
      }

      // ë² íŒ… ìƒíƒœ ì „ì—­ ë³€ìˆ˜
      let bettingActive = false;

      // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
      fetchLeaderboard();
      fetchAllBettingHistory();
      socket.emit("get_deck_info");

      // ìŠ¹ë¶€ ì¡°ì‘ ê´€ë ¨ ì†Œì¼“ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      socket.on("result_fixed", (data) => {
        showToast(data.message, "success");
      });

      // ê²Œì„ ì‹œì‘ ì‹œ ì¡°ì‘ ë²„íŠ¼ ì´ˆê¸°í™”
      socket.on("betting_started", () => {
        bettingActive = true; // ë² íŒ… í™œì„±í™”
        resetFixPanel();
      });

      // ë² íŒ… ì¢…ë£Œ ì‹œ ìƒíƒœ ì—…ë°ì´íŠ¸
      socket.on("betting_closed", () => {
        bettingActive = false; // ë² íŒ… ë¹„í™œì„±í™”
        resetFixPanel();
      });

      // ìµœê·¼ ê²Œì„ ê¸°ë¡ í‘œì‹œ í•¨ìˆ˜
      async function fetchRecentGames() {
        try {
          const res = await fetch(
            "https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/recent-games",
            {
              headers: { Authorization: `Bearer ${token}` },
            }
          );

          if (res.status === 403 || res.status === 401) {
            handleAuthError();
            return;
          }

          const recentGames = await res.json();

          // í†µê³„ ê³„ì‚°
          const stats = {
            player: 0,
            banker: 0,
            tie: 0,
            total: recentGames.length,
          };

          recentGames.forEach((game) => {
            stats[game.result]++;
          });

          // í†µê³„ ì—…ë°ì´íŠ¸
          const playerWinsEl = document.getElementById("playerWins");
          const bankerWinsEl = document.getElementById("bankerWins");
          const tieWinsEl = document.getElementById("tieWins");

          if (playerWinsEl) playerWinsEl.textContent = stats.player;
          if (bankerWinsEl) bankerWinsEl.textContent = stats.banker;
          if (tieWinsEl) tieWinsEl.textContent = stats.tie;

          // ê²°ê³¼ íŒ¨í„´ í‘œì‹œ
          const recentResultsContainer =
            document.getElementById("recentResults");
          if (recentResultsContainer) {
            recentResultsContainer.innerHTML = "";

            if (recentGames.length === 0) {
              recentResultsContainer.innerHTML = `<div class="text-center text-gray-500 py-4">ìµœê·¼ ê²Œì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
            } else {
              let currentColumn = null;
              let lastResultType = null;
              const gamesToDisplay = recentGames.slice(-72).reverse();

              gamesToDisplay.forEach((game) => {
                const resultType = game.result;
                let cellText = resultType.charAt(0).toUpperCase();

                if (
                  resultType !== lastResultType ||
                  !currentColumn ||
                  currentColumn.children.length >= 6
                ) {
                  currentColumn = document.createElement("div");
                  currentColumn.className = "result-column";
                  recentResultsContainer.appendChild(currentColumn);
                  lastResultType = resultType;
                }

                const resultElement = document.createElement("div");
                resultElement.className = `result-cell ${resultType}`;
                if (game.playerPairOccurred) {
                  resultElement.classList.add("player-pair");
                }
                if (game.bankerPairOccurred) {
                  resultElement.classList.add("banker-pair");
                }
                resultElement.textContent = cellText;
                currentColumn.appendChild(resultElement);
              });
              recentResultsContainer.scrollLeft =
                recentResultsContainer.scrollWidth;
            }
          }

          // ìƒì„¸ ê¸°ë¡ í…Œì´ë¸” ì—…ë°ì´íŠ¸
          const recentGamesTable = document.getElementById("recentGamesTable");
          if (recentGamesTable) {
            recentGamesTable.innerHTML = "";

            recentGames.forEach((game, index) => {
              const tr = document.createElement("tr");
              tr.className = "hover:bg-gray-800/50 transition-colors";

              const resultText =
                game.result === "player"
                  ? "P"
                  : game.result === "banker"
                  ? "B"
                  : "T";

              const resultClass =
                game.result === "player"
                  ? "text-blue-400"
                  : game.result === "banker"
                  ? "text-red-400"
                  : "text-green-400";

              tr.innerHTML = `
                <td class="py-1.5 px-2 text-xs">${
                  recentGames.length - index
                }</td>
                <td class="py-1.5 px-2">
                  <span class="font-bold ${resultClass}">${resultText}</span>
                </td>
                <td class="py-1.5 px-2 text-right text-xs">${
                  game.playerCount
                }</td>
              `;
              recentGamesTable.appendChild(tr);
            });
          }
        } catch (err) {
          showToast("ìµœê·¼ ê²Œì„ ê¸°ë¡ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ê²Œì„ ê¸°ë¡ ì´ˆê¸°í™” í•¨ìˆ˜
      async function resetGameHistory() {
        if (
          !confirm(
            "ì •ë§ë¡œ ëª¨ë“  ê²Œì„ ê¸°ë¡ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
          )
        ) {
          return;
        }

        try {
          const res = await fetch(
            "https://port-0-baccrat-backend-m5l6sc488b056240.sel4.cloudtype.app/api/admin/reset-game-history",
            {
              method: "DELETE",
              headers: {
                Authorization: `Bearer ${token}`,
              },
            }
          );

          if (res.ok) {
            showToast("ê²Œì„ ê¸°ë¡ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
            fetchRecentGames();
          } else {
            showToast("ê²Œì„ ê¸°ë¡ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          }
        } catch (err) {
          showToast("ì„œë²„ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ì¹´ë“œ í‘œì‹œ í•¨ìˆ˜ (ì „ì²´ í•¸ë“œ)
      function displayCards(containerId, handData) {
        const container = document.getElementById(containerId);
        if (!container) return;

        container.innerHTML = "";

        if (!handData || !handData.cards) {
          container.innerHTML =
            '<div class="text-gray-400 text-sm">ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤</div>';
          return;
        }

        handData.cards.forEach((card, index) => {
          const cardDiv = document.createElement("div");
          cardDiv.className =
            "inline-block mr-2 mb-1 px-2 py-1 bg-white text-black rounded text-sm font-bold";

          // ì¹´ë“œ ê°’ ë³€í™˜ (0ì„ 10ìœ¼ë¡œ í‘œì‹œ)
          let displayValue = card.value;
          if (card.value === "0") displayValue = "10";

          // ìŠˆíŠ¸ ì´ëª¨ì§€ (ì„œë²„ì˜ H, D, C, S í˜•ì‹ì— ë§ì¶¤)
          const suitEmoji = {
            H: "â™¥ï¸", // Hearts
            D: "â™¦ï¸", // Diamonds
            C: "â™£ï¸", // Clubs
            S: "â™ ï¸", // Spades
          };

          cardDiv.textContent = `${displayValue}${suitEmoji[card.suit] || ""}`;

          // ë¹¨ê°„ìƒ‰ ì¹´ë“œëŠ” ë¹¨ê°„ í…ìŠ¤íŠ¸ë¡œ
          if (card.suit === "H" || card.suit === "D") {
            cardDiv.className += " text-red-600";
          }

          container.appendChild(cardDiv);
        });
      }

      // ê°œë³„ ì¹´ë“œ í‘œì‹œ í•¨ìˆ˜ (ì‹¤ì‹œê°„ìš©)
      function displaySingleCard(target, cardValue, cardSuit, cardIndex) {
        const containerId = target === "player" ? "playerCards" : "bankerCards";
        const container = document.getElementById(containerId);

        if (!container) return;

        const cardDiv = document.createElement("div");
        cardDiv.className =
          "inline-block mr-2 mb-1 px-2 py-1 bg-white text-black rounded text-sm font-bold";

        // ì¹´ë“œ ê°’ ë³€í™˜
        let displayValue = cardValue;
        if (cardValue === "0") displayValue = "10";

        // ìŠˆíŠ¸ ì´ëª¨ì§€
        const suitEmoji = {
          H: "â™¥ï¸", // Hearts
          D: "â™¦ï¸", // Diamonds
          C: "â™£ï¸", // Clubs
          S: "â™ ï¸", // Spades
        };

        cardDiv.textContent = `${displayValue}${suitEmoji[cardSuit] || ""}`;

        // ë¹¨ê°„ìƒ‰ ì¹´ë“œëŠ” ë¹¨ê°„ í…ìŠ¤íŠ¸ë¡œ
        if (cardSuit === "H" || cardSuit === "D") {
          cardDiv.className += " text-red-600";
        }

        // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ ì¶”ê°€
        cardDiv.style.opacity = "0";
        cardDiv.style.transform = "scale(0.8)";

        container.appendChild(cardDiv);

        // ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰
        setTimeout(() => {
          cardDiv.style.transition = "all 0.3s ease-out";
          cardDiv.style.opacity = "1";
          cardDiv.style.transform = "scale(1)";
        }, 50);
      }

      // ë± ì •ë³´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
      function updateDeckInfo(deckInfo) {
        const deckInfoElement = document.getElementById("deckInfo");
        if (deckInfoElement && deckInfo) {
          deckInfoElement.textContent = `ë± ì •ë³´: ${deckInfo.remainingCards}ì¥ ë‚¨ìŒ`;
        }
      }

      // ì¹´ë“œ í‘œì‹œ í´ë¦¬ì–´
      socket.on("clear_cards_display_on_user_html", () => {
        const playerCards = document.getElementById("playerCards");
        const bankerCards = document.getElementById("bankerCards");

        if (playerCards)
          playerCards.innerHTML =
            '<div class="text-gray-400 text-sm">ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤</div>';
        if (bankerCards)
          bankerCards.innerHTML =
            '<div class="text-gray-400 text-sm">ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤</div>';

        const gameResult = document.getElementById("gameResult");
        if (gameResult) gameResult.textContent = "ê²Œì„ ê²°ê³¼ ëŒ€ê¸° ì¤‘...";

        const pairResults = document.getElementById("pairResults");
        if (pairResults) pairResults.textContent = "";
      });

      // ê°œë³„ ì¹´ë“œ ë”œë§ ì´ë²¤íŠ¸
      socket.on("card_dealt_to_user_ui", (data) => {
        displaySingleCard(
          data.target,
          data.cardValue,
          data.cardSuit,
          data.cardIndex
        );
      });

      // ê²Œì„ ê²°ê³¼ ì²˜ë¦¬
      socket.on("game_result_with_cards", (gameData) => {
        const gameResult = document.getElementById("gameResult");
        if (gameResult) {
          const resultText =
            gameData.result === "player"
              ? "í”Œë ˆì´ì–´ ìŠ¹ë¦¬"
              : gameData.result === "banker"
              ? "ë±…ì»¤ ìŠ¹ë¦¬"
              : "íƒ€ì´";
          gameResult.textContent = resultText;
        }

        // ì¹´ë“œ í‘œì‹œ
        if (gameData.playerHand) {
          displayCards("playerCards", gameData.playerHand);
        }
        if (gameData.bankerHand) {
          displayCards("bankerCards", gameData.bankerHand);
        }

        // ë± ì •ë³´ ì—…ë°ì´íŠ¸
        if (gameData.deckInfo) {
          updateDeckInfo(gameData.deckInfo);
        }

        // ìµœê·¼ ê²Œì„ ê¸°ë¡ ì—…ë°ì´íŠ¸
        setTimeout(() => {
          fetchRecentGames();
        }, 1000);
      });

      // ë± ì…”í”Œ ì´ë²¤íŠ¸
      socket.on("deck_shuffled", (data) => {
        showToast(data.message);
        if (data.deckInfo) {
          updateDeckInfo(data.deckInfo);
        }
      });

      // ë± ì •ë³´ ì‘ë‹µ
      socket.on("deck_info", (deckInfo) => {
        updateDeckInfo(deckInfo);
      });

      // ì´ˆê¸° ë°ì´í„° ë¡œë”©
      document.addEventListener("DOMContentLoaded", () => {
        // ë± ì •ë³´ ìš”ì²­
        socket.emit("get_deck_info");
        // ê²Œì„ ê¸°ë¡ ë¡œë“œ
        fetchRecentGames();
      });

      // ìë™ ìƒˆë¡œê³ ì¹¨ ëŒ€ì‹  ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ í™•ì¸
      setTimeout(() => {
        fetchRecentGames();
      }, 500);

      // ì‚¬ìš©ì ìë™ ê²Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸
      socket.on('auto_game_status', function(data) {
        updateUserAutoGameStatus(data);
      });

      // ìë™ ê²Œì„ ì™„ì „ ì¤‘ì§€ë¨
      socket.on('auto_game_stopped', function() {
        document.getElementById('autoStartBetting').style.display = 'block';
        document.getElementById('autoStopBetting').classList.add('hidden');
        document.getElementById('stopUserAutoGame').classList.add('hidden');
        document.getElementById('scheduledStopStatus').classList.add('hidden');
        document.getElementById('gameStatsDisplay').classList.add('hidden');
        document.getElementById('userAutoGameStatus').textContent = 'ëŒ€ê¸° ì¤‘ (ì ‘ì†ì ì—†ìŒ)';
        showToast('ìë™ ê²Œì„ì´ ì™„ì „íˆ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
      });

      // ì˜ˆì•½ ì¢…ë£Œ ìƒíƒœ ì—…ë°ì´íŠ¸
      socket.on('scheduled_stop_update', function(data) {
        const scheduledStopEl = document.getElementById('scheduledStopStatus');
        if (data.scheduled) {
          scheduledStopEl.textContent = `ë‚¨ì€ ê²Œì„: ${data.remainingGames}íšŒ`;
          scheduledStopEl.classList.remove('hidden');
        } else {
          scheduledStopEl.classList.add('hidden');
        }
      });

      // ê²Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
      function updateUserAutoGameStatus(data) {
        const statusEl = document.getElementById('userAutoGameStatus');
        const gameStatsEl = document.getElementById('gameStatsDisplay');
        const gameCountEl = document.getElementById('gameCount');
        
        if (data.isActive) {
          const phaseText = {
            'waiting': 'ë‹¤ìŒ ê²Œì„ ëŒ€ê¸° ì¤‘',
            'betting': 'ë² íŒ… ì§„í–‰ ì¤‘',
            'playing': 'ê²Œì„ ì§„í–‰ ì¤‘',
            'showing_result': 'ê²°ê³¼ í‘œì‹œ ì¤‘'
          };
          
          statusEl.textContent = `ì§„í–‰ ì¤‘ - ${phaseText[data.phase] || data.phase}`;
          statusEl.className = 'text-xs text-green-400';
          
          // ê²Œì„ í†µê³„ í‘œì‹œ
          if (data.gameNumber !== undefined) {
            gameCountEl.textContent = data.gameNumber;
            gameStatsEl.classList.remove('hidden');
            
            // ì°¸ì—¬ì ìˆ˜ ì—…ë°ì´íŠ¸
            if (data.participants !== undefined) {
              document.getElementById('autoGameParticipants').textContent = data.participants;
            }
          }
        } else {
          statusEl.textContent = 'ëŒ€ê¸° ì¤‘ (ì ‘ì†ì ì—†ìŒ)';
          statusEl.className = 'text-xs text-gray-400';
          gameStatsEl.classList.add('hidden');
          document.getElementById('autoGameParticipants').textContent = '0';
        }
      }

      // ì ‘ì†ì ìˆ˜ ì—…ë°ì´íŠ¸
      socket.on("user_count_update", (data) => {
        document.getElementById("baccaratUsers").textContent = data.baccarat || 0;
        document.getElementById("blackjackUsers").textContent = data.blackjack || 0;
        document.getElementById("totalUsers").textContent = data.total || 0;
        
        // ìë™ ê²Œì„ ì°¸ì—¬ì ìˆ˜ ì—…ë°ì´íŠ¸ (ì„ì‹œë¡œ ë°”ì¹´ë¼ ì ‘ì†ìì™€ ë™ì¼í•˜ê²Œ í‘œì‹œ)
        document.getElementById("autoGameParticipants").textContent = data.baccarat || 0;
      });
    </script>
  </body>
</html>
